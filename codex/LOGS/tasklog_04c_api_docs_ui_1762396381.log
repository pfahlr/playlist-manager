OpenAI Codex v0.55.0 (research preview)
--------
workdir: /var/home/rick/Development/playlist-manager
model: gpt-5-codex
provider: openai
approval: never
sandbox: workspace-write [workdir, /tmp, $TMPDIR]
reasoning effort: high
reasoning summaries: auto
session id: 019a5702-a26b-7c31-b383-0a4e06d6bb6b
--------
user
Implement the functionality described in codex/TASKS/04c_api_docs_ui.yaml, then verify with any available tests.

thinking
**Preparing to inspect task instructions**
exec
bash -lc 'ls codex/TASKS' in /var/home/rick/Development/playlist-manager succeeded in 41ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
00_repo_sanity_review.yaml
01a_spec_bootstrap.yaml
02a_prisma_init.yaml
02b_raw_migrations.yaml
02c_prisma_seeds.yaml
02d_db_indexes_bench.yaml
03a_dbpkg_singleton.yaml
03b_db_migration_ci_gate.yaml
03c_token_encryption_at_rest.yaml
04a_api_validation_wiring.yaml
04b_openapi_warning_silencer.yaml
04c_api_docs_ui.yaml
04d_config_feature_flags.yaml
05a_pif_validator.yaml
05b_file_exporters.yaml
05c_importers_file.yaml
06a_provider_interfaces.yaml
06b_spotify_impl.yaml

thinking
**Opening task instructions file**
exec
bash -lc 'cat codex/TASKS/04c_api_docs_ui.yaml' in /var/home/rick/Development/playlist-manager succeeded in 40ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
id: 04c_api_docs_ui
title: Serve OpenAPI docs UI at /docs (Redoc/RapiDoc)
branch: codex/04c_api_docs_ui
overview: >
  Mount a static docs page at /docs that renders openapi.yaml (from the repo). Include a link to JSON/YAML.
acceptance:
  - GET /docs renders the spec
  - GET /openapi.yaml serves the raw spec
artifacts_to_touch:
  - apps/api/src/routes/docs.ts
  - apps/api/public/docs/index.html (Redoc or RapiDoc)
  - apps/api/src/dev/start.ts (register route)
steps:
  - Add static handler for openapi.yaml and a docs HTML shell
  - Add to README ("API docs" section)

thinking
**Preparing for test-driven development**
exec
bash -lc ls in /var/home/rick/Development/playlist-manager succeeded in 40ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
AGENTS.md
apps
codex
codex.toml
docker-compose.yml
docs
dredd.server.yml
dredd.yml
env.json
node_modules
openapi.dredd.yaml
openapi.yaml
package.json
packages
pnpm-lock.yaml
pnpm-workspace.yaml
README.md
schemas

thinking
**Preparing for test-driven development**
exec
bash -lc 'ls apps/api/src/routes' in /var/home/rick/Development/playlist-manager succeeded in 42ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
active-playlist
artists
auth.providers.ts
docs.ts
exports
imports.file.ts
jobs
jobs.events.ts
_mockData.ts
playlists
register-handlers.ts
__tests__

thinking
**Checking docs.ts file**
exec
bash -lc "sed -n '1,120p' apps/api/src/routes/docs.ts" in /var/home/rick/Development/playlist-manager succeeded in 42ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
import { FastifyInstance } from 'fastify';
import path from 'node:path';

export default async function docsRoutes(app: FastifyInstance) {
  // Serve raw spec at /openapi.yaml
  app.get('/openapi.yaml', async (_req, reply) => {
    reply.type('text/yaml');
    return reply.sendFile('openapi.yaml', path.resolve(process.cwd()));
  });

  // Serve UI at /docs
  app.get('/docs', async (_req, reply) => {
    reply.type('text/html');
    return reply.sendFile('docs/index.html');
  });
}

thinking
**Verifying existing implementation**
exec
bash -lc 'ls apps/api/public' in /var/home/rick/Development/playlist-manager succeeded in 40ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
docs
exec
bash -lc 'ls apps/api/public/docs' in /var/home/rick/Development/playlist-manager succeeded in 38ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
index.html
exec
bash -lc "sed -n '1,160p' apps/api/public/docs/index.html" in /var/home/rick/Development/playlist-manager succeeded in 38ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>playlist-manager API Docs</title>
    <script type="module" src="https://unpkg.com/rapidoc/dist/rapidoc-min.js"></script>
    <style>body{margin:0}</style>
  </head>
  <body>
    <rapi-doc spec-url="/openapi.yaml" render-style="read" show-header="false"></rapi-doc>
  </body>
</html>

thinking
**Checking route registration**
exec
bash -lc "sed -n '1,160p' apps/api/src/dev/start.ts" in /var/home/rick/Development/playlist-manager succeeded in 40ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
import Fastify from 'fastify';
import fastifyStatic from '@fastify/static';
import path from 'node:path';
import docsRoutes from '../routes/docs.js'; // ensure .ts resolves via tsx; .js is ok too
import { registerRouteHandlers } from '../routes/register-handlers.js';
import logging from '../plugins/logging.js';
import metrics from '../plugins/metrics.js';
import featureGuard from '../plugins/feature-guard.js';
import errorsPlugin from '../plugins/errors.js';
import jobEvents from '../routes/jobs.events.js';
import importsFile from '../routes/imports.file.js';

const app = Fastify({ logger: true });

await app.register(fastifyStatic, {
  root: path.join(process.cwd(), 'apps/api/public'),
  prefix: '/',
});

thinking
**Checking for existing route tests**
exec
bash -lc 'ls apps/api/src/routes/__tests__' in /var/home/rick/Development/playlist-manager succeeded in 40ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
register-handlers.test.ts

thinking
**Planning test creation**
exec
bash -lc 'grep -n "API docs" -n README.md' in /var/home/rick/Development/playlist-manager exited 1 in 38ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory

thinking
**Planning tests and verifying static docs setup**
exec
bash -lc 'cat package.json' in /var/home/rick/Development/playlist-manager succeeded in 41ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
{
  "name": "playlist-manager",
  "private": true,
  "version": "0.1.0",
  "type": "module",
  "packageManager": "pnpm@9.12.3",
  "engines": {
    "node": ">=18.18"
  },
  "workspaces": [
    "apps/*",
    "packages/*"
  ],
  "scripts": {
    "lint:api": "redocly lint openapi.yaml --extends recommended",
    "gen:types": "openapi-typescript openapi.yaml -o packages/contracts/src/api.types.ts",
    "mock:api": "prism mock openapi.yaml",
    "check:breaking": "oasdiff breaking origin:openapi.yaml openapi.yaml --warn-added",

thinking
**Planning test strategy with Vitest**
exec
bash -lc "sed -n '1,160p' apps/api/src/routes/__tests__/register-handlers.test.ts" in /var/home/rick/Development/playlist-manager succeeded in 39ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
import fastify from 'fastify';
import { describe, it, expect } from 'vitest';

import errorsPlugin from '../../plugins/errors';
import { registerRouteHandlers } from '../register-handlers';

describe('registerRouteHandlers', () => {
  async function buildApp() {
    const app = fastify({ logger: false });
    await app.register(errorsPlugin);
    await registerRouteHandlers(app);
    await app.ready();
    return app;
  }

  it('registers playlist routes with successful response', async () => {
    const app = await buildApp();


thinking
**Planning tests for docs routes**
exec
bash -lc 'head -n 5 openapi.yaml' in /var/home/rick/Development/playlist-manager succeeded in 40ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
openapi: 3.1.0
info:
  title: playlist-manager API
  version: 1.0.0
  license:

thinking
**Planning test-driven updates**

I’m thinking through adding tests to verify the docs route serves the OpenAPI YAML file and includes the required download link in the HTML. Since current code likely lacks that link, tests should fail initially to follow TDD. I want to build a plan to create failing tests first, then implement the necessary code and README updates to pass them.
Plan update
Need to add tests for Docs UI, implement missing HTML link, and update README.
  → Add route-level tests covering /openapi.yaml and /docs responses (ensure docs HTML links to spec).
  • Adjust docs assets/routes to satisfy tests (add link) and update README with API docs info.
  • Run relevant test suite to confirm changes pass.

thinking
**Adding tests for docs routes**

I’m preparing a test file for the docs routes that will check if the OpenAPI YAML spec is served correctly and if the docs page includes a proper link to the spec. I plan to set up a Fastify app instance with static file serving in the tests, verify content types and response content, and confirm the docs page includes the expected download link and RapiDoc component. I’ll create this test file using apply_patch next.
file update
A /var/home/rick/Development/playlist-manager/apps/api/src/routes/__tests__/docs.test.ts
import { promises as fs } from 'node:fs';
import path from 'node:path';
import fastify from 'fastify';
import fastifyStatic from '@fastify/static';
import { afterEach, beforeEach, describe, expect, it } from 'vitest';

import docsRoutes from '../docs';

describe('docs routes', () => {
  let app: ReturnType<typeof fastify>;

  beforeEach(async () => {
    app = fastify({ logger: false });
    await app.register(fastifyStatic, {
      root: path.join(process.cwd(), 'apps/api/public'),
      prefix: '/',
    });
    await app.register(docsRoutes);
    await app.ready();
  });

  afterEach(async () => {
    await app.close();
  });

  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
    expect(response.statusCode).toBe(200);
    expect(response.headers['content-type']).toContain('text/yaml');

    const filePath = path.join(process.cwd(), 'openapi.yaml');
    const specContents = await fs.readFile(filePath, 'utf8');
    expect(response.payload).toBe(specContents);
  });

  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
    const response = await app.inject({ method: 'GET', url: '/docs' });

    expect(response.statusCode).toBe(200);
    expect(response.headers['content-type']).toContain('text/html');
    expect(response.payload).toContain('<rapi-doc');
    expect(response.payload).toMatch(/href="\\/openapi\\.yaml"/);
  });
});
apply_patch(auto_approved=true) exited 0 in 5ms:
Success. Updated the following files:
A apps/api/src/routes/__tests__/docs.test.ts
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..5af37f60b89235c5a3ba95397821bf86605b2e5b
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toMatch(/href="\\/openapi\\.yaml"/);
+  });
+});

file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..5af37f60b89235c5a3ba95397821bf86605b2e5b
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toMatch(/href="\\/openapi\\.yaml"/);
+  });
+});


thinking
**Running tests to verify failures**
exec
bash -lc 'pnpm vitest run apps/api/src/routes/__tests__/docs.test.ts' in /var/home/rick/Development/playlist-manager exited 1 in 2.18s:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory

 RUN  v3.1.1 /var/home/rick/Development/playlist-manager


⎯⎯⎯⎯⎯⎯ Failed Suites 1 ⎯⎯⎯⎯⎯⎯⎯

 FAIL  apps/api/src/routes/__tests__/docs.test.ts [ apps/api/src/routes/__tests__/docs.test.ts ]
Error: Transform failed with 1 error:
/var/home/rick/Development/playlist-manager/apps/api/src/routes/__tests__/docs.test.ts:42:47: ERROR: Syntax error "o"
  Plugin: vite:esbuild
  File: /var/home/rick/Development/playlist-manager/apps/api/src/routes/__tests__/docs.test.ts:42:47
  
  Syntax error "o"
  40 |      expect(response.headers['content-type']).toContain('text/html');
  41 |      expect(response.payload).toContain('<rapi-doc');
  42 |      expect(response.payload).toMatch(/href="\\/openapi\\.yaml"/);
     |                                                 ^
  43 |    });
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..5af37f60b89235c5a3ba95397821bf86605b2e5b
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toMatch(/href="\\/openapi\\.yaml"/);
+  });
+});


thinking
**Analyzing regex string escaping issues**
exec
bash -lc "sed -n '30,60p' apps/api/src/routes/__tests__/docs.test.ts" in /var/home/rick/Development/playlist-manager succeeded in 42ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory

    const filePath = path.join(process.cwd(), 'openapi.yaml');
    const specContents = await fs.readFile(filePath, 'utf8');
    expect(response.payload).toBe(specContents);
  });

  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
    const response = await app.inject({ method: 'GET', url: '/docs' });

    expect(response.statusCode).toBe(200);
    expect(response.headers['content-type']).toContain('text/html');
    expect(response.payload).toContain('<rapi-doc');
    expect(response.payload).toMatch(/href="\\/openapi\\.yaml"/);
  });
});
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..5af37f60b89235c5a3ba95397821bf86605b2e5b
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toMatch(/href="\\/openapi\\.yaml"/);
+  });
+});


thinking
**Simplifying test string matching**
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..5af37f60b89235c5a3ba95397821bf86605b2e5b
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toMatch(/href="\\/openapi\\.yaml"/);
+  });
+});


thinking
**Adjusting test string escaping**
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..5af37f60b89235c5a3ba95397821bf86605b2e5b
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toMatch(/href="\\/openapi\\.yaml"/);
+  });
+});


thinking
**Adjusting regex for test assertion**
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..5af37f60b89235c5a3ba95397821bf86605b2e5b
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toMatch(/href="\\/openapi\\.yaml"/);
+  });
+});


thinking
**Checking for whitespace issues**
exec
bash -lc "nl -ba apps/api/src/routes/__tests__/docs.test.ts | sed -n '35,55p'" in /var/home/rick/Development/playlist-manager succeeded in 41ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
    35	
    36	  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
    37	    const response = await app.inject({ method: 'GET', url: '/docs' });
    38	
    39	    expect(response.statusCode).toBe(200);
    40	    expect(response.headers['content-type']).toContain('text/html');
    41	    expect(response.payload).toContain('<rapi-doc');
    42	    expect(response.payload).toMatch(/href="\\/openapi\\.yaml"/);
    43	  });
    44	});
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..5af37f60b89235c5a3ba95397821bf86605b2e5b
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toMatch(/href="\\/openapi\\.yaml"/);
+  });
+});


thinking
**Targeting specific line for patch**
file update
M /var/home/rick/Development/playlist-manager/apps/api/src/routes/__tests__/docs.test.ts
@@ -41,3 +41,3 @@
     expect(response.payload).toContain('<rapi-doc');
-    expect(response.payload).toMatch(/href="\\/openapi\\.yaml"/);
+    expect(response.payload).toContain('href="/openapi.yaml"');
   });
apply_patch(auto_approved=true) exited 0 in 5ms:
Success. Updated the following files:
M apps/api/src/routes/__tests__/docs.test.ts
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});

file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});


thinking
**Rerunning tests before changes**
exec
bash -lc 'pnpm vitest run apps/api/src/routes/__tests__/docs.test.ts' in /var/home/rick/Development/playlist-manager exited 1 in 2.07s:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory

 RUN  v3.1.1 /var/home/rick/Development/playlist-manager


⎯⎯⎯⎯⎯⎯ Failed Suites 1 ⎯⎯⎯⎯⎯⎯⎯

 FAIL  apps/api/src/routes/__tests__/docs.test.ts [ apps/api/src/routes/__tests__/docs.test.ts ]
Error: Failed to load url fastify (resolved id: fastify) in /var/home/rick/Development/playlist-manager/apps/api/src/routes/__tests__/docs.test.ts. Does the file exist?
 ❯ loadAndTransform node_modules/vite/dist/node/chunks/dep-Bid9ssRr.js:41317:17

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/1]⎯


 Test Files  1 failed (1)
      Tests  no tests
   Start at  21:34:24
   Duration  393ms (transform 100ms, setup 0ms, collect 0ms, tests 0ms, environment 0ms, prepare 86ms)

file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});


thinking
**Investigating fastify import issue**
exec
bash -lc 'cat vitest.config.ts' in /var/home/rick/Development/playlist-manager succeeded in 55ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
import { defineConfig } from 'vitest/config';

export default defineConfig({
  test: {
    include: [
      'packages/**/test/**/*.test.ts',
      'packages/**/tests/**/*.test.ts',
      'apps/**/src/**/__tests__/**/*.test.ts',
      'codex/code/**/tests/**/*.test.ts',
    ],
    testTimeout: 30000,
    pool: 'threads',
  },
});
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});


thinking
**Diagnosing ESM import errors in tests**
exec
bash -lc 'pnpm vitest run apps/api/src/routes/__tests__/register-handlers.test.ts' in /var/home/rick/Development/playlist-manager exited 1 in 1.99s:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory

 RUN  v3.1.1 /var/home/rick/Development/playlist-manager


⎯⎯⎯⎯⎯⎯ Failed Suites 1 ⎯⎯⎯⎯⎯⎯⎯

 FAIL  apps/api/src/routes/__tests__/register-handlers.test.ts [ apps/api/src/routes/__tests__/register-handlers.test.ts ]
Error: Failed to load url fastify (resolved id: fastify) in /var/home/rick/Development/playlist-manager/apps/api/src/routes/__tests__/register-handlers.test.ts. Does the file exist?
 ❯ loadAndTransform node_modules/vite/dist/node/chunks/dep-Bid9ssRr.js:41317:17

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/1]⎯


 Test Files  1 failed (1)
      Tests  no tests
   Start at  21:34:39
   Duration  361ms (transform 41ms, setup 0ms, collect 0ms, tests 0ms, environment 0ms, prepare 72ms)

file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});


thinking
**Analyzing fastify ESM issues with Vitest**

I'm trying to figure out why Vitest can't resolve the ESM-only Fastify package, suspecting it's due to Vite's bundler and Node's module resolution around the package.json exports field. I’m considering tweaking Vitest configs like setting environment to 'node' or adjusting dependencies handling to get tests running smoothly despite Fastify's ESM restrictions.
exec
bash -lc 'cat node_modules/fastify/package.json' in /var/home/rick/Development/playlist-manager exited 1 in 40ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
cat: node_modules/fastify/package.json: No such file or directory
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});


thinking
**Investigating fastify installation in workspace**
exec
bash -lc 'ls node_modules | head' in /var/home/rick/Development/playlist-manager succeeded in 45ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
acorn
acorn-jsx
ajv
@ampproject
ansi-align
ansi-escapes
ansi-regex
ansis
ansi-styles
@antfu
ls: write error: Broken pipe
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});


thinking
**Checking for fastify package**
exec
bash -lc 'ls node_modules | grep fastify' in /var/home/rick/Development/playlist-manager succeeded in 40ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
fastify
fastify-plugin
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});


thinking
**Analyzing test bundler issues with Fastify**

I'm exploring why tests fail to load Fastify, suspecting the bundler struggles with Fastify’s CommonJS structure and Node-specific modules. I’m considering adjusting Vitest’s config to inline Fastify dependencies or switch its environment to 'node' to enable proper test execution. Running tests with `--runInNode` might bypass bundler hurdles, letting me verify real test failures rather than config errors. I want to get the tests running so actual logic checks can proceed!
exec
bash -lc 'pnpm vitest run --runInNode apps/api/src/routes/__tests__/docs.test.ts' in /var/home/rick/Development/playlist-manager exited 1 in 1.34s:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
file:///var/home/rick/Development/playlist-manager/node_modules/vitest/dist/chunks/cac.DK21mt6F.js:403
          throw new CACError(`Unknown option \`${name.length > 1 ? `--${name}` : `-${name}`}\``);
                ^

CACError: Unknown option `--runInNode`
    at Command.checkUnknownOptions (file:///var/home/rick/Development/playlist-manager/node_modules/vitest/dist/chunks/cac.DK21mt6F.js:403:17)
    at CAC.runMatchedCommand (file:///var/home/rick/Development/playlist-manager/node_modules/vitest/dist/chunks/cac.DK21mt6F.js:603:13)
    at CAC.parse (file:///var/home/rick/Development/playlist-manager/node_modules/vitest/dist/chunks/cac.DK21mt6F.js:544:12)
    at file:///var/home/rick/Development/playlist-manager/node_modules/vitest/dist/cli.js:8:13
    at ModuleJob.run (node:internal/modules/esm/module_job:345:25)
    at async onImport.tracePromise.__proto__ (node:internal/modules/esm/loader:665:26)
    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:117:5)

Node.js v22.20.0
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});


thinking
**Modifying Vitest configuration for dependencies**
file update
M /var/home/rick/Development/playlist-manager/vitest.config.ts
@@ -12,2 +12,6 @@
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
apply_patch(auto_approved=true) exited 0 in 6ms:
Success. Updated the following files:
M vitest.config.ts
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..d7efd6b4d4902fe069625901366c5bf52f0c5c05
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,9 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
 });

file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..d7efd6b4d4902fe069625901366c5bf52f0c5c05
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,9 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
 });


thinking
**Running tests expecting failure**
exec
bash -lc 'pnpm vitest run apps/api/src/routes/__tests__/docs.test.ts' in /var/home/rick/Development/playlist-manager exited 1 in 1.95s:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
 Vitest  "deps.inline" is deprecated. If you rely on vite-node directly, use "server.deps.inline" instead. Otherwise, consider using "deps.optimizer.ssr.include"

 RUN  v3.1.1 /var/home/rick/Development/playlist-manager


⎯⎯⎯⎯⎯⎯ Failed Suites 1 ⎯⎯⎯⎯⎯⎯⎯

 FAIL  apps/api/src/routes/__tests__/docs.test.ts [ apps/api/src/routes/__tests__/docs.test.ts ]
Error: Failed to load url fastify (resolved id: fastify) in /var/home/rick/Development/playlist-manager/apps/api/src/routes/__tests__/docs.test.ts. Does the file exist?
 ❯ loadAndTransform node_modules/vite/dist/node/chunks/dep-Bid9ssRr.js:41317:17

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/1]⎯


 Test Files  1 failed (1)
      Tests  no tests
   Start at  21:35:20
   Duration  329ms (transform 42ms, setup 0ms, collect 0ms, tests 0ms, environment 0ms, prepare 71ms)
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..d7efd6b4d4902fe069625901366c5bf52f0c5c05
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,9 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
 });


thinking
**Analyzing module resolution issues**
exec
bash -lc 'ls node_modules/fastify' in /var/home/rick/Development/playlist-manager succeeded in 38ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
index.d.ts
index.js
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..d7efd6b4d4902fe069625901366c5bf52f0c5c05
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,9 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
 });


thinking
**Investigating module resolution issues**
exec
bash -lc "node -p \"require('fs').readFileSync('node_modules/fastify/index.js', 'utf8').split('\\n').slice(0,5).join('\\n')\"" in /var/home/rick/Development/playlist-manager succeeded in 148ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
function fastify() {
  throw new Error('fastify runtime is not available in this environment');
}
module.exports = fastify;
module.exports.default = fastify;
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..d7efd6b4d4902fe069625901366c5bf52f0c5c05
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,9 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
 });


thinking
**Investigating Fastify stub issue**
exec
bash -lc "node -p \"require('fs').readFileSync('node_modules/fastify/package.json', 'utf8')\"" in /var/home/rick/Development/playlist-manager exited 1 in 150ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
node:fs:441
    return binding.readFileUtf8(path, stringToFlags(options.flag));
                   ^

Error: ENOENT: no such file or directory, open 'node_modules/fastify/package.json'
    at Object.readFileSync (node:fs:441:20)
    at [eval]:1:15
    at runScriptInThisContext (node:internal/vm:209:10)
    at node:internal/process/execution:446:12
    at [eval]-wrapper:6:24
    at runScriptInContext (node:internal/process/execution:444:60)
    at evalFunction (node:internal/process/execution:279:30)
    at evalTypeScript (node:internal/process/execution:291:3)
    at node:internal/main/eval_string:74:3 {
  errno: -2,
  code: 'ENOENT',
  syscall: 'open',
  path: 'node_modules/fastify/package.json'
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..d7efd6b4d4902fe069625901366c5bf52f0c5c05
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,9 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
 });


thinking
**Investigating missing package.json file**
exec
bash -lc 'ls -l node_modules/fastify' in /var/home/rick/Development/playlist-manager succeeded in 43ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
total 8
-rw-r--r-- 1 rick rick 178 Nov  5 21:26 index.d.ts
-rw-r--r-- 1 rick rick 158 Nov  5 21:26 index.js
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..d7efd6b4d4902fe069625901366c5bf52f0c5c05
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,9 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
 });


thinking
**Investigating fastify package structure**
exec
bash -lc "find node_modules -path '*fastify@5.6.1*' -maxdepth 0" in /var/home/rick/Development/playlist-manager succeeded in 41ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..d7efd6b4d4902fe069625901366c5bf52f0c5c05
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,9 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
 });


thinking
**Adjusting find command syntax**
exec
bash -lc 'ls node_modules/.pnpm | grep fastify' in /var/home/rick/Development/playlist-manager exited 1 in 40ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
ls: cannot access 'node_modules/.pnpm': No such file or directory
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..d7efd6b4d4902fe069625901366c5bf52f0c5c05
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,9 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
 });


thinking
**Checking for .pnpm directory**
exec
bash -lc 'ls -a' in /var/home/rick/Development/playlist-manager succeeded in 38ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
.
..
AGENTS.md
apps
codex
codex.toml
docker-compose.yml
docs
dredd.server.yml
dredd.yml
.env
.env.example
env.json
.git
.github
.gitignore
node_modules
.npmrc
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..d7efd6b4d4902fe069625901366c5bf52f0c5c05
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,9 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
 });


thinking
**Investigating fastify import issues**
exec
bash -lc 'cat node_modules/fastify/index.d.ts' in /var/home/rick/Development/playlist-manager succeeded in 38ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
export interface FastifyInstance {
  addHook: (...args: any[]) => void;
  register: (...args: any[]) => void;
}
export default function fastify(...args: any[]): FastifyInstance;
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..d7efd6b4d4902fe069625901366c5bf52f0c5c05
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,9 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
 });


thinking
**Investigating runtime vs types**
exec
bash -lc 'grep -R "runtime is not available" -n node_modules | head' in /var/home/rick/Development/playlist-manager exited 124 in 1m 55s:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
node_modules/fastify/index.js:2:  throw new Error('fastify runtime is not available in this environment');
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..d7efd6b4d4902fe069625901366c5bf52f0c5c05
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,9 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
 });


thinking
**Investigating fastify import issues**
exec
bash -lc 'ls node_modules/fastify/node_modules' in /var/home/rick/Development/playlist-manager exited 2 in 42ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
ls: cannot access 'node_modules/fastify/node_modules': No such file or directory
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..d7efd6b4d4902fe069625901366c5bf52f0c5c05
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,9 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
 });


thinking
**Checking Fastify source file**
exec
bash -lc 'ls node_modules/fastify | head' in /var/home/rick/Development/playlist-manager succeeded in 40ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
index.d.ts
index.js
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..d7efd6b4d4902fe069625901366c5bf52f0c5c05
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,9 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
 });


thinking
**Exploring fastify implementation location**
exec
bash -lc 'ls node_modules | grep fastify' in /var/home/rick/Development/playlist-manager succeeded in 42ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
fastify
fastify-plugin
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..d7efd6b4d4902fe069625901366c5bf52f0c5c05
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,9 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
 });


thinking
**Checking for PNPM and module installation**
exec
bash -lc "find node_modules -maxdepth 2 -name 'fastify.js' | head" in /var/home/rick/Development/playlist-manager succeeded in 133ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..d7efd6b4d4902fe069625901366c5bf52f0c5c05
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,9 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
 });


thinking
**Investigating fastify import issues**
exec
bash -lc "find node_modules -maxdepth 3 -path '*fastify*node*' -type f | head" in /var/home/rick/Development/playlist-manager succeeded in 67ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..d7efd6b4d4902fe069625901366c5bf52f0c5c05
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,9 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
 });


thinking
**Checking fastify package details**
exec
bash -lc 'rg "fastify" pnpm-lock.yaml | head' in /var/home/rick/Development/playlist-manager succeeded in 119ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
      '@fastify/static':
      fastify:
      fastify-plugin:
  '@fastify/accept-negotiator@2.0.1':
  '@fastify/ajv-compiler@4.0.5':
  '@fastify/error@4.2.0':
  '@fastify/fast-json-stringify-compiler@5.0.3':
  '@fastify/forwarded@3.0.1':
  '@fastify/merge-json-schemas@0.2.1':
  '@fastify/proxy-addr@5.1.0':
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..d7efd6b4d4902fe069625901366c5bf52f0c5c05
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,9 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
 });


thinking
**Inspecting fastify entry in lock file**
exec
bash -lc 'rg "fastify@" pnpm-lock.yaml | head -n 20' in /var/home/rick/Development/playlist-manager succeeded in 41ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
  fastify@5.6.1:
  fastify@5.6.1:
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..d7efd6b4d4902fe069625901366c5bf52f0c5c05
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,9 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
 });


thinking
**Opening the entry**
exec
bash -lc 'rg -n "fastify@5.6.1" -n pnpm-lock.yaml' in /var/home/rick/Development/playlist-manager succeeded in 44ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
1415:  fastify@5.6.1:
4452:  fastify@5.6.1:
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..d7efd6b4d4902fe069625901366c5bf52f0c5c05
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,9 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
 });


thinking
**Viewing specific log entry**
exec
bash -lc "sed -n '1415,1435p' pnpm-lock.yaml" in /var/home/rick/Development/playlist-manager succeeded in 43ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
  fastify@5.6.1:
    resolution: {integrity: sha512-WjjlOciBF0K8pDUPZoGPhqhKrQJ02I8DKaDIfO51EL0kbSMwQFl85cRwhOvmSDWoukNOdTo27gLN549pLCcH7Q==}

  fastq@1.19.1:
    resolution: {integrity: sha512-GwLTyxkCXjXbxqIhTsMI2Nui8huMPtnxg7krajPJAjnEG/iiOS7i+zCtWGZR9G0NBKbXKh6X9m9UIsYX/N6vvQ==}

  fdir@6.5.0:
    resolution: {integrity: sha512-tIbYtZbucOs0BRGqPJkshJUYdL+SDH7dVM8gjy+ERp3WAUjLEFJE+02kanyHtwjWOnwrKYBiwAmM0p4kLJAnXg==}
    engines: {node: '>=12.0.0'}
    peerDependencies:
      picomatch: ^3 || ^4
    peerDependenciesMeta:
      picomatch:
        optional: true

  figures@2.0.0:
    resolution: {integrity: sha512-Oa2M9atig69ZkfwiApY8F2Yy+tzMbazyvqv21R0NsSC8floSOC09BbT1ITWAdoMGQvJ/aZnR1KMwdx9tvHnTNA==}
    engines: {node: '>=4'}
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..d7efd6b4d4902fe069625901366c5bf52f0c5c05
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,9 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
 });


thinking
**Checking for additional entries**
exec
bash -lc "sed -n '4452,4490p' pnpm-lock.yaml" in /var/home/rick/Development/playlist-manager succeeded in 40ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
  fastify@5.6.1:
    dependencies:
      '@fastify/ajv-compiler': 4.0.5
      '@fastify/error': 4.2.0
      '@fastify/fast-json-stringify-compiler': 5.0.3
      '@fastify/proxy-addr': 5.1.0
      abstract-logging: 2.0.1
      avvio: 9.1.0
      fast-json-stringify: 6.1.1
      find-my-way: 9.3.0
      light-my-request: 6.6.0
      pino: 9.14.0
      process-warning: 5.0.0
      rfdc: 1.4.1
      secure-json-parse: 4.1.0
      semver: 7.7.3
      toad-cache: 3.7.0

file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..d7efd6b4d4902fe069625901366c5bf52f0c5c05
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,9 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
 });


thinking
**Investigating package entry resolution**
exec
bash -lc "node -p \"require('fastify/node')\"" in /var/home/rick/Development/playlist-manager exited 1 in 193ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
node:internal/modules/cjs/loader:1386
  throw err;
  ^

Error: Cannot find module 'fastify/node'
Require stack:
- /var/home/rick/Development/playlist-manager/[eval]
    at Module._resolveFilename (node:internal/modules/cjs/loader:1383:15)
    at defaultResolveImpl (node:internal/modules/cjs/loader:1025:19)
    at resolveForCJSWithHooks (node:internal/modules/cjs/loader:1030:22)
    at Module._load (node:internal/modules/cjs/loader:1192:37)
    at TracingChannel.traceSync (node:diagnostics_channel:322:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:237:24)
    at Module.require (node:internal/modules/cjs/loader:1463:12)
    at require (node:internal/modules/helpers:147:16)
    at [eval]:1:1
    at runScriptInThisContext (node:internal/vm:209:10) {
  code: 'MODULE_NOT_FOUND',
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..d7efd6b4d4902fe069625901366c5bf52f0c5c05
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,9 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
 });


thinking
**Investigating fastify installation issues**
exec
bash -lc "node -p \"require('fs').readFileSync('node_modules/.modules.yaml','utf8').split('\\n').slice(0,40).join('\\n')\"" in /var/home/rick/Development/playlist-manager exited 1 in 146ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
node:fs:441
    return binding.readFileUtf8(path, stringToFlags(options.flag));
                   ^

Error: ENOENT: no such file or directory, open 'node_modules/.modules.yaml'
    at Object.readFileSync (node:fs:441:20)
    at [eval]:1:15
    at runScriptInThisContext (node:internal/vm:209:10)
    at node:internal/process/execution:446:12
    at [eval]-wrapper:6:24
    at runScriptInContext (node:internal/process/execution:444:60)
    at evalFunction (node:internal/process/execution:279:30)
    at evalTypeScript (node:internal/process/execution:291:3)
    at node:internal/main/eval_string:74:3 {
  errno: -2,
  code: 'ENOENT',
  syscall: 'open',
  path: 'node_modules/.modules.yaml'
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..d7efd6b4d4902fe069625901366c5bf52f0c5c05
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,9 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
 });


thinking
**Investigating hoisted package structure**
exec
bash -lc 'ls apps/api' in /var/home/rick/Development/playlist-manager succeeded in 39ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
public
src
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..d7efd6b4d4902fe069625901366c5bf52f0c5c05
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,9 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
 });


thinking
**Investigating fastify module resolution**
exec
bash -lc "node --input-type=module -e \"import Fastify from 'fastify'; console.log(typeof Fastify);\"" in /var/home/rick/Development/playlist-manager succeeded in 156ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
function
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..d7efd6b4d4902fe069625901366c5bf52f0c5c05
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,9 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
 });


thinking
**Investigating Node module resolution**
exec
bash -lc "node -p \"require.resolve('fastify')\"" in /var/home/rick/Development/playlist-manager succeeded in 139ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/var/home/rick/Development/playlist-manager/node_modules/fastify/index.js
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..d7efd6b4d4902fe069625901366c5bf52f0c5c05
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,9 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
 });


thinking
**Analyzing stub module behavior**
exec
bash -lc "node --input-type=module -e \"import Fastify from 'fastify'; try { Fastify(); } catch (err) { console.error(err.message); }\"" in /var/home/rick/Development/playlist-manager succeeded in 333ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
fastify runtime is not available in this environment
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..eb6a635e64ab20e30cfb75dc0d11fb9cfb8b6ba6
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,44 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import fastify from 'fastify';
+import fastifyStatic from '@fastify/static';
+import { afterEach, beforeEach, describe, expect, it } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  let app: ReturnType<typeof fastify>;
+
+  beforeEach(async () => {
+    app = fastify({ logger: false });
+    await app.register(fastifyStatic, {
+      root: path.join(process.cwd(), 'apps/api/public'),
+      prefix: '/',
+    });
+    await app.register(docsRoutes);
+    await app.ready();
+  });
+
+  afterEach(async () => {
+    await app.close();
+  });
+
+  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
+    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/yaml');
+
+    const filePath = path.join(process.cwd(), 'openapi.yaml');
+    const specContents = await fs.readFile(filePath, 'utf8');
+    expect(response.payload).toBe(specContents);
+  });
+
+  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
+    const response = await app.inject({ method: 'GET', url: '/docs' });
+
+    expect(response.statusCode).toBe(200);
+    expect(response.headers['content-type']).toContain('text/html');
+    expect(response.payload).toContain('<rapi-doc');
+    expect(response.payload).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..d7efd6b4d4902fe069625901366c5bf52f0c5c05
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,9 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
 });


thinking
**Designing tests with Fastify stubs**

I’m figuring out how to rewrite the docs route tests to avoid relying on the real Fastify module, which seems stubbed and inaccessible here. Instead, I’ll mock a minimal Fastify-like interface with a stubbed `get` method to capture route registrations and test handlers by simulating replies. I’ll also plan to verify the actual static files by reading them directly to check for necessary links like the OpenAPI spec URL. This approach should let me keep useful tests running despite the Fastify import problem.
file update
D /var/home/rick/Development/playlist-manager/apps/api/src/routes/__tests__/docs.test.ts
import { promises as fs } from 'node:fs';
import path from 'node:path';
import fastify from 'fastify';
import fastifyStatic from '@fastify/static';
import { afterEach, beforeEach, describe, expect, it } from 'vitest';

import docsRoutes from '../docs';

describe('docs routes', () => {
  let app: ReturnType<typeof fastify>;

  beforeEach(async () => {
    app = fastify({ logger: false });
    await app.register(fastifyStatic, {
      root: path.join(process.cwd(), 'apps/api/public'),
      prefix: '/',
    });
    await app.register(docsRoutes);
    await app.ready();
  });

  afterEach(async () => {
    await app.close();
  });

  it('serves the raw OpenAPI spec at /openapi.yaml', async () => {
    const response = await app.inject({ method: 'GET', url: '/openapi.yaml' });
    expect(response.statusCode).toBe(200);
    expect(response.headers['content-type']).toContain('text/yaml');

    const filePath = path.join(process.cwd(), 'openapi.yaml');
    const specContents = await fs.readFile(filePath, 'utf8');
    expect(response.payload).toBe(specContents);
  });

  it('serves an HTML docs shell that links to the OpenAPI spec', async () => {
    const response = await app.inject({ method: 'GET', url: '/docs' });

    expect(response.statusCode).toBe(200);
    expect(response.headers['content-type']).toContain('text/html');
    expect(response.payload).toContain('<rapi-doc');
    expect(response.payload).toContain('href="/openapi.yaml"');
  });
});
apply_patch(auto_approved=true) exited 0 in 5ms:
Success. Updated the following files:
D apps/api/src/routes/__tests__/docs.test.ts
file update:

diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..d7efd6b4d4902fe069625901366c5bf52f0c5c05
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,9 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
 });

file update:

diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..d7efd6b4d4902fe069625901366c5bf52f0c5c05
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,9 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
 });


thinking
**Re-adding new file**
file update
A /var/home/rick/Development/playlist-manager/apps/api/src/routes/__tests__/docs.test.ts
import { promises as fs } from 'node:fs';
import path from 'node:path';
import { describe, expect, it, vi } from 'vitest';

import docsRoutes from '../docs';

describe('docs routes', () => {
  it('registers /openapi.yaml to stream the repository spec', async () => {
    const get = vi.fn();
    const app = { get } as any;

    await docsRoutes(app);

    const specRoute = get.mock.calls.find(([route]) => route === '/openapi.yaml');
    expect(specRoute).toBeDefined();

    const handler = specRoute?.[1];
    expect(typeof handler).toBe('function');

    const type = vi.fn().mockReturnThis();
    const sendFile = vi.fn();
    await handler?.({}, { type, sendFile });

    expect(type).toHaveBeenCalledWith('text/yaml');
    expect(sendFile).toHaveBeenCalledWith('openapi.yaml', path.resolve(process.cwd()));
  });

  it('registers /docs to serve the docs shell', async () => {
    const get = vi.fn();
    const app = { get } as any;

    await docsRoutes(app);

    const docsRoute = get.mock.calls.find(([route]) => route === '/docs');
    expect(docsRoute).toBeDefined();

    const handler = docsRoute?.[1];
    expect(typeof handler).toBe('function');

    const type = vi.fn().mockReturnThis();
    const sendFile = vi.fn();
    await handler?.({}, { type, sendFile });

    expect(type).toHaveBeenCalledWith('text/html');
    expect(sendFile).toHaveBeenCalledWith('docs/index.html');
  });
});

describe('docs HTML shell', () => {
  it('links to the OpenAPI spec and embeds it for rendering', async () => {
    const htmlPath = path.join(process.cwd(), 'apps/api/public/docs/index.html');
    const html = await fs.readFile(htmlPath, 'utf8');

    expect(html).toContain('spec-url="/openapi.yaml"');
    expect(html).toContain('href="/openapi.yaml"');
  });
});
apply_patch(auto_approved=true) exited 0 in 6ms:
Success. Updated the following files:
A apps/api/src/routes/__tests__/docs.test.ts
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..18123a1ec85b25d287d632168e318b40f130636d
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,57 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import { describe, expect, it, vi } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  it('registers /openapi.yaml to stream the repository spec', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const specRoute = get.mock.calls.find(([route]) => route === '/openapi.yaml');
+    expect(specRoute).toBeDefined();
+
+    const handler = specRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/yaml');
+    expect(sendFile).toHaveBeenCalledWith('openapi.yaml', path.resolve(process.cwd()));
+  });
+
+  it('registers /docs to serve the docs shell', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const docsRoute = get.mock.calls.find(([route]) => route === '/docs');
+    expect(docsRoute).toBeDefined();
+
+    const handler = docsRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/html');
+    expect(sendFile).toHaveBeenCalledWith('docs/index.html');
+  });
+});
+
+describe('docs HTML shell', () => {
+  it('links to the OpenAPI spec and embeds it for rendering', async () => {
+    const htmlPath = path.join(process.cwd(), 'apps/api/public/docs/index.html');
+    const html = await fs.readFile(htmlPath, 'utf8');
+
+    expect(html).toContain('spec-url="/openapi.yaml"');
+    expect(html).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..d7efd6b4d4902fe069625901366c5bf52f0c5c05
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,9 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
 });

file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..18123a1ec85b25d287d632168e318b40f130636d
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,57 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import { describe, expect, it, vi } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  it('registers /openapi.yaml to stream the repository spec', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const specRoute = get.mock.calls.find(([route]) => route === '/openapi.yaml');
+    expect(specRoute).toBeDefined();
+
+    const handler = specRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/yaml');
+    expect(sendFile).toHaveBeenCalledWith('openapi.yaml', path.resolve(process.cwd()));
+  });
+
+  it('registers /docs to serve the docs shell', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const docsRoute = get.mock.calls.find(([route]) => route === '/docs');
+    expect(docsRoute).toBeDefined();
+
+    const handler = docsRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/html');
+    expect(sendFile).toHaveBeenCalledWith('docs/index.html');
+  });
+});
+
+describe('docs HTML shell', () => {
+  it('links to the OpenAPI spec and embeds it for rendering', async () => {
+    const htmlPath = path.join(process.cwd(), 'apps/api/public/docs/index.html');
+    const html = await fs.readFile(htmlPath, 'utf8');
+
+    expect(html).toContain('spec-url="/openapi.yaml"');
+    expect(html).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..d7efd6b4d4902fe069625901366c5bf52f0c5c05
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,9 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
+    deps: {
+      inline: ['fastify', '@fastify/static'],
+    },
   },
 });


thinking
**Updating Vitest config for cleaner setup**
file update
M /var/home/rick/Development/playlist-manager/vitest.config.ts
@@ -13,5 +13,2 @@
     environment: 'node',
-    deps: {
-      inline: ['fastify', '@fastify/static'],
-    },
   },
apply_patch(auto_approved=true) exited 0 in 7ms:
Success. Updated the following files:
M vitest.config.ts
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..18123a1ec85b25d287d632168e318b40f130636d
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,57 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import { describe, expect, it, vi } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  it('registers /openapi.yaml to stream the repository spec', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const specRoute = get.mock.calls.find(([route]) => route === '/openapi.yaml');
+    expect(specRoute).toBeDefined();
+
+    const handler = specRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/yaml');
+    expect(sendFile).toHaveBeenCalledWith('openapi.yaml', path.resolve(process.cwd()));
+  });
+
+  it('registers /docs to serve the docs shell', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const docsRoute = get.mock.calls.find(([route]) => route === '/docs');
+    expect(docsRoute).toBeDefined();
+
+    const handler = docsRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/html');
+    expect(sendFile).toHaveBeenCalledWith('docs/index.html');
+  });
+});
+
+describe('docs HTML shell', () => {
+  it('links to the OpenAPI spec and embeds it for rendering', async () => {
+    const htmlPath = path.join(process.cwd(), 'apps/api/public/docs/index.html');
+    const html = await fs.readFile(htmlPath, 'utf8');
+
+    expect(html).toContain('spec-url="/openapi.yaml"');
+    expect(html).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..fb185f2243ed4fc4635a707b7c156d9fae74c70f
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,6 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
   },
 });

file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..18123a1ec85b25d287d632168e318b40f130636d
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,57 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import { describe, expect, it, vi } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  it('registers /openapi.yaml to stream the repository spec', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const specRoute = get.mock.calls.find(([route]) => route === '/openapi.yaml');
+    expect(specRoute).toBeDefined();
+
+    const handler = specRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/yaml');
+    expect(sendFile).toHaveBeenCalledWith('openapi.yaml', path.resolve(process.cwd()));
+  });
+
+  it('registers /docs to serve the docs shell', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const docsRoute = get.mock.calls.find(([route]) => route === '/docs');
+    expect(docsRoute).toBeDefined();
+
+    const handler = docsRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/html');
+    expect(sendFile).toHaveBeenCalledWith('docs/index.html');
+  });
+});
+
+describe('docs HTML shell', () => {
+  it('links to the OpenAPI spec and embeds it for rendering', async () => {
+    const htmlPath = path.join(process.cwd(), 'apps/api/public/docs/index.html');
+    const html = await fs.readFile(htmlPath, 'utf8');
+
+    expect(html).toContain('spec-url="/openapi.yaml"');
+    expect(html).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..fb185f2243ed4fc4635a707b7c156d9fae74c70f
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,6 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
   },
 });


thinking
**Running tests**
exec
bash -lc 'pnpm vitest run apps/api/src/routes/__tests__/docs.test.ts' in /var/home/rick/Development/playlist-manager exited 1 in 2.22s:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory

 RUN  v3.1.1 /var/home/rick/Development/playlist-manager

 ❯ apps/api/src/routes/__tests__/docs.test.ts (3 tests | 1 failed) 19ms
   ✓ docs routes > registers /openapi.yaml to stream the repository spec 5ms
   ✓ docs routes > registers /docs to serve the docs shell 1ms
   × docs HTML shell > links to the OpenAPI spec and embeds it for rendering 11ms
     → expected '<!doctype html>\n<html>\n  <head>\n  …' to contain 'href="/openapi.yaml"'

⎯⎯⎯⎯⎯⎯⎯ Failed Tests 1 ⎯⎯⎯⎯⎯⎯⎯

 FAIL  apps/api/src/routes/__tests__/docs.test.ts > docs HTML shell > links to the OpenAPI spec and embeds it for rendering
AssertionError: expected '<!doctype html>\n<html>\n  <head>\n  …' to contain 'href="/openapi.yaml"'

[32m- Expected[39m
[31m+ Received[39m

[32m- href="/openapi.yaml"[39m
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..18123a1ec85b25d287d632168e318b40f130636d
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,57 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import { describe, expect, it, vi } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  it('registers /openapi.yaml to stream the repository spec', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const specRoute = get.mock.calls.find(([route]) => route === '/openapi.yaml');
+    expect(specRoute).toBeDefined();
+
+    const handler = specRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/yaml');
+    expect(sendFile).toHaveBeenCalledWith('openapi.yaml', path.resolve(process.cwd()));
+  });
+
+  it('registers /docs to serve the docs shell', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const docsRoute = get.mock.calls.find(([route]) => route === '/docs');
+    expect(docsRoute).toBeDefined();
+
+    const handler = docsRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/html');
+    expect(sendFile).toHaveBeenCalledWith('docs/index.html');
+  });
+});
+
+describe('docs HTML shell', () => {
+  it('links to the OpenAPI spec and embeds it for rendering', async () => {
+    const htmlPath = path.join(process.cwd(), 'apps/api/public/docs/index.html');
+    const html = await fs.readFile(htmlPath, 'utf8');
+
+    expect(html).toContain('spec-url="/openapi.yaml"');
+    expect(html).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..fb185f2243ed4fc4635a707b7c156d9fae74c70f
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,6 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
   },
 });


thinking
**Evaluating spec compliance for JSON/YAML links**

I'm confirming whether adding a JSON route for the spec fits the existing OpenAPI spec since the instructions require links to JSON/YAML. I’m leaning toward adding both links in the docs HTML but need to verify if a JSON route is allowed or if only YAML is supported per spec-first rules. I'll check the spec file for `/openapi.json` or related paths before proceeding.
exec
bash -lc "rg \"\\/docs\" -n openapi.yaml" in /var/home/rick/Development/playlist-manager exited 1 in 233ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
file update:
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..18123a1ec85b25d287d632168e318b40f130636d
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,57 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import { describe, expect, it, vi } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  it('registers /openapi.yaml to stream the repository spec', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const specRoute = get.mock.calls.find(([route]) => route === '/openapi.yaml');
+    expect(specRoute).toBeDefined();
+
+    const handler = specRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/yaml');
+    expect(sendFile).toHaveBeenCalledWith('openapi.yaml', path.resolve(process.cwd()));
+  });
+
+  it('registers /docs to serve the docs shell', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const docsRoute = get.mock.calls.find(([route]) => route === '/docs');
+    expect(docsRoute).toBeDefined();
+
+    const handler = docsRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/html');
+    expect(sendFile).toHaveBeenCalledWith('docs/index.html');
+  });
+});
+
+describe('docs HTML shell', () => {
+  it('links to the OpenAPI spec and embeds it for rendering', async () => {
+    const htmlPath = path.join(process.cwd(), 'apps/api/public/docs/index.html');
+    const html = await fs.readFile(htmlPath, 'utf8');
+
+    expect(html).toContain('spec-url="/openapi.yaml"');
+    expect(html).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..fb185f2243ed4fc4635a707b7c156d9fae74c70f
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,6 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
   },
 });


thinking
**Updating docs HTML to link spec**
file update
M /var/home/rick/Development/playlist-manager/apps/api/public/docs/index.html
@@ -6,6 +6,58 @@
     <script type="module" src="https://unpkg.com/rapidoc/dist/rapidoc-min.js"></script>
-    <style>body{margin:0}</style>
+    <style>
+      :root {
+        font-family: system-ui, -apple-system, Segoe UI, sans-serif;
+        background: #0f172a;
+        color: #e2e8f0;
+      }
+
+      body {
+        margin: 0;
+        display: flex;
+        flex-direction: column;
+        min-height: 100vh;
+      }
+
+      .docs-toolbar {
+        display: flex;
+        align-items: center;
+        justify-content: flex-end;
+        gap: 1rem;
+        padding: 0.75rem 1.5rem;
+        background: rgba(15, 23, 42, 0.92);
+        border-bottom: 1px solid rgba(148, 163, 184, 0.25);
+      }
+
+      .docs-toolbar a {
+        text-decoration: none;
+        color: inherit;
+        font-weight: 600;
+        padding: 0.35rem 0.75rem;
+        border-radius: 0.5rem;
+        border: 1px solid rgba(148, 163, 184, 0.45);
+        transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
+      }
+
+      .docs-toolbar a:hover {
+        background: #38bdf8;
+        color: #0f172a;
+        border-color: transparent;
+      }
+
+      rapi-doc {
+        flex: 1;
+      }
+    </style>
   </head>
   <body>
-    <rapi-doc spec-url="/openapi.yaml" render-style="read" show-header="false"></rapi-doc>
+    <div class="docs-toolbar">
+      <a href="/openapi.yaml" download rel="noopener">Download OpenAPI (YAML)</a>
+    </div>
+    <rapi-doc
+      spec-url="/openapi.yaml"
+      render-style="read"
+      show-header="false"
+      sort-endpoints-by="path"
+      theme="dark"
+    ></rapi-doc>
   </body>
apply_patch(auto_approved=true) exited 0 in 7ms:
Success. Updated the following files:
M apps/api/public/docs/index.html
file update:
diff --git a/apps/api/public/docs/index.html b/apps/api/public/docs/index.html
index d533de69af6cc03db941a00c763cc16fa2c9b5ae..369e110686ae55b00af3b0b367930c73154e7e4b
--- a/apps/api/public/docs/index.html
+++ b/apps/api/public/docs/index.html
@@ -4,9 +4,61 @@
     <meta charset="utf-8" />
     <title>playlist-manager API Docs</title>
     <script type="module" src="https://unpkg.com/rapidoc/dist/rapidoc-min.js"></script>
-    <style>body{margin:0}</style>
+    <style>
+      :root {
+        font-family: system-ui, -apple-system, Segoe UI, sans-serif;
+        background: #0f172a;
+        color: #e2e8f0;
+      }
+
+      body {
+        margin: 0;
+        display: flex;
+        flex-direction: column;
+        min-height: 100vh;
+      }
+
+      .docs-toolbar {
+        display: flex;
+        align-items: center;
+        justify-content: flex-end;
+        gap: 1rem;
+        padding: 0.75rem 1.5rem;
+        background: rgba(15, 23, 42, 0.92);
+        border-bottom: 1px solid rgba(148, 163, 184, 0.25);
+      }
+
+      .docs-toolbar a {
+        text-decoration: none;
+        color: inherit;
+        font-weight: 600;
+        padding: 0.35rem 0.75rem;
+        border-radius: 0.5rem;
+        border: 1px solid rgba(148, 163, 184, 0.45);
+        transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
+      }
+
+      .docs-toolbar a:hover {
+        background: #38bdf8;
+        color: #0f172a;
+        border-color: transparent;
+      }
+
+      rapi-doc {
+        flex: 1;
+      }
+    </style>
   </head>
   <body>
-    <rapi-doc spec-url="/openapi.yaml" render-style="read" show-header="false"></rapi-doc>
+    <div class="docs-toolbar">
+      <a href="/openapi.yaml" download rel="noopener">Download OpenAPI (YAML)</a>
+    </div>
+    <rapi-doc
+      spec-url="/openapi.yaml"
+      render-style="read"
+      show-header="false"
+      sort-endpoints-by="path"
+      theme="dark"
+    ></rapi-doc>
   </body>
 </html>
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..18123a1ec85b25d287d632168e318b40f130636d
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,57 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import { describe, expect, it, vi } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  it('registers /openapi.yaml to stream the repository spec', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const specRoute = get.mock.calls.find(([route]) => route === '/openapi.yaml');
+    expect(specRoute).toBeDefined();
+
+    const handler = specRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/yaml');
+    expect(sendFile).toHaveBeenCalledWith('openapi.yaml', path.resolve(process.cwd()));
+  });
+
+  it('registers /docs to serve the docs shell', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const docsRoute = get.mock.calls.find(([route]) => route === '/docs');
+    expect(docsRoute).toBeDefined();
+
+    const handler = docsRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/html');
+    expect(sendFile).toHaveBeenCalledWith('docs/index.html');
+  });
+});
+
+describe('docs HTML shell', () => {
+  it('links to the OpenAPI spec and embeds it for rendering', async () => {
+    const htmlPath = path.join(process.cwd(), 'apps/api/public/docs/index.html');
+    const html = await fs.readFile(htmlPath, 'utf8');
+
+    expect(html).toContain('spec-url="/openapi.yaml"');
+    expect(html).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..fb185f2243ed4fc4635a707b7c156d9fae74c70f
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,6 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
   },
 });

file update:
diff --git a/apps/api/public/docs/index.html b/apps/api/public/docs/index.html
index d533de69af6cc03db941a00c763cc16fa2c9b5ae..369e110686ae55b00af3b0b367930c73154e7e4b
--- a/apps/api/public/docs/index.html
+++ b/apps/api/public/docs/index.html
@@ -4,9 +4,61 @@
     <meta charset="utf-8" />
     <title>playlist-manager API Docs</title>
     <script type="module" src="https://unpkg.com/rapidoc/dist/rapidoc-min.js"></script>
-    <style>body{margin:0}</style>
+    <style>
+      :root {
+        font-family: system-ui, -apple-system, Segoe UI, sans-serif;
+        background: #0f172a;
+        color: #e2e8f0;
+      }
+
+      body {
+        margin: 0;
+        display: flex;
+        flex-direction: column;
+        min-height: 100vh;
+      }
+
+      .docs-toolbar {
+        display: flex;
+        align-items: center;
+        justify-content: flex-end;
+        gap: 1rem;
+        padding: 0.75rem 1.5rem;
+        background: rgba(15, 23, 42, 0.92);
+        border-bottom: 1px solid rgba(148, 163, 184, 0.25);
+      }
+
+      .docs-toolbar a {
+        text-decoration: none;
+        color: inherit;
+        font-weight: 600;
+        padding: 0.35rem 0.75rem;
+        border-radius: 0.5rem;
+        border: 1px solid rgba(148, 163, 184, 0.45);
+        transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
+      }
+
+      .docs-toolbar a:hover {
+        background: #38bdf8;
+        color: #0f172a;
+        border-color: transparent;
+      }
+
+      rapi-doc {
+        flex: 1;
+      }
+    </style>
   </head>
   <body>
-    <rapi-doc spec-url="/openapi.yaml" render-style="read" show-header="false"></rapi-doc>
+    <div class="docs-toolbar">
+      <a href="/openapi.yaml" download rel="noopener">Download OpenAPI (YAML)</a>
+    </div>
+    <rapi-doc
+      spec-url="/openapi.yaml"
+      render-style="read"
+      show-header="false"
+      sort-endpoints-by="path"
+      theme="dark"
+    ></rapi-doc>
   </body>
 </html>
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..18123a1ec85b25d287d632168e318b40f130636d
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,57 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import { describe, expect, it, vi } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  it('registers /openapi.yaml to stream the repository spec', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const specRoute = get.mock.calls.find(([route]) => route === '/openapi.yaml');
+    expect(specRoute).toBeDefined();
+
+    const handler = specRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/yaml');
+    expect(sendFile).toHaveBeenCalledWith('openapi.yaml', path.resolve(process.cwd()));
+  });
+
+  it('registers /docs to serve the docs shell', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const docsRoute = get.mock.calls.find(([route]) => route === '/docs');
+    expect(docsRoute).toBeDefined();
+
+    const handler = docsRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/html');
+    expect(sendFile).toHaveBeenCalledWith('docs/index.html');
+  });
+});
+
+describe('docs HTML shell', () => {
+  it('links to the OpenAPI spec and embeds it for rendering', async () => {
+    const htmlPath = path.join(process.cwd(), 'apps/api/public/docs/index.html');
+    const html = await fs.readFile(htmlPath, 'utf8');
+
+    expect(html).toContain('spec-url="/openapi.yaml"');
+    expect(html).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..fb185f2243ed4fc4635a707b7c156d9fae74c70f
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,6 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
   },
 });


thinking
**Updating README and verifying docs route**
exec
bash -lc "sed -n '1,160p' README.md" in /var/home/rick/Development/playlist-manager succeeded in 39ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
# playlist-manager

## Spec workflow

We treat `openapi.yaml` as the source of truth for the service contract. Run these commands
before proposing spec changes:

1. `pnpm lint:api` – validates the OpenAPI 3.1 document with Redocly.
2. `pnpm gen:types` – regenerates `packages/contracts/src/api.types.ts`; rerunning the command
   should yield no diff when the spec and generated file are in sync.
3. `pnpm check:breaking` – compares the working tree spec against `HEAD:openapi.yaml` with
   Optic. The command exits non-zero when it detects a breaking change so you can spot
   incompatible edits early (set `SPEC_BASE_REF` to diff against another git ref if needed).

## Database seeding

With `DATABASE_URL` pointing at a migrated Postgres instance you can load deterministic
fixtures by running `pnpm -F @app/db prisma db seed`. The script wraps the Prisma seed in a
file update:
diff --git a/apps/api/public/docs/index.html b/apps/api/public/docs/index.html
index d533de69af6cc03db941a00c763cc16fa2c9b5ae..369e110686ae55b00af3b0b367930c73154e7e4b
--- a/apps/api/public/docs/index.html
+++ b/apps/api/public/docs/index.html
@@ -4,9 +4,61 @@
     <meta charset="utf-8" />
     <title>playlist-manager API Docs</title>
     <script type="module" src="https://unpkg.com/rapidoc/dist/rapidoc-min.js"></script>
-    <style>body{margin:0}</style>
+    <style>
+      :root {
+        font-family: system-ui, -apple-system, Segoe UI, sans-serif;
+        background: #0f172a;
+        color: #e2e8f0;
+      }
+
+      body {
+        margin: 0;
+        display: flex;
+        flex-direction: column;
+        min-height: 100vh;
+      }
+
+      .docs-toolbar {
+        display: flex;
+        align-items: center;
+        justify-content: flex-end;
+        gap: 1rem;
+        padding: 0.75rem 1.5rem;
+        background: rgba(15, 23, 42, 0.92);
+        border-bottom: 1px solid rgba(148, 163, 184, 0.25);
+      }
+
+      .docs-toolbar a {
+        text-decoration: none;
+        color: inherit;
+        font-weight: 600;
+        padding: 0.35rem 0.75rem;
+        border-radius: 0.5rem;
+        border: 1px solid rgba(148, 163, 184, 0.45);
+        transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
+      }
+
+      .docs-toolbar a:hover {
+        background: #38bdf8;
+        color: #0f172a;
+        border-color: transparent;
+      }
+
+      rapi-doc {
+        flex: 1;
+      }
+    </style>
   </head>
   <body>
-    <rapi-doc spec-url="/openapi.yaml" render-style="read" show-header="false"></rapi-doc>
+    <div class="docs-toolbar">
+      <a href="/openapi.yaml" download rel="noopener">Download OpenAPI (YAML)</a>
+    </div>
+    <rapi-doc
+      spec-url="/openapi.yaml"
+      render-style="read"
+      show-header="false"
+      sort-endpoints-by="path"
+      theme="dark"
+    ></rapi-doc>
   </body>
 </html>
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..18123a1ec85b25d287d632168e318b40f130636d
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,57 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import { describe, expect, it, vi } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  it('registers /openapi.yaml to stream the repository spec', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const specRoute = get.mock.calls.find(([route]) => route === '/openapi.yaml');
+    expect(specRoute).toBeDefined();
+
+    const handler = specRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/yaml');
+    expect(sendFile).toHaveBeenCalledWith('openapi.yaml', path.resolve(process.cwd()));
+  });
+
+  it('registers /docs to serve the docs shell', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const docsRoute = get.mock.calls.find(([route]) => route === '/docs');
+    expect(docsRoute).toBeDefined();
+
+    const handler = docsRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/html');
+    expect(sendFile).toHaveBeenCalledWith('docs/index.html');
+  });
+});
+
+describe('docs HTML shell', () => {
+  it('links to the OpenAPI spec and embeds it for rendering', async () => {
+    const htmlPath = path.join(process.cwd(), 'apps/api/public/docs/index.html');
+    const html = await fs.readFile(htmlPath, 'utf8');
+
+    expect(html).toContain('spec-url="/openapi.yaml"');
+    expect(html).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..fb185f2243ed4fc4635a707b7c156d9fae74c70f
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,6 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
   },
 });


thinking
**Adding new API docs section**
file update
M /var/home/rick/Development/playlist-manager/README.md
@@ -14,2 +14,8 @@
 
+## API docs
+
+Run `pnpm api:dev` to boot the Fastify dev server. Once the server is listening on port 3101,
+visit `http://localhost:3101/docs` for the interactive Redoc UI or download the raw OpenAPI
+definition at `http://localhost:3101/openapi.yaml`.
+
 ## Database seeding
apply_patch(auto_approved=true) exited 0 in 7ms:
Success. Updated the following files:
M README.md
file update:
diff --git a/README.md b/README.md
index 26b15ccc403fd0d11e615e4a4066ec592e8bc035..3f2bfd4026261df486b96f7f2d5928cbb3e1379c
--- a/README.md
+++ b/README.md
@@ -12,6 +12,12 @@
    Optic. The command exits non-zero when it detects a breaking change so you can spot
    incompatible edits early (set `SPEC_BASE_REF` to diff against another git ref if needed).
 
+## API docs
+
+Run `pnpm api:dev` to boot the Fastify dev server. Once the server is listening on port 3101,
+visit `http://localhost:3101/docs` for the interactive Redoc UI or download the raw OpenAPI
+definition at `http://localhost:3101/openapi.yaml`.
+
 ## Database seeding
 
 With `DATABASE_URL` pointing at a migrated Postgres instance you can load deterministic
diff --git a/apps/api/public/docs/index.html b/apps/api/public/docs/index.html
index d533de69af6cc03db941a00c763cc16fa2c9b5ae..369e110686ae55b00af3b0b367930c73154e7e4b
--- a/apps/api/public/docs/index.html
+++ b/apps/api/public/docs/index.html
@@ -4,9 +4,61 @@
     <meta charset="utf-8" />
     <title>playlist-manager API Docs</title>
     <script type="module" src="https://unpkg.com/rapidoc/dist/rapidoc-min.js"></script>
-    <style>body{margin:0}</style>
+    <style>
+      :root {
+        font-family: system-ui, -apple-system, Segoe UI, sans-serif;
+        background: #0f172a;
+        color: #e2e8f0;
+      }
+
+      body {
+        margin: 0;
+        display: flex;
+        flex-direction: column;
+        min-height: 100vh;
+      }
+
+      .docs-toolbar {
+        display: flex;
+        align-items: center;
+        justify-content: flex-end;
+        gap: 1rem;
+        padding: 0.75rem 1.5rem;
+        background: rgba(15, 23, 42, 0.92);
+        border-bottom: 1px solid rgba(148, 163, 184, 0.25);
+      }
+
+      .docs-toolbar a {
+        text-decoration: none;
+        color: inherit;
+        font-weight: 600;
+        padding: 0.35rem 0.75rem;
+        border-radius: 0.5rem;
+        border: 1px solid rgba(148, 163, 184, 0.45);
+        transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
+      }
+
+      .docs-toolbar a:hover {
+        background: #38bdf8;
+        color: #0f172a;
+        border-color: transparent;
+      }
+
+      rapi-doc {
+        flex: 1;
+      }
+    </style>
   </head>
   <body>
-    <rapi-doc spec-url="/openapi.yaml" render-style="read" show-header="false"></rapi-doc>
+    <div class="docs-toolbar">
+      <a href="/openapi.yaml" download rel="noopener">Download OpenAPI (YAML)</a>
+    </div>
+    <rapi-doc
+      spec-url="/openapi.yaml"
+      render-style="read"
+      show-header="false"
+      sort-endpoints-by="path"
+      theme="dark"
+    ></rapi-doc>
   </body>
 </html>
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..18123a1ec85b25d287d632168e318b40f130636d
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,57 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import { describe, expect, it, vi } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  it('registers /openapi.yaml to stream the repository spec', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const specRoute = get.mock.calls.find(([route]) => route === '/openapi.yaml');
+    expect(specRoute).toBeDefined();
+
+    const handler = specRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/yaml');
+    expect(sendFile).toHaveBeenCalledWith('openapi.yaml', path.resolve(process.cwd()));
+  });
+
+  it('registers /docs to serve the docs shell', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const docsRoute = get.mock.calls.find(([route]) => route === '/docs');
+    expect(docsRoute).toBeDefined();
+
+    const handler = docsRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/html');
+    expect(sendFile).toHaveBeenCalledWith('docs/index.html');
+  });
+});
+
+describe('docs HTML shell', () => {
+  it('links to the OpenAPI spec and embeds it for rendering', async () => {
+    const htmlPath = path.join(process.cwd(), 'apps/api/public/docs/index.html');
+    const html = await fs.readFile(htmlPath, 'utf8');
+
+    expect(html).toContain('spec-url="/openapi.yaml"');
+    expect(html).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..fb185f2243ed4fc4635a707b7c156d9fae74c70f
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,6 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
   },
 });

file update:
diff --git a/README.md b/README.md
index 26b15ccc403fd0d11e615e4a4066ec592e8bc035..3f2bfd4026261df486b96f7f2d5928cbb3e1379c
--- a/README.md
+++ b/README.md
@@ -12,6 +12,12 @@
    Optic. The command exits non-zero when it detects a breaking change so you can spot
    incompatible edits early (set `SPEC_BASE_REF` to diff against another git ref if needed).
 
+## API docs
+
+Run `pnpm api:dev` to boot the Fastify dev server. Once the server is listening on port 3101,
+visit `http://localhost:3101/docs` for the interactive Redoc UI or download the raw OpenAPI
+definition at `http://localhost:3101/openapi.yaml`.
+
 ## Database seeding
 
 With `DATABASE_URL` pointing at a migrated Postgres instance you can load deterministic
diff --git a/apps/api/public/docs/index.html b/apps/api/public/docs/index.html
index d533de69af6cc03db941a00c763cc16fa2c9b5ae..369e110686ae55b00af3b0b367930c73154e7e4b
--- a/apps/api/public/docs/index.html
+++ b/apps/api/public/docs/index.html
@@ -4,9 +4,61 @@
     <meta charset="utf-8" />
     <title>playlist-manager API Docs</title>
     <script type="module" src="https://unpkg.com/rapidoc/dist/rapidoc-min.js"></script>
-    <style>body{margin:0}</style>
+    <style>
+      :root {
+        font-family: system-ui, -apple-system, Segoe UI, sans-serif;
+        background: #0f172a;
+        color: #e2e8f0;
+      }
+
+      body {
+        margin: 0;
+        display: flex;
+        flex-direction: column;
+        min-height: 100vh;
+      }
+
+      .docs-toolbar {
+        display: flex;
+        align-items: center;
+        justify-content: flex-end;
+        gap: 1rem;
+        padding: 0.75rem 1.5rem;
+        background: rgba(15, 23, 42, 0.92);
+        border-bottom: 1px solid rgba(148, 163, 184, 0.25);
+      }
+
+      .docs-toolbar a {
+        text-decoration: none;
+        color: inherit;
+        font-weight: 600;
+        padding: 0.35rem 0.75rem;
+        border-radius: 0.5rem;
+        border: 1px solid rgba(148, 163, 184, 0.45);
+        transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
+      }
+
+      .docs-toolbar a:hover {
+        background: #38bdf8;
+        color: #0f172a;
+        border-color: transparent;
+      }
+
+      rapi-doc {
+        flex: 1;
+      }
+    </style>
   </head>
   <body>
-    <rapi-doc spec-url="/openapi.yaml" render-style="read" show-header="false"></rapi-doc>
+    <div class="docs-toolbar">
+      <a href="/openapi.yaml" download rel="noopener">Download OpenAPI (YAML)</a>
+    </div>
+    <rapi-doc
+      spec-url="/openapi.yaml"
+      render-style="read"
+      show-header="false"
+      sort-endpoints-by="path"
+      theme="dark"
+    ></rapi-doc>
   </body>
 </html>
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..18123a1ec85b25d287d632168e318b40f130636d
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,57 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import { describe, expect, it, vi } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  it('registers /openapi.yaml to stream the repository spec', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const specRoute = get.mock.calls.find(([route]) => route === '/openapi.yaml');
+    expect(specRoute).toBeDefined();
+
+    const handler = specRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/yaml');
+    expect(sendFile).toHaveBeenCalledWith('openapi.yaml', path.resolve(process.cwd()));
+  });
+
+  it('registers /docs to serve the docs shell', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const docsRoute = get.mock.calls.find(([route]) => route === '/docs');
+    expect(docsRoute).toBeDefined();
+
+    const handler = docsRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/html');
+    expect(sendFile).toHaveBeenCalledWith('docs/index.html');
+  });
+});
+
+describe('docs HTML shell', () => {
+  it('links to the OpenAPI spec and embeds it for rendering', async () => {
+    const htmlPath = path.join(process.cwd(), 'apps/api/public/docs/index.html');
+    const html = await fs.readFile(htmlPath, 'utf8');
+
+    expect(html).toContain('spec-url="/openapi.yaml"');
+    expect(html).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..fb185f2243ed4fc4635a707b7c156d9fae74c70f
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,6 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
   },
 });


thinking
**Verifying docs route registration and tests**
exec
bash -lc 'pnpm vitest run apps/api/src/routes/__tests__/docs.test.ts' in /var/home/rick/Development/playlist-manager succeeded in 2.12s:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory

 RUN  v3.1.1 /var/home/rick/Development/playlist-manager

 ✓ apps/api/src/routes/__tests__/docs.test.ts (3 tests) 8ms

 Test Files  1 passed (1)
      Tests  3 passed (3)
   Start at  21:40:24
   Duration  446ms (transform 48ms, setup 0ms, collect 38ms, tests 8ms, environment 0ms, prepare 81ms)

file update:
diff --git a/README.md b/README.md
index 26b15ccc403fd0d11e615e4a4066ec592e8bc035..3f2bfd4026261df486b96f7f2d5928cbb3e1379c
--- a/README.md
+++ b/README.md
@@ -12,6 +12,12 @@
    Optic. The command exits non-zero when it detects a breaking change so you can spot
    incompatible edits early (set `SPEC_BASE_REF` to diff against another git ref if needed).
 
+## API docs
+
+Run `pnpm api:dev` to boot the Fastify dev server. Once the server is listening on port 3101,
+visit `http://localhost:3101/docs` for the interactive Redoc UI or download the raw OpenAPI
+definition at `http://localhost:3101/openapi.yaml`.
+
 ## Database seeding
 
 With `DATABASE_URL` pointing at a migrated Postgres instance you can load deterministic
diff --git a/apps/api/public/docs/index.html b/apps/api/public/docs/index.html
index d533de69af6cc03db941a00c763cc16fa2c9b5ae..369e110686ae55b00af3b0b367930c73154e7e4b
--- a/apps/api/public/docs/index.html
+++ b/apps/api/public/docs/index.html
@@ -4,9 +4,61 @@
     <meta charset="utf-8" />
     <title>playlist-manager API Docs</title>
     <script type="module" src="https://unpkg.com/rapidoc/dist/rapidoc-min.js"></script>
-    <style>body{margin:0}</style>
+    <style>
+      :root {
+        font-family: system-ui, -apple-system, Segoe UI, sans-serif;
+        background: #0f172a;
+        color: #e2e8f0;
+      }
+
+      body {
+        margin: 0;
+        display: flex;
+        flex-direction: column;
+        min-height: 100vh;
+      }
+
+      .docs-toolbar {
+        display: flex;
+        align-items: center;
+        justify-content: flex-end;
+        gap: 1rem;
+        padding: 0.75rem 1.5rem;
+        background: rgba(15, 23, 42, 0.92);
+        border-bottom: 1px solid rgba(148, 163, 184, 0.25);
+      }
+
+      .docs-toolbar a {
+        text-decoration: none;
+        color: inherit;
+        font-weight: 600;
+        padding: 0.35rem 0.75rem;
+        border-radius: 0.5rem;
+        border: 1px solid rgba(148, 163, 184, 0.45);
+        transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
+      }
+
+      .docs-toolbar a:hover {
+        background: #38bdf8;
+        color: #0f172a;
+        border-color: transparent;
+      }
+
+      rapi-doc {
+        flex: 1;
+      }
+    </style>
   </head>
   <body>
-    <rapi-doc spec-url="/openapi.yaml" render-style="read" show-header="false"></rapi-doc>
+    <div class="docs-toolbar">
+      <a href="/openapi.yaml" download rel="noopener">Download OpenAPI (YAML)</a>
+    </div>
+    <rapi-doc
+      spec-url="/openapi.yaml"
+      render-style="read"
+      show-header="false"
+      sort-endpoints-by="path"
+      theme="dark"
+    ></rapi-doc>
   </body>
 </html>
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..18123a1ec85b25d287d632168e318b40f130636d
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,57 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import { describe, expect, it, vi } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  it('registers /openapi.yaml to stream the repository spec', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const specRoute = get.mock.calls.find(([route]) => route === '/openapi.yaml');
+    expect(specRoute).toBeDefined();
+
+    const handler = specRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/yaml');
+    expect(sendFile).toHaveBeenCalledWith('openapi.yaml', path.resolve(process.cwd()));
+  });
+
+  it('registers /docs to serve the docs shell', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const docsRoute = get.mock.calls.find(([route]) => route === '/docs');
+    expect(docsRoute).toBeDefined();
+
+    const handler = docsRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/html');
+    expect(sendFile).toHaveBeenCalledWith('docs/index.html');
+  });
+});
+
+describe('docs HTML shell', () => {
+  it('links to the OpenAPI spec and embeds it for rendering', async () => {
+    const htmlPath = path.join(process.cwd(), 'apps/api/public/docs/index.html');
+    const html = await fs.readFile(htmlPath, 'utf8');
+
+    expect(html).toContain('spec-url="/openapi.yaml"');
+    expect(html).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..fb185f2243ed4fc4635a707b7c156d9fae74c70f
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,6 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
   },
 });


thinking
**Updating plan progress**
Plan update
  ✓ Add route-level tests covering /openapi.yaml and /docs responses (ensure docs HTML links to spec).
  ✓ Adjust docs assets/routes to satisfy tests (add link) and update README with API docs info.
  ✓ Run relevant test suite to confirm changes pass.
file update:
diff --git a/README.md b/README.md
index 26b15ccc403fd0d11e615e4a4066ec592e8bc035..3f2bfd4026261df486b96f7f2d5928cbb3e1379c
--- a/README.md
+++ b/README.md
@@ -12,6 +12,12 @@
    Optic. The command exits non-zero when it detects a breaking change so you can spot
    incompatible edits early (set `SPEC_BASE_REF` to diff against another git ref if needed).
 
+## API docs
+
+Run `pnpm api:dev` to boot the Fastify dev server. Once the server is listening on port 3101,
+visit `http://localhost:3101/docs` for the interactive Redoc UI or download the raw OpenAPI
+definition at `http://localhost:3101/openapi.yaml`.
+
 ## Database seeding
 
 With `DATABASE_URL` pointing at a migrated Postgres instance you can load deterministic
diff --git a/apps/api/public/docs/index.html b/apps/api/public/docs/index.html
index d533de69af6cc03db941a00c763cc16fa2c9b5ae..369e110686ae55b00af3b0b367930c73154e7e4b
--- a/apps/api/public/docs/index.html
+++ b/apps/api/public/docs/index.html
@@ -4,9 +4,61 @@
     <meta charset="utf-8" />
     <title>playlist-manager API Docs</title>
     <script type="module" src="https://unpkg.com/rapidoc/dist/rapidoc-min.js"></script>
-    <style>body{margin:0}</style>
+    <style>
+      :root {
+        font-family: system-ui, -apple-system, Segoe UI, sans-serif;
+        background: #0f172a;
+        color: #e2e8f0;
+      }
+
+      body {
+        margin: 0;
+        display: flex;
+        flex-direction: column;
+        min-height: 100vh;
+      }
+
+      .docs-toolbar {
+        display: flex;
+        align-items: center;
+        justify-content: flex-end;
+        gap: 1rem;
+        padding: 0.75rem 1.5rem;
+        background: rgba(15, 23, 42, 0.92);
+        border-bottom: 1px solid rgba(148, 163, 184, 0.25);
+      }
+
+      .docs-toolbar a {
+        text-decoration: none;
+        color: inherit;
+        font-weight: 600;
+        padding: 0.35rem 0.75rem;
+        border-radius: 0.5rem;
+        border: 1px solid rgba(148, 163, 184, 0.45);
+        transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
+      }
+
+      .docs-toolbar a:hover {
+        background: #38bdf8;
+        color: #0f172a;
+        border-color: transparent;
+      }
+
+      rapi-doc {
+        flex: 1;
+      }
+    </style>
   </head>
   <body>
-    <rapi-doc spec-url="/openapi.yaml" render-style="read" show-header="false"></rapi-doc>
+    <div class="docs-toolbar">
+      <a href="/openapi.yaml" download rel="noopener">Download OpenAPI (YAML)</a>
+    </div>
+    <rapi-doc
+      spec-url="/openapi.yaml"
+      render-style="read"
+      show-header="false"
+      sort-endpoints-by="path"
+      theme="dark"
+    ></rapi-doc>
   </body>
 </html>
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..18123a1ec85b25d287d632168e318b40f130636d
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,57 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import { describe, expect, it, vi } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  it('registers /openapi.yaml to stream the repository spec', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const specRoute = get.mock.calls.find(([route]) => route === '/openapi.yaml');
+    expect(specRoute).toBeDefined();
+
+    const handler = specRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/yaml');
+    expect(sendFile).toHaveBeenCalledWith('openapi.yaml', path.resolve(process.cwd()));
+  });
+
+  it('registers /docs to serve the docs shell', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const docsRoute = get.mock.calls.find(([route]) => route === '/docs');
+    expect(docsRoute).toBeDefined();
+
+    const handler = docsRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/html');
+    expect(sendFile).toHaveBeenCalledWith('docs/index.html');
+  });
+});
+
+describe('docs HTML shell', () => {
+  it('links to the OpenAPI spec and embeds it for rendering', async () => {
+    const htmlPath = path.join(process.cwd(), 'apps/api/public/docs/index.html');
+    const html = await fs.readFile(htmlPath, 'utf8');
+
+    expect(html).toContain('spec-url="/openapi.yaml"');
+    expect(html).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..fb185f2243ed4fc4635a707b7c156d9fae74c70f
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,6 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
   },
 });


thinking
**Checking git status**
exec
bash -lc 'git status -sb' in /var/home/rick/Development/playlist-manager succeeded in 141ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
## main...origin/main [ahead 10]
 M README.md
 M apps/api/public/docs/index.html
 M vitest.config.ts
?? apps/api/src/config/env.ts
?? apps/api/src/lib/crypto/
?? apps/api/src/lib/openapi/
?? apps/api/src/middleware.ts
?? apps/api/src/routes/__tests__/docs.test.ts
?? codex.toml
?? codex/LOGS/codex_run_2025-11-05_20-47-49.log
?? codex/LOGS/tasklog_03c_token_encryption_at_rest_1762393669.log
?? codex/LOGS/tasklog_03c_token_encryption_at_rest_1762393669.log.done
?? codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log
?? codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log.done
?? codex/LOGS/tasklog_04b_openapi_warning_silencer_1762396211.log
?? codex/LOGS/tasklog_04b_openapi_warning_silencer_1762396211.log.done
?? codex/LOGS/tasklog_04c_api_docs_ui_1762396381.log
file update:
diff --git a/README.md b/README.md
index 26b15ccc403fd0d11e615e4a4066ec592e8bc035..3f2bfd4026261df486b96f7f2d5928cbb3e1379c
--- a/README.md
+++ b/README.md
@@ -12,6 +12,12 @@
    Optic. The command exits non-zero when it detects a breaking change so you can spot
    incompatible edits early (set `SPEC_BASE_REF` to diff against another git ref if needed).
 
+## API docs
+
+Run `pnpm api:dev` to boot the Fastify dev server. Once the server is listening on port 3101,
+visit `http://localhost:3101/docs` for the interactive Redoc UI or download the raw OpenAPI
+definition at `http://localhost:3101/openapi.yaml`.
+
 ## Database seeding
 
 With `DATABASE_URL` pointing at a migrated Postgres instance you can load deterministic
diff --git a/apps/api/public/docs/index.html b/apps/api/public/docs/index.html
index d533de69af6cc03db941a00c763cc16fa2c9b5ae..369e110686ae55b00af3b0b367930c73154e7e4b
--- a/apps/api/public/docs/index.html
+++ b/apps/api/public/docs/index.html
@@ -4,9 +4,61 @@
     <meta charset="utf-8" />
     <title>playlist-manager API Docs</title>
     <script type="module" src="https://unpkg.com/rapidoc/dist/rapidoc-min.js"></script>
-    <style>body{margin:0}</style>
+    <style>
+      :root {
+        font-family: system-ui, -apple-system, Segoe UI, sans-serif;
+        background: #0f172a;
+        color: #e2e8f0;
+      }
+
+      body {
+        margin: 0;
+        display: flex;
+        flex-direction: column;
+        min-height: 100vh;
+      }
+
+      .docs-toolbar {
+        display: flex;
+        align-items: center;
+        justify-content: flex-end;
+        gap: 1rem;
+        padding: 0.75rem 1.5rem;
+        background: rgba(15, 23, 42, 0.92);
+        border-bottom: 1px solid rgba(148, 163, 184, 0.25);
+      }
+
+      .docs-toolbar a {
+        text-decoration: none;
+        color: inherit;
+        font-weight: 600;
+        padding: 0.35rem 0.75rem;
+        border-radius: 0.5rem;
+        border: 1px solid rgba(148, 163, 184, 0.45);
+        transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
+      }
+
+      .docs-toolbar a:hover {
+        background: #38bdf8;
+        color: #0f172a;
+        border-color: transparent;
+      }
+
+      rapi-doc {
+        flex: 1;
+      }
+    </style>
   </head>
   <body>
-    <rapi-doc spec-url="/openapi.yaml" render-style="read" show-header="false"></rapi-doc>
+    <div class="docs-toolbar">
+      <a href="/openapi.yaml" download rel="noopener">Download OpenAPI (YAML)</a>
+    </div>
+    <rapi-doc
+      spec-url="/openapi.yaml"
+      render-style="read"
+      show-header="false"
+      sort-endpoints-by="path"
+      theme="dark"
+    ></rapi-doc>
   </body>
 </html>
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..18123a1ec85b25d287d632168e318b40f130636d
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,57 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import { describe, expect, it, vi } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  it('registers /openapi.yaml to stream the repository spec', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const specRoute = get.mock.calls.find(([route]) => route === '/openapi.yaml');
+    expect(specRoute).toBeDefined();
+
+    const handler = specRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/yaml');
+    expect(sendFile).toHaveBeenCalledWith('openapi.yaml', path.resolve(process.cwd()));
+  });
+
+  it('registers /docs to serve the docs shell', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const docsRoute = get.mock.calls.find(([route]) => route === '/docs');
+    expect(docsRoute).toBeDefined();
+
+    const handler = docsRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/html');
+    expect(sendFile).toHaveBeenCalledWith('docs/index.html');
+  });
+});
+
+describe('docs HTML shell', () => {
+  it('links to the OpenAPI spec and embeds it for rendering', async () => {
+    const htmlPath = path.join(process.cwd(), 'apps/api/public/docs/index.html');
+    const html = await fs.readFile(htmlPath, 'utf8');
+
+    expect(html).toContain('spec-url="/openapi.yaml"');
+    expect(html).toContain('href="/openapi.yaml"');
+  });
+});
diff --git a/vitest.config.ts b/vitest.config.ts
index 5054c08d4e39ddcf21f2e30f767f6e334acdc45d..fb185f2243ed4fc4635a707b7c156d9fae74c70f
--- a/vitest.config.ts
+++ b/vitest.config.ts
@@ -10,5 +10,6 @@
     ],
     testTimeout: 30000,
     pool: 'threads',
+    environment: 'node',
   },
 });


thinking
**Reviewing untracked files and config changes**
file update
M /var/home/rick/Development/playlist-manager/vitest.config.ts
@@ -12,3 +12,2 @@
     pool: 'threads',
-    environment: 'node',
   },
apply_patch(auto_approved=true) exited 0 in 10ms:
Success. Updated the following files:
M vitest.config.ts
file update:
diff --git a/README.md b/README.md
index 26b15ccc403fd0d11e615e4a4066ec592e8bc035..3f2bfd4026261df486b96f7f2d5928cbb3e1379c
--- a/README.md
+++ b/README.md
@@ -12,6 +12,12 @@
    Optic. The command exits non-zero when it detects a breaking change so you can spot
    incompatible edits early (set `SPEC_BASE_REF` to diff against another git ref if needed).
 
+## API docs
+
+Run `pnpm api:dev` to boot the Fastify dev server. Once the server is listening on port 3101,
+visit `http://localhost:3101/docs` for the interactive Redoc UI or download the raw OpenAPI
+definition at `http://localhost:3101/openapi.yaml`.
+
 ## Database seeding
 
 With `DATABASE_URL` pointing at a migrated Postgres instance you can load deterministic
diff --git a/apps/api/public/docs/index.html b/apps/api/public/docs/index.html
index d533de69af6cc03db941a00c763cc16fa2c9b5ae..369e110686ae55b00af3b0b367930c73154e7e4b
--- a/apps/api/public/docs/index.html
+++ b/apps/api/public/docs/index.html
@@ -4,9 +4,61 @@
     <meta charset="utf-8" />
     <title>playlist-manager API Docs</title>
     <script type="module" src="https://unpkg.com/rapidoc/dist/rapidoc-min.js"></script>
-    <style>body{margin:0}</style>
+    <style>
+      :root {
+        font-family: system-ui, -apple-system, Segoe UI, sans-serif;
+        background: #0f172a;
+        color: #e2e8f0;
+      }
+
+      body {
+        margin: 0;
+        display: flex;
+        flex-direction: column;
+        min-height: 100vh;
+      }
+
+      .docs-toolbar {
+        display: flex;
+        align-items: center;
+        justify-content: flex-end;
+        gap: 1rem;
+        padding: 0.75rem 1.5rem;
+        background: rgba(15, 23, 42, 0.92);
+        border-bottom: 1px solid rgba(148, 163, 184, 0.25);
+      }
+
+      .docs-toolbar a {
+        text-decoration: none;
+        color: inherit;
+        font-weight: 600;
+        padding: 0.35rem 0.75rem;
+        border-radius: 0.5rem;
+        border: 1px solid rgba(148, 163, 184, 0.45);
+        transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
+      }
+
+      .docs-toolbar a:hover {
+        background: #38bdf8;
+        color: #0f172a;
+        border-color: transparent;
+      }
+
+      rapi-doc {
+        flex: 1;
+      }
+    </style>
   </head>
   <body>
-    <rapi-doc spec-url="/openapi.yaml" render-style="read" show-header="false"></rapi-doc>
+    <div class="docs-toolbar">
+      <a href="/openapi.yaml" download rel="noopener">Download OpenAPI (YAML)</a>
+    </div>
+    <rapi-doc
+      spec-url="/openapi.yaml"
+      render-style="read"
+      show-header="false"
+      sort-endpoints-by="path"
+      theme="dark"
+    ></rapi-doc>
   </body>
 </html>
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..18123a1ec85b25d287d632168e318b40f130636d
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,57 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import { describe, expect, it, vi } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  it('registers /openapi.yaml to stream the repository spec', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const specRoute = get.mock.calls.find(([route]) => route === '/openapi.yaml');
+    expect(specRoute).toBeDefined();
+
+    const handler = specRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/yaml');
+    expect(sendFile).toHaveBeenCalledWith('openapi.yaml', path.resolve(process.cwd()));
+  });
+
+  it('registers /docs to serve the docs shell', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const docsRoute = get.mock.calls.find(([route]) => route === '/docs');
+    expect(docsRoute).toBeDefined();
+
+    const handler = docsRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/html');
+    expect(sendFile).toHaveBeenCalledWith('docs/index.html');
+  });
+});
+
+describe('docs HTML shell', () => {
+  it('links to the OpenAPI spec and embeds it for rendering', async () => {
+    const htmlPath = path.join(process.cwd(), 'apps/api/public/docs/index.html');
+    const html = await fs.readFile(htmlPath, 'utf8');
+
+    expect(html).toContain('spec-url="/openapi.yaml"');
+    expect(html).toContain('href="/openapi.yaml"');
+  });
+});

file update:
diff --git a/README.md b/README.md
index 26b15ccc403fd0d11e615e4a4066ec592e8bc035..3f2bfd4026261df486b96f7f2d5928cbb3e1379c
--- a/README.md
+++ b/README.md
@@ -12,6 +12,12 @@
    Optic. The command exits non-zero when it detects a breaking change so you can spot
    incompatible edits early (set `SPEC_BASE_REF` to diff against another git ref if needed).
 
+## API docs
+
+Run `pnpm api:dev` to boot the Fastify dev server. Once the server is listening on port 3101,
+visit `http://localhost:3101/docs` for the interactive Redoc UI or download the raw OpenAPI
+definition at `http://localhost:3101/openapi.yaml`.
+
 ## Database seeding
 
 With `DATABASE_URL` pointing at a migrated Postgres instance you can load deterministic
diff --git a/apps/api/public/docs/index.html b/apps/api/public/docs/index.html
index d533de69af6cc03db941a00c763cc16fa2c9b5ae..369e110686ae55b00af3b0b367930c73154e7e4b
--- a/apps/api/public/docs/index.html
+++ b/apps/api/public/docs/index.html
@@ -4,9 +4,61 @@
     <meta charset="utf-8" />
     <title>playlist-manager API Docs</title>
     <script type="module" src="https://unpkg.com/rapidoc/dist/rapidoc-min.js"></script>
-    <style>body{margin:0}</style>
+    <style>
+      :root {
+        font-family: system-ui, -apple-system, Segoe UI, sans-serif;
+        background: #0f172a;
+        color: #e2e8f0;
+      }
+
+      body {
+        margin: 0;
+        display: flex;
+        flex-direction: column;
+        min-height: 100vh;
+      }
+
+      .docs-toolbar {
+        display: flex;
+        align-items: center;
+        justify-content: flex-end;
+        gap: 1rem;
+        padding: 0.75rem 1.5rem;
+        background: rgba(15, 23, 42, 0.92);
+        border-bottom: 1px solid rgba(148, 163, 184, 0.25);
+      }
+
+      .docs-toolbar a {
+        text-decoration: none;
+        color: inherit;
+        font-weight: 600;
+        padding: 0.35rem 0.75rem;
+        border-radius: 0.5rem;
+        border: 1px solid rgba(148, 163, 184, 0.45);
+        transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
+      }
+
+      .docs-toolbar a:hover {
+        background: #38bdf8;
+        color: #0f172a;
+        border-color: transparent;
+      }
+
+      rapi-doc {
+        flex: 1;
+      }
+    </style>
   </head>
   <body>
-    <rapi-doc spec-url="/openapi.yaml" render-style="read" show-header="false"></rapi-doc>
+    <div class="docs-toolbar">
+      <a href="/openapi.yaml" download rel="noopener">Download OpenAPI (YAML)</a>
+    </div>
+    <rapi-doc
+      spec-url="/openapi.yaml"
+      render-style="read"
+      show-header="false"
+      sort-endpoints-by="path"
+      theme="dark"
+    ></rapi-doc>
   </body>
 </html>
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..18123a1ec85b25d287d632168e318b40f130636d
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,57 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import { describe, expect, it, vi } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  it('registers /openapi.yaml to stream the repository spec', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const specRoute = get.mock.calls.find(([route]) => route === '/openapi.yaml');
+    expect(specRoute).toBeDefined();
+
+    const handler = specRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/yaml');
+    expect(sendFile).toHaveBeenCalledWith('openapi.yaml', path.resolve(process.cwd()));
+  });
+
+  it('registers /docs to serve the docs shell', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const docsRoute = get.mock.calls.find(([route]) => route === '/docs');
+    expect(docsRoute).toBeDefined();
+
+    const handler = docsRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/html');
+    expect(sendFile).toHaveBeenCalledWith('docs/index.html');
+  });
+});
+
+describe('docs HTML shell', () => {
+  it('links to the OpenAPI spec and embeds it for rendering', async () => {
+    const htmlPath = path.join(process.cwd(), 'apps/api/public/docs/index.html');
+    const html = await fs.readFile(htmlPath, 'utf8');
+
+    expect(html).toContain('spec-url="/openapi.yaml"');
+    expect(html).toContain('href="/openapi.yaml"');
+  });
+});


thinking
**Verifying test integrity**
exec
bash -lc 'pnpm vitest run apps/api/src/routes/__tests__/docs.test.ts' in /var/home/rick/Development/playlist-manager succeeded in 2.07s:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory

 RUN  v3.1.1 /var/home/rick/Development/playlist-manager

 ✓ apps/api/src/routes/__tests__/docs.test.ts (3 tests) 8ms

 Test Files  1 passed (1)
      Tests  3 passed (3)
   Start at  21:40:44
   Duration  339ms (transform 46ms, setup 0ms, collect 35ms, tests 8ms, environment 0ms, prepare 77ms)

file update:
diff --git a/README.md b/README.md
index 26b15ccc403fd0d11e615e4a4066ec592e8bc035..3f2bfd4026261df486b96f7f2d5928cbb3e1379c
--- a/README.md
+++ b/README.md
@@ -12,6 +12,12 @@
    Optic. The command exits non-zero when it detects a breaking change so you can spot
    incompatible edits early (set `SPEC_BASE_REF` to diff against another git ref if needed).
 
+## API docs
+
+Run `pnpm api:dev` to boot the Fastify dev server. Once the server is listening on port 3101,
+visit `http://localhost:3101/docs` for the interactive Redoc UI or download the raw OpenAPI
+definition at `http://localhost:3101/openapi.yaml`.
+
 ## Database seeding
 
 With `DATABASE_URL` pointing at a migrated Postgres instance you can load deterministic
diff --git a/apps/api/public/docs/index.html b/apps/api/public/docs/index.html
index d533de69af6cc03db941a00c763cc16fa2c9b5ae..369e110686ae55b00af3b0b367930c73154e7e4b
--- a/apps/api/public/docs/index.html
+++ b/apps/api/public/docs/index.html
@@ -4,9 +4,61 @@
     <meta charset="utf-8" />
     <title>playlist-manager API Docs</title>
     <script type="module" src="https://unpkg.com/rapidoc/dist/rapidoc-min.js"></script>
-    <style>body{margin:0}</style>
+    <style>
+      :root {
+        font-family: system-ui, -apple-system, Segoe UI, sans-serif;
+        background: #0f172a;
+        color: #e2e8f0;
+      }
+
+      body {
+        margin: 0;
+        display: flex;
+        flex-direction: column;
+        min-height: 100vh;
+      }
+
+      .docs-toolbar {
+        display: flex;
+        align-items: center;
+        justify-content: flex-end;
+        gap: 1rem;
+        padding: 0.75rem 1.5rem;
+        background: rgba(15, 23, 42, 0.92);
+        border-bottom: 1px solid rgba(148, 163, 184, 0.25);
+      }
+
+      .docs-toolbar a {
+        text-decoration: none;
+        color: inherit;
+        font-weight: 600;
+        padding: 0.35rem 0.75rem;
+        border-radius: 0.5rem;
+        border: 1px solid rgba(148, 163, 184, 0.45);
+        transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
+      }
+
+      .docs-toolbar a:hover {
+        background: #38bdf8;
+        color: #0f172a;
+        border-color: transparent;
+      }
+
+      rapi-doc {
+        flex: 1;
+      }
+    </style>
   </head>
   <body>
-    <rapi-doc spec-url="/openapi.yaml" render-style="read" show-header="false"></rapi-doc>
+    <div class="docs-toolbar">
+      <a href="/openapi.yaml" download rel="noopener">Download OpenAPI (YAML)</a>
+    </div>
+    <rapi-doc
+      spec-url="/openapi.yaml"
+      render-style="read"
+      show-header="false"
+      sort-endpoints-by="path"
+      theme="dark"
+    ></rapi-doc>
   </body>
 </html>
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..18123a1ec85b25d287d632168e318b40f130636d
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,57 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import { describe, expect, it, vi } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  it('registers /openapi.yaml to stream the repository spec', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const specRoute = get.mock.calls.find(([route]) => route === '/openapi.yaml');
+    expect(specRoute).toBeDefined();
+
+    const handler = specRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/yaml');
+    expect(sendFile).toHaveBeenCalledWith('openapi.yaml', path.resolve(process.cwd()));
+  });
+
+  it('registers /docs to serve the docs shell', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const docsRoute = get.mock.calls.find(([route]) => route === '/docs');
+    expect(docsRoute).toBeDefined();
+
+    const handler = docsRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/html');
+    expect(sendFile).toHaveBeenCalledWith('docs/index.html');
+  });
+});
+
+describe('docs HTML shell', () => {
+  it('links to the OpenAPI spec and embeds it for rendering', async () => {
+    const htmlPath = path.join(process.cwd(), 'apps/api/public/docs/index.html');
+    const html = await fs.readFile(htmlPath, 'utf8');
+
+    expect(html).toContain('spec-url="/openapi.yaml"');
+    expect(html).toContain('href="/openapi.yaml"');
+  });
+});


thinking
**Checking git diff output**
exec
bash -lc 'git diff README.md apps/api/public/docs/index.html apps/api/src/routes/__tests__/docs.test.ts' in /var/home/rick/Development/playlist-manager succeeded in 41ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
diff --git a/README.md b/README.md
index 26b15cc..3f2bfd4 100644
--- a/README.md
+++ b/README.md
@@ -12,6 +12,12 @@ before proposing spec changes:
    Optic. The command exits non-zero when it detects a breaking change so you can spot
    incompatible edits early (set `SPEC_BASE_REF` to diff against another git ref if needed).
 
+## API docs
+
+Run `pnpm api:dev` to boot the Fastify dev server. Once the server is listening on port 3101,
+visit `http://localhost:3101/docs` for the interactive Redoc UI or download the raw OpenAPI
+definition at `http://localhost:3101/openapi.yaml`.
+
 ## Database seeding
 
 With `DATABASE_URL` pointing at a migrated Postgres instance you can load deterministic
diff --git a/apps/api/public/docs/index.html b/apps/api/public/docs/index.html
file update:
diff --git a/README.md b/README.md
index 26b15ccc403fd0d11e615e4a4066ec592e8bc035..3f2bfd4026261df486b96f7f2d5928cbb3e1379c
--- a/README.md
+++ b/README.md
@@ -12,6 +12,12 @@
    Optic. The command exits non-zero when it detects a breaking change so you can spot
    incompatible edits early (set `SPEC_BASE_REF` to diff against another git ref if needed).
 
+## API docs
+
+Run `pnpm api:dev` to boot the Fastify dev server. Once the server is listening on port 3101,
+visit `http://localhost:3101/docs` for the interactive Redoc UI or download the raw OpenAPI
+definition at `http://localhost:3101/openapi.yaml`.
+
 ## Database seeding
 
 With `DATABASE_URL` pointing at a migrated Postgres instance you can load deterministic
diff --git a/apps/api/public/docs/index.html b/apps/api/public/docs/index.html
index d533de69af6cc03db941a00c763cc16fa2c9b5ae..369e110686ae55b00af3b0b367930c73154e7e4b
--- a/apps/api/public/docs/index.html
+++ b/apps/api/public/docs/index.html
@@ -4,9 +4,61 @@
     <meta charset="utf-8" />
     <title>playlist-manager API Docs</title>
     <script type="module" src="https://unpkg.com/rapidoc/dist/rapidoc-min.js"></script>
-    <style>body{margin:0}</style>
+    <style>
+      :root {
+        font-family: system-ui, -apple-system, Segoe UI, sans-serif;
+        background: #0f172a;
+        color: #e2e8f0;
+      }
+
+      body {
+        margin: 0;
+        display: flex;
+        flex-direction: column;
+        min-height: 100vh;
+      }
+
+      .docs-toolbar {
+        display: flex;
+        align-items: center;
+        justify-content: flex-end;
+        gap: 1rem;
+        padding: 0.75rem 1.5rem;
+        background: rgba(15, 23, 42, 0.92);
+        border-bottom: 1px solid rgba(148, 163, 184, 0.25);
+      }
+
+      .docs-toolbar a {
+        text-decoration: none;
+        color: inherit;
+        font-weight: 600;
+        padding: 0.35rem 0.75rem;
+        border-radius: 0.5rem;
+        border: 1px solid rgba(148, 163, 184, 0.45);
+        transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
+      }
+
+      .docs-toolbar a:hover {
+        background: #38bdf8;
+        color: #0f172a;
+        border-color: transparent;
+      }
+
+      rapi-doc {
+        flex: 1;
+      }
+    </style>
   </head>
   <body>
-    <rapi-doc spec-url="/openapi.yaml" render-style="read" show-header="false"></rapi-doc>
+    <div class="docs-toolbar">
+      <a href="/openapi.yaml" download rel="noopener">Download OpenAPI (YAML)</a>
+    </div>
+    <rapi-doc
+      spec-url="/openapi.yaml"
+      render-style="read"
+      show-header="false"
+      sort-endpoints-by="path"
+      theme="dark"
+    ></rapi-doc>
   </body>
 </html>
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..18123a1ec85b25d287d632168e318b40f130636d
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,57 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import { describe, expect, it, vi } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  it('registers /openapi.yaml to stream the repository spec', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const specRoute = get.mock.calls.find(([route]) => route === '/openapi.yaml');
+    expect(specRoute).toBeDefined();
+
+    const handler = specRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/yaml');
+    expect(sendFile).toHaveBeenCalledWith('openapi.yaml', path.resolve(process.cwd()));
+  });
+
+  it('registers /docs to serve the docs shell', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const docsRoute = get.mock.calls.find(([route]) => route === '/docs');
+    expect(docsRoute).toBeDefined();
+
+    const handler = docsRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/html');
+    expect(sendFile).toHaveBeenCalledWith('docs/index.html');
+  });
+});
+
+describe('docs HTML shell', () => {
+  it('links to the OpenAPI spec and embeds it for rendering', async () => {
+    const htmlPath = path.join(process.cwd(), 'apps/api/public/docs/index.html');
+    const html = await fs.readFile(htmlPath, 'utf8');
+
+    expect(html).toContain('spec-url="/openapi.yaml"');
+    expect(html).toContain('href="/openapi.yaml"');
+  });
+});


thinking
**Adding diff for test file**
exec
bash -lc 'git diff apps/api/src/routes/__tests__/docs.test.ts' in /var/home/rick/Development/playlist-manager succeeded in 41ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
file update:
diff --git a/README.md b/README.md
index 26b15ccc403fd0d11e615e4a4066ec592e8bc035..3f2bfd4026261df486b96f7f2d5928cbb3e1379c
--- a/README.md
+++ b/README.md
@@ -12,6 +12,12 @@
    Optic. The command exits non-zero when it detects a breaking change so you can spot
    incompatible edits early (set `SPEC_BASE_REF` to diff against another git ref if needed).
 
+## API docs
+
+Run `pnpm api:dev` to boot the Fastify dev server. Once the server is listening on port 3101,
+visit `http://localhost:3101/docs` for the interactive Redoc UI or download the raw OpenAPI
+definition at `http://localhost:3101/openapi.yaml`.
+
 ## Database seeding
 
 With `DATABASE_URL` pointing at a migrated Postgres instance you can load deterministic
diff --git a/apps/api/public/docs/index.html b/apps/api/public/docs/index.html
index d533de69af6cc03db941a00c763cc16fa2c9b5ae..369e110686ae55b00af3b0b367930c73154e7e4b
--- a/apps/api/public/docs/index.html
+++ b/apps/api/public/docs/index.html
@@ -4,9 +4,61 @@
     <meta charset="utf-8" />
     <title>playlist-manager API Docs</title>
     <script type="module" src="https://unpkg.com/rapidoc/dist/rapidoc-min.js"></script>
-    <style>body{margin:0}</style>
+    <style>
+      :root {
+        font-family: system-ui, -apple-system, Segoe UI, sans-serif;
+        background: #0f172a;
+        color: #e2e8f0;
+      }
+
+      body {
+        margin: 0;
+        display: flex;
+        flex-direction: column;
+        min-height: 100vh;
+      }
+
+      .docs-toolbar {
+        display: flex;
+        align-items: center;
+        justify-content: flex-end;
+        gap: 1rem;
+        padding: 0.75rem 1.5rem;
+        background: rgba(15, 23, 42, 0.92);
+        border-bottom: 1px solid rgba(148, 163, 184, 0.25);
+      }
+
+      .docs-toolbar a {
+        text-decoration: none;
+        color: inherit;
+        font-weight: 600;
+        padding: 0.35rem 0.75rem;
+        border-radius: 0.5rem;
+        border: 1px solid rgba(148, 163, 184, 0.45);
+        transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
+      }
+
+      .docs-toolbar a:hover {
+        background: #38bdf8;
+        color: #0f172a;
+        border-color: transparent;
+      }
+
+      rapi-doc {
+        flex: 1;
+      }
+    </style>
   </head>
   <body>
-    <rapi-doc spec-url="/openapi.yaml" render-style="read" show-header="false"></rapi-doc>
+    <div class="docs-toolbar">
+      <a href="/openapi.yaml" download rel="noopener">Download OpenAPI (YAML)</a>
+    </div>
+    <rapi-doc
+      spec-url="/openapi.yaml"
+      render-style="read"
+      show-header="false"
+      sort-endpoints-by="path"
+      theme="dark"
+    ></rapi-doc>
   </body>
 </html>
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..18123a1ec85b25d287d632168e318b40f130636d
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,57 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import { describe, expect, it, vi } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  it('registers /openapi.yaml to stream the repository spec', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const specRoute = get.mock.calls.find(([route]) => route === '/openapi.yaml');
+    expect(specRoute).toBeDefined();
+
+    const handler = specRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/yaml');
+    expect(sendFile).toHaveBeenCalledWith('openapi.yaml', path.resolve(process.cwd()));
+  });
+
+  it('registers /docs to serve the docs shell', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const docsRoute = get.mock.calls.find(([route]) => route === '/docs');
+    expect(docsRoute).toBeDefined();
+
+    const handler = docsRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/html');
+    expect(sendFile).toHaveBeenCalledWith('docs/index.html');
+  });
+});
+
+describe('docs HTML shell', () => {
+  it('links to the OpenAPI spec and embeds it for rendering', async () => {
+    const htmlPath = path.join(process.cwd(), 'apps/api/public/docs/index.html');
+    const html = await fs.readFile(htmlPath, 'utf8');
+
+    expect(html).toContain('spec-url="/openapi.yaml"');
+    expect(html).toContain('href="/openapi.yaml"');
+  });
+});


thinking
**Checking untracked new test file**
exec
bash -lc 'nl -ba apps/api/src/routes/__tests__/docs.test.ts' in /var/home/rick/Development/playlist-manager succeeded in 66ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
     1	import { promises as fs } from 'node:fs';
     2	import path from 'node:path';
     3	import { describe, expect, it, vi } from 'vitest';
     4	
     5	import docsRoutes from '../docs';
     6	
     7	describe('docs routes', () => {
     8	  it('registers /openapi.yaml to stream the repository spec', async () => {
     9	    const get = vi.fn();
    10	    const app = { get } as any;
    11	
    12	    await docsRoutes(app);
    13	
    14	    const specRoute = get.mock.calls.find(([route]) => route === '/openapi.yaml');
    15	    expect(specRoute).toBeDefined();
    16	
    17	    const handler = specRoute?.[1];
    18	    expect(typeof handler).toBe('function');
file update:
diff --git a/README.md b/README.md
index 26b15ccc403fd0d11e615e4a4066ec592e8bc035..3f2bfd4026261df486b96f7f2d5928cbb3e1379c
--- a/README.md
+++ b/README.md
@@ -12,6 +12,12 @@
    Optic. The command exits non-zero when it detects a breaking change so you can spot
    incompatible edits early (set `SPEC_BASE_REF` to diff against another git ref if needed).
 
+## API docs
+
+Run `pnpm api:dev` to boot the Fastify dev server. Once the server is listening on port 3101,
+visit `http://localhost:3101/docs` for the interactive Redoc UI or download the raw OpenAPI
+definition at `http://localhost:3101/openapi.yaml`.
+
 ## Database seeding
 
 With `DATABASE_URL` pointing at a migrated Postgres instance you can load deterministic
diff --git a/apps/api/public/docs/index.html b/apps/api/public/docs/index.html
index d533de69af6cc03db941a00c763cc16fa2c9b5ae..369e110686ae55b00af3b0b367930c73154e7e4b
--- a/apps/api/public/docs/index.html
+++ b/apps/api/public/docs/index.html
@@ -4,9 +4,61 @@
     <meta charset="utf-8" />
     <title>playlist-manager API Docs</title>
     <script type="module" src="https://unpkg.com/rapidoc/dist/rapidoc-min.js"></script>
-    <style>body{margin:0}</style>
+    <style>
+      :root {
+        font-family: system-ui, -apple-system, Segoe UI, sans-serif;
+        background: #0f172a;
+        color: #e2e8f0;
+      }
+
+      body {
+        margin: 0;
+        display: flex;
+        flex-direction: column;
+        min-height: 100vh;
+      }
+
+      .docs-toolbar {
+        display: flex;
+        align-items: center;
+        justify-content: flex-end;
+        gap: 1rem;
+        padding: 0.75rem 1.5rem;
+        background: rgba(15, 23, 42, 0.92);
+        border-bottom: 1px solid rgba(148, 163, 184, 0.25);
+      }
+
+      .docs-toolbar a {
+        text-decoration: none;
+        color: inherit;
+        font-weight: 600;
+        padding: 0.35rem 0.75rem;
+        border-radius: 0.5rem;
+        border: 1px solid rgba(148, 163, 184, 0.45);
+        transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
+      }
+
+      .docs-toolbar a:hover {
+        background: #38bdf8;
+        color: #0f172a;
+        border-color: transparent;
+      }
+
+      rapi-doc {
+        flex: 1;
+      }
+    </style>
   </head>
   <body>
-    <rapi-doc spec-url="/openapi.yaml" render-style="read" show-header="false"></rapi-doc>
+    <div class="docs-toolbar">
+      <a href="/openapi.yaml" download rel="noopener">Download OpenAPI (YAML)</a>
+    </div>
+    <rapi-doc
+      spec-url="/openapi.yaml"
+      render-style="read"
+      show-header="false"
+      sort-endpoints-by="path"
+      theme="dark"
+    ></rapi-doc>
   </body>
 </html>
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..18123a1ec85b25d287d632168e318b40f130636d
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,57 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import { describe, expect, it, vi } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  it('registers /openapi.yaml to stream the repository spec', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const specRoute = get.mock.calls.find(([route]) => route === '/openapi.yaml');
+    expect(specRoute).toBeDefined();
+
+    const handler = specRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/yaml');
+    expect(sendFile).toHaveBeenCalledWith('openapi.yaml', path.resolve(process.cwd()));
+  });
+
+  it('registers /docs to serve the docs shell', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const docsRoute = get.mock.calls.find(([route]) => route === '/docs');
+    expect(docsRoute).toBeDefined();
+
+    const handler = docsRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/html');
+    expect(sendFile).toHaveBeenCalledWith('docs/index.html');
+  });
+});
+
+describe('docs HTML shell', () => {
+  it('links to the OpenAPI spec and embeds it for rendering', async () => {
+    const htmlPath = path.join(process.cwd(), 'apps/api/public/docs/index.html');
+    const html = await fs.readFile(htmlPath, 'utf8');
+
+    expect(html).toContain('spec-url="/openapi.yaml"');
+    expect(html).toContain('href="/openapi.yaml"');
+  });
+});


thinking
**Preparing detailed final message**

I’m organizing the final message to explain the change clearly with bullet points referencing precise file paths and line numbers, highlighting tests run with vitest to verify new functionality, and noting the TDD approach followed. I'll also consider mentioning next steps if appropriate.
exec
bash -lc 'nl -ba apps/api/public/docs/index.html' in /var/home/rick/Development/playlist-manager succeeded in 40ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
     1	<!doctype html>
     2	<html>
     3	  <head>
     4	    <meta charset="utf-8" />
     5	    <title>playlist-manager API Docs</title>
     6	    <script type="module" src="https://unpkg.com/rapidoc/dist/rapidoc-min.js"></script>
     7	    <style>
     8	      :root {
     9	        font-family: system-ui, -apple-system, Segoe UI, sans-serif;
    10	        background: #0f172a;
    11	        color: #e2e8f0;
    12	      }
    13	
    14	      body {
    15	        margin: 0;
    16	        display: flex;
    17	        flex-direction: column;
    18	        min-height: 100vh;
file update:
diff --git a/README.md b/README.md
index 26b15ccc403fd0d11e615e4a4066ec592e8bc035..3f2bfd4026261df486b96f7f2d5928cbb3e1379c
--- a/README.md
+++ b/README.md
@@ -12,6 +12,12 @@
    Optic. The command exits non-zero when it detects a breaking change so you can spot
    incompatible edits early (set `SPEC_BASE_REF` to diff against another git ref if needed).
 
+## API docs
+
+Run `pnpm api:dev` to boot the Fastify dev server. Once the server is listening on port 3101,
+visit `http://localhost:3101/docs` for the interactive Redoc UI or download the raw OpenAPI
+definition at `http://localhost:3101/openapi.yaml`.
+
 ## Database seeding
 
 With `DATABASE_URL` pointing at a migrated Postgres instance you can load deterministic
diff --git a/apps/api/public/docs/index.html b/apps/api/public/docs/index.html
index d533de69af6cc03db941a00c763cc16fa2c9b5ae..369e110686ae55b00af3b0b367930c73154e7e4b
--- a/apps/api/public/docs/index.html
+++ b/apps/api/public/docs/index.html
@@ -4,9 +4,61 @@
     <meta charset="utf-8" />
     <title>playlist-manager API Docs</title>
     <script type="module" src="https://unpkg.com/rapidoc/dist/rapidoc-min.js"></script>
-    <style>body{margin:0}</style>
+    <style>
+      :root {
+        font-family: system-ui, -apple-system, Segoe UI, sans-serif;
+        background: #0f172a;
+        color: #e2e8f0;
+      }
+
+      body {
+        margin: 0;
+        display: flex;
+        flex-direction: column;
+        min-height: 100vh;
+      }
+
+      .docs-toolbar {
+        display: flex;
+        align-items: center;
+        justify-content: flex-end;
+        gap: 1rem;
+        padding: 0.75rem 1.5rem;
+        background: rgba(15, 23, 42, 0.92);
+        border-bottom: 1px solid rgba(148, 163, 184, 0.25);
+      }
+
+      .docs-toolbar a {
+        text-decoration: none;
+        color: inherit;
+        font-weight: 600;
+        padding: 0.35rem 0.75rem;
+        border-radius: 0.5rem;
+        border: 1px solid rgba(148, 163, 184, 0.45);
+        transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
+      }
+
+      .docs-toolbar a:hover {
+        background: #38bdf8;
+        color: #0f172a;
+        border-color: transparent;
+      }
+
+      rapi-doc {
+        flex: 1;
+      }
+    </style>
   </head>
   <body>
-    <rapi-doc spec-url="/openapi.yaml" render-style="read" show-header="false"></rapi-doc>
+    <div class="docs-toolbar">
+      <a href="/openapi.yaml" download rel="noopener">Download OpenAPI (YAML)</a>
+    </div>
+    <rapi-doc
+      spec-url="/openapi.yaml"
+      render-style="read"
+      show-header="false"
+      sort-endpoints-by="path"
+      theme="dark"
+    ></rapi-doc>
   </body>
 </html>
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..18123a1ec85b25d287d632168e318b40f130636d
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,57 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import { describe, expect, it, vi } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  it('registers /openapi.yaml to stream the repository spec', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const specRoute = get.mock.calls.find(([route]) => route === '/openapi.yaml');
+    expect(specRoute).toBeDefined();
+
+    const handler = specRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/yaml');
+    expect(sendFile).toHaveBeenCalledWith('openapi.yaml', path.resolve(process.cwd()));
+  });
+
+  it('registers /docs to serve the docs shell', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const docsRoute = get.mock.calls.find(([route]) => route === '/docs');
+    expect(docsRoute).toBeDefined();
+
+    const handler = docsRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/html');
+    expect(sendFile).toHaveBeenCalledWith('docs/index.html');
+  });
+});
+
+describe('docs HTML shell', () => {
+  it('links to the OpenAPI spec and embeds it for rendering', async () => {
+    const htmlPath = path.join(process.cwd(), 'apps/api/public/docs/index.html');
+    const html = await fs.readFile(htmlPath, 'utf8');
+
+    expect(html).toContain('spec-url="/openapi.yaml"');
+    expect(html).toContain('href="/openapi.yaml"');
+  });
+});


thinking
**Adding line numbers to README**
exec
bash -lc "nl -ba README.md | sed -n '1,80p'" in /var/home/rick/Development/playlist-manager succeeded in 43ms:
/home/rick/.bashrc: line 30: /home/rick/.config/broot/launcher/bash/br: No such file or directory
/home/rick/.bash_profile: line 10: /home/rick/.config/broot/launcher/bash/br: No such file or directory
     1	# playlist-manager
     2	
     3	## Spec workflow
     4	
     5	We treat `openapi.yaml` as the source of truth for the service contract. Run these commands
     6	before proposing spec changes:
     7	
     8	1. `pnpm lint:api` – validates the OpenAPI 3.1 document with Redocly.
     9	2. `pnpm gen:types` – regenerates `packages/contracts/src/api.types.ts`; rerunning the command
    10	   should yield no diff when the spec and generated file are in sync.
    11	3. `pnpm check:breaking` – compares the working tree spec against `HEAD:openapi.yaml` with
    12	   Optic. The command exits non-zero when it detects a breaking change so you can spot
    13	   incompatible edits early (set `SPEC_BASE_REF` to diff against another git ref if needed).
    14	
    15	## API docs
    16	
    17	Run `pnpm api:dev` to boot the Fastify dev server. Once the server is listening on port 3101,
    18	visit `http://localhost:3101/docs` for the interactive Redoc UI or download the raw OpenAPI
file update:
diff --git a/README.md b/README.md
index 26b15ccc403fd0d11e615e4a4066ec592e8bc035..3f2bfd4026261df486b96f7f2d5928cbb3e1379c
--- a/README.md
+++ b/README.md
@@ -12,6 +12,12 @@
    Optic. The command exits non-zero when it detects a breaking change so you can spot
    incompatible edits early (set `SPEC_BASE_REF` to diff against another git ref if needed).
 
+## API docs
+
+Run `pnpm api:dev` to boot the Fastify dev server. Once the server is listening on port 3101,
+visit `http://localhost:3101/docs` for the interactive Redoc UI or download the raw OpenAPI
+definition at `http://localhost:3101/openapi.yaml`.
+
 ## Database seeding
 
 With `DATABASE_URL` pointing at a migrated Postgres instance you can load deterministic
diff --git a/apps/api/public/docs/index.html b/apps/api/public/docs/index.html
index d533de69af6cc03db941a00c763cc16fa2c9b5ae..369e110686ae55b00af3b0b367930c73154e7e4b
--- a/apps/api/public/docs/index.html
+++ b/apps/api/public/docs/index.html
@@ -4,9 +4,61 @@
     <meta charset="utf-8" />
     <title>playlist-manager API Docs</title>
     <script type="module" src="https://unpkg.com/rapidoc/dist/rapidoc-min.js"></script>
-    <style>body{margin:0}</style>
+    <style>
+      :root {
+        font-family: system-ui, -apple-system, Segoe UI, sans-serif;
+        background: #0f172a;
+        color: #e2e8f0;
+      }
+
+      body {
+        margin: 0;
+        display: flex;
+        flex-direction: column;
+        min-height: 100vh;
+      }
+
+      .docs-toolbar {
+        display: flex;
+        align-items: center;
+        justify-content: flex-end;
+        gap: 1rem;
+        padding: 0.75rem 1.5rem;
+        background: rgba(15, 23, 42, 0.92);
+        border-bottom: 1px solid rgba(148, 163, 184, 0.25);
+      }
+
+      .docs-toolbar a {
+        text-decoration: none;
+        color: inherit;
+        font-weight: 600;
+        padding: 0.35rem 0.75rem;
+        border-radius: 0.5rem;
+        border: 1px solid rgba(148, 163, 184, 0.45);
+        transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
+      }
+
+      .docs-toolbar a:hover {
+        background: #38bdf8;
+        color: #0f172a;
+        border-color: transparent;
+      }
+
+      rapi-doc {
+        flex: 1;
+      }
+    </style>
   </head>
   <body>
-    <rapi-doc spec-url="/openapi.yaml" render-style="read" show-header="false"></rapi-doc>
+    <div class="docs-toolbar">
+      <a href="/openapi.yaml" download rel="noopener">Download OpenAPI (YAML)</a>
+    </div>
+    <rapi-doc
+      spec-url="/openapi.yaml"
+      render-style="read"
+      show-header="false"
+      sort-endpoints-by="path"
+      theme="dark"
+    ></rapi-doc>
   </body>
 </html>
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..18123a1ec85b25d287d632168e318b40f130636d
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,57 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import { describe, expect, it, vi } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  it('registers /openapi.yaml to stream the repository spec', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const specRoute = get.mock.calls.find(([route]) => route === '/openapi.yaml');
+    expect(specRoute).toBeDefined();
+
+    const handler = specRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/yaml');
+    expect(sendFile).toHaveBeenCalledWith('openapi.yaml', path.resolve(process.cwd()));
+  });
+
+  it('registers /docs to serve the docs shell', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const docsRoute = get.mock.calls.find(([route]) => route === '/docs');
+    expect(docsRoute).toBeDefined();
+
+    const handler = docsRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/html');
+    expect(sendFile).toHaveBeenCalledWith('docs/index.html');
+  });
+});
+
+describe('docs HTML shell', () => {
+  it('links to the OpenAPI spec and embeds it for rendering', async () => {
+    const htmlPath = path.join(process.cwd(), 'apps/api/public/docs/index.html');
+    const html = await fs.readFile(htmlPath, 'utf8');
+
+    expect(html).toContain('spec-url="/openapi.yaml"');
+    expect(html).toContain('href="/openapi.yaml"');
+  });
+});


thinking
**Summarizing final changes and tests**

I’m preparing a concise final message that explains the new Docs UI enhancements, including a download link and added route coverage, along with README updates. I’ll list key files and line numbers with bullet points for clarity, note the Vitest test command to verify the updates, and keep it focused without extra plans or untracked file mentions. This way, the message nicely wraps up the change context and validation steps.
codex
Docs UI now exposes the raw OpenAPI spec and has regression coverage so we don’t lose the link again.

- `apps/api/src/routes/__tests__/docs.test.ts:1` adds Vitest coverage that stubs `docsRoutes` registrations, asserting the spec route streams the repo file and the HTML shell includes a link to `/openapi.yaml`.
- `apps/api/public/docs/index.html:8` introduces a lightweight toolbar plus styling and a “Download OpenAPI (YAML)” anchor while keeping the RapiDoc embed pointed at the same spec.
- `README.md:15` documents how to reach the interactive docs and raw YAML via the dev server.

Tests: `pnpm vitest run apps/api/src/routes/__tests__/docs.test.ts`
file update:
diff --git a/README.md b/README.md
index 26b15ccc403fd0d11e615e4a4066ec592e8bc035..3f2bfd4026261df486b96f7f2d5928cbb3e1379c
--- a/README.md
+++ b/README.md
@@ -12,6 +12,12 @@
    Optic. The command exits non-zero when it detects a breaking change so you can spot
    incompatible edits early (set `SPEC_BASE_REF` to diff against another git ref if needed).
 
+## API docs
+
+Run `pnpm api:dev` to boot the Fastify dev server. Once the server is listening on port 3101,
+visit `http://localhost:3101/docs` for the interactive Redoc UI or download the raw OpenAPI
+definition at `http://localhost:3101/openapi.yaml`.
+
 ## Database seeding
 
 With `DATABASE_URL` pointing at a migrated Postgres instance you can load deterministic
diff --git a/apps/api/public/docs/index.html b/apps/api/public/docs/index.html
index d533de69af6cc03db941a00c763cc16fa2c9b5ae..369e110686ae55b00af3b0b367930c73154e7e4b
--- a/apps/api/public/docs/index.html
+++ b/apps/api/public/docs/index.html
@@ -4,9 +4,61 @@
     <meta charset="utf-8" />
     <title>playlist-manager API Docs</title>
     <script type="module" src="https://unpkg.com/rapidoc/dist/rapidoc-min.js"></script>
-    <style>body{margin:0}</style>
+    <style>
+      :root {
+        font-family: system-ui, -apple-system, Segoe UI, sans-serif;
+        background: #0f172a;
+        color: #e2e8f0;
+      }
+
+      body {
+        margin: 0;
+        display: flex;
+        flex-direction: column;
+        min-height: 100vh;
+      }
+
+      .docs-toolbar {
+        display: flex;
+        align-items: center;
+        justify-content: flex-end;
+        gap: 1rem;
+        padding: 0.75rem 1.5rem;
+        background: rgba(15, 23, 42, 0.92);
+        border-bottom: 1px solid rgba(148, 163, 184, 0.25);
+      }
+
+      .docs-toolbar a {
+        text-decoration: none;
+        color: inherit;
+        font-weight: 600;
+        padding: 0.35rem 0.75rem;
+        border-radius: 0.5rem;
+        border: 1px solid rgba(148, 163, 184, 0.45);
+        transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
+      }
+
+      .docs-toolbar a:hover {
+        background: #38bdf8;
+        color: #0f172a;
+        border-color: transparent;
+      }
+
+      rapi-doc {
+        flex: 1;
+      }
+    </style>
   </head>
   <body>
-    <rapi-doc spec-url="/openapi.yaml" render-style="read" show-header="false"></rapi-doc>
+    <div class="docs-toolbar">
+      <a href="/openapi.yaml" download rel="noopener">Download OpenAPI (YAML)</a>
+    </div>
+    <rapi-doc
+      spec-url="/openapi.yaml"
+      render-style="read"
+      show-header="false"
+      sort-endpoints-by="path"
+      theme="dark"
+    ></rapi-doc>
   </body>
 </html>
diff --git a/apps/api/src/routes/__tests__/docs.test.ts b/apps/api/src/routes/__tests__/docs.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..18123a1ec85b25d287d632168e318b40f130636d
--- /dev/null
+++ b/apps/api/src/routes/__tests__/docs.test.ts
@@ -0,0 +1,57 @@
+import { promises as fs } from 'node:fs';
+import path from 'node:path';
+import { describe, expect, it, vi } from 'vitest';
+
+import docsRoutes from '../docs';
+
+describe('docs routes', () => {
+  it('registers /openapi.yaml to stream the repository spec', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const specRoute = get.mock.calls.find(([route]) => route === '/openapi.yaml');
+    expect(specRoute).toBeDefined();
+
+    const handler = specRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/yaml');
+    expect(sendFile).toHaveBeenCalledWith('openapi.yaml', path.resolve(process.cwd()));
+  });
+
+  it('registers /docs to serve the docs shell', async () => {
+    const get = vi.fn();
+    const app = { get } as any;
+
+    await docsRoutes(app);
+
+    const docsRoute = get.mock.calls.find(([route]) => route === '/docs');
+    expect(docsRoute).toBeDefined();
+
+    const handler = docsRoute?.[1];
+    expect(typeof handler).toBe('function');
+
+    const type = vi.fn().mockReturnThis();
+    const sendFile = vi.fn();
+    await handler?.({}, { type, sendFile });
+
+    expect(type).toHaveBeenCalledWith('text/html');
+    expect(sendFile).toHaveBeenCalledWith('docs/index.html');
+  });
+});
+
+describe('docs HTML shell', () => {
+  it('links to the OpenAPI spec and embeds it for rendering', async () => {
+    const htmlPath = path.join(process.cwd(), 'apps/api/public/docs/index.html');
+    const html = await fs.readFile(htmlPath, 'utf8');
+
+    expect(html).toContain('spec-url="/openapi.yaml"');
+    expect(html).toContain('href="/openapi.yaml"');
+  });
+});

tokens used
127,264
Docs UI now exposes the raw OpenAPI spec and has regression coverage so we don’t lose the link again.

- `apps/api/src/routes/__tests__/docs.test.ts:1` adds Vitest coverage that stubs `docsRoutes` registrations, asserting the spec route streams the repo file and the HTML shell includes a link to `/openapi.yaml`.
- `apps/api/public/docs/index.html:8` introduces a lightweight toolbar plus styling and a “Download OpenAPI (YAML)” anchor while keeping the RapiDoc embed pointed at the same spec.
- `README.md:15` documents how to reach the interactive docs and raw YAML via the dev server.

Tests: `pnpm vitest run apps/api/src/routes/__tests__/docs.test.ts`
