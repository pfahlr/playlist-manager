OpenAI Codex v0.58.0 (research preview)
--------
workdir: /var/home/rick/Development/playlist-manager
model: gpt-5.1-codex
provider: openai
approval: never
sandbox: workspace-write [workdir, /tmp, $TMPDIR]
reasoning effort: high
reasoning summaries: auto
session id: 019a8d01-e0a9-7c02-9aef-9fe152b6a59d
--------
user
Implement the functionality described in codex/TASKS/07c_error_contracts.yaml, then verify with any available tests.
ERROR: MCP client for `arxiv-mcp-server-gpt` failed to start: handshaking with MCP server failed: connection closed: initialize response

thinking
**Preparing to inspect task file**
exec
bash -lc ls in /var/home/rick/Development/playlist-manager succeeded in 38ms:
AGENTS.md
apps
codex
codex.toml
docker-compose.yml
docs
dredd.server.yml
dredd.yml
env.json
Jackett
Jackett.Binaries.LinuxAMDx64.tar.gz
node_modules
openapi.dredd.yaml
openapi.yaml
package.json
packages
pnpm-lock.yaml
pnpm-workspace.yaml
README.md
schemas

thinking
**Viewing error contracts file**
exec
bash -lc "sed -n '1,200p' codex/TASKS/07c_error_contracts.yaml" in /var/home/rick/Development/playlist-manager succeeded in 38ms:
id: 07c_error_contracts
title: Unified error schema + server wiring
branch: codex/07c_error_contracts
overview: >
  Define a single error envelope (type, code, message, details) in OpenAPI and ensure
  all handlers use it. Add BadRequest/Unauthorized/NotFound/TooManyRequests components.
acceptance:
  - All 4xx/5xx responses conform to components/schemas/Error
  - Dredd + Schemathesis pass with error examples
  - Server returns correlation/request-id in error responses
artifacts_to_touch:
  - openapi.yaml (components.schemas.Error + components.responses.*)
  - apps/api/src/plugins/errors.ts
  - apps/api/src/dev/start.ts (register plugin)
steps:
  - Add schema + responses in OpenAPI; add examples
  - Implement Fastify error handler mapping known errors to codes
  - Ensure request-id header is echoed in error response meta/details

thinking
**Planning spec and test updates**
exec
bash -lc 'ls apps/api' in /var/home/rick/Development/playlist-manager succeeded in 39ms:
public
src

thinking
**Inspecting source directory**
exec
bash -lc 'ls apps/api/src' in /var/home/rick/Development/playlist-manager succeeded in 38ms:
config
dev
lib
middleware.ts
plugins
routes
testServer.ts

thinking
**Checking for plugin errors**
exec
bash -lc "sed -n '1,200p' apps/api/src/plugins/errors.ts" in /var/home/rick/Development/playlist-manager succeeded in 38ms:
import fp from 'fastify-plugin';
import { nanoid } from 'nanoid';

import { toProblemBody } from '../lib/problem';

export default fp(async (app) => {
  app.addHook('onRequest', async (req) => {
    (req as any).requestId = req.headers['x-request-id'] || nanoid();
  });

  app.setNotFoundHandler((req, reply) => {
    const status = 404;
    const body = toProblemBody({
      status,
      code: 'not_found',
      message: `Route ${req.method}:${req.url} not found`,
      details: null,
      requestId: (req as any).requestId ?? null,
    });
    reply.status(status).send(body);

thinking
**Checking function toProblemBody**
exec
bash -lc "sed -n '1,200p' apps/api/src/lib/problem.ts" in /var/home/rick/Development/playlist-manager succeeded in 38ms:
export type ProblemOptions = {
  status: number;
  code: string;
  message: string;
  details?: Record<string, unknown> | null;
};

export type ProblemBody = {
  type: string;
  code: string;
  message: string;
  request_id: string | null;
  details: Record<string, unknown> | null;
};

export function problem(options: ProblemOptions): Error {
  const { status, code, message, details } = options;
  const err: any = new Error(message);
  err.statusCode = status;
  err.code = code;

thinking
**Investigating error schema in OpenAPI spec**
exec
bash -lc 'rg -n "Problem" -n openapi.yaml' in /var/home/rick/Development/playlist-manager exited 1 in 39ms:


thinking
**Searching for error schema**
exec
bash -lc 'rg -n "Error" openapi.yaml' in /var/home/rick/Development/playlist-manager succeeded in 39ms:
626:          schema: { $ref: "#/components/schemas/Error" }
631:          schema: { $ref: '#/components/schemas/Error' }
636:          schema: { $ref: '#/components/schemas/Error' }
641:          schema: { $ref: '#/components/schemas/Error' }
646:          schema: { $ref: '#/components/schemas/Error' }
649:    Error:

thinking
**Scrolling through file from line 626**
exec
bash -lc "sed -n '600,700p' openapi.yaml" in /var/home/rick/Development/playlist-manager succeeded in 41ms:
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items: { $ref: '#/components/schemas/ArtistRelation' }
        '401': { $ref: '#/components/responses/Unauthorized' }
        '404': { $ref: '#/components/responses/NotFound' }

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

thinking
**Reviewing error handling standardization**
exec
bash -lc 'rg -n "request_id" -n' in /var/home/rick/Development/playlist-manager succeeded in 48ms:
openapi.yaml:656:        request_id:
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:123:  request_id: string | null;
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:178:bash -lc 'rg -n "request_id" -n' in /var/home/rick/Development/playlist-manager
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:983:  request_id: string | null;
apps/api/src/lib/openapi/openapi.json:920:          "request_id": {
apps/api/src/lib/problem.ts:12:  request_id: string | null;
apps/api/src/lib/problem.ts:33:    request_id: requestId ?? null,
packages/contracts/src/api.types.ts:224:            request_id?: string | null;
codex/LOGS/tasklog_04d_config_feature_flags_1762396882.log:504:  request_id: string | null;
codex/LOGS/tasklog_04d_config_feature_flags_1762396882.log:712:        request_id:
codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:476:  request_id: string | null;
codex/LOGS/tasklog_05c_importers_file_1762405313.log:557:  request_id: string | null;

thinking
**Planning approach for error handling and tests**
exec
bash -lc 'rg -n "not_found" -n apps/api/src' in /var/home/rick/Development/playlist-manager succeeded in 43ms:
apps/api/src/plugins/errors.ts:15:      code: 'not_found',
apps/api/src/plugins/errors.ts:26:      (err as any).code || (status === 429 ? 'rate_limited' : status === 404 ? 'not_found' : 'internal');
apps/api/src/routes/__tests__/register-handlers.test.ts:38:        code: 'not_found',

thinking
**Opening test file**
exec
bash -lc "sed -n '1,200p' apps/api/src/routes/__tests__/register-handlers.test.ts" in /var/home/rick/Development/playlist-manager succeeded in 38ms:
import fastify from 'fastify';
import { describe, it, expect } from 'vitest';

import errorsPlugin from '../../plugins/errors';
import { registerRouteHandlers } from '../register-handlers';

describe('registerRouteHandlers', () => {
  async function buildApp() {
    const app = fastify({ logger: false });
    await app.register(errorsPlugin);
    await registerRouteHandlers(app);
    await app.ready();
    return app;
  }

  it('registers playlist routes with successful response', async () => {
    const app = await buildApp();

    try {
      const response = await app.inject({ method: 'GET', url: '/playlists' });

thinking
**Planning spec and tests updates**

I’m sorting out the best order to update the OpenAPI spec and add tests—since the spec is the source of truth but test-driven development means tests should fail before code. I think I’ll update the spec first to define new error schemas and responses, then add failing tests that confirm the plugin returns the right structure including request IDs before implementing changes. I’m also looking for existing error plugin tests in `apps/api/src/plugins/__tests__/errors.test.ts` to build on.
exec
bash -lc 'ls apps/api/src/plugins' in /var/home/rick/Development/playlist-manager succeeded in 38ms:
errors.ts
feature-guard.ts
logging.ts
metrics.ts

thinking
**Planning request-id tests**
exec
bash -lc 'rg -n "x-request-id" -n' in /var/home/rick/Development/playlist-manager succeeded in 47ms:
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:94:    (req as any).requestId = req.headers['x-request-id'] || nanoid();
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:239:bash -lc 'rg -n "x-request-id" -n' in /var/home/rick/Development/playlist-manager
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:954:    (req as any).requestId = req.headers['x-request-id'] || nanoid();
codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:301:    (req as any).requestId = req.headers['x-request-id'] || nanoid();
apps/api/src/plugins/errors.ts:8:    (req as any).requestId = req.headers['x-request-id'] || nanoid();
codex/LOGS/tasklog_04d_config_feature_flags_1762396882.log:475:    (req as any).requestId = req.headers['x-request-id'] || nanoid();
codex/LOGS/tasklog_05c_importers_file_1762405313.log:528:    (req as any).requestId = req.headers['x-request-id'] || nanoid();

thinking
**Checking plugin registration location**
exec
bash -lc "sed -n '1,200p' apps/api/src/dev/start.ts" in /var/home/rick/Development/playlist-manager succeeded in 38ms:
import Fastify from 'fastify';
import fastifyStatic from '@fastify/static';
import path from 'node:path';
import docsRoutes from '../routes/docs.js'; // ensure .ts resolves via tsx; .js is ok too
import authProviders from '../routes/auth.providers.js';
import { registerRouteHandlers } from '../routes/register-handlers.js';
import logging from '../plugins/logging.js';
import metrics from '../plugins/metrics.js';
import featureGuard from '../plugins/feature-guard.js';
import errorsPlugin from '../plugins/errors.js';
import jobEvents from '../routes/jobs.events.js';
import importsFile from '../routes/imports.file.js';

const app = Fastify({ logger: true });

await app.register(fastifyStatic, {
  root: path.join(process.cwd(), 'apps/api/public'),
  prefix: '/',
});


thinking
**Verifying and updating error responses in OpenAPI**

I’m checking that the plugin registers error components like BadRequest and TooManyRequests properly, then verifying all 4xx and 5xx responses reference the unified error schema in the OpenAPI spec. I’ll search and confirm all handlers and responses align with the single error envelope format including type, code, message, and details.
exec
bash -lc 'rg -n "BadRequest" openapi.yaml' in /var/home/rick/Development/playlist-manager succeeded in 39ms:
75:        '400': { $ref: '#/components/responses/BadRequest' }
200:        '400': { $ref: '#/components/responses/BadRequest' }
235:        '400': { $ref: '#/components/responses/BadRequest' }
288:        '400': { $ref: '#/components/responses/BadRequest' }
468:        '400': { $ref: '#/components/responses/BadRequest' }
500:        '400': { $ref: '#/components/responses/BadRequest' }
523:        "400": { $ref: "#/components/responses/BadRequest" }
544:        "400": { $ref: "#/components/responses/BadRequest" }
627:    BadRequest:

thinking
**Checking status code references**
exec
bash -lc 'rg -n "429" openapi.yaml' in /var/home/rick/Development/playlist-manager exited 1 in 39ms:


thinking
**Verifying error response handling and request ID propagation**

I’m mapping out how the spec enforces error response schemas, focusing on ensuring the correlation/request ID is reflected properly both in the error body and response headers. To do this, I’ll need to validate updates to the OpenAPI spec, regenerate types, and review or add tests that confirm the request ID is echoed in error responses and headers, following TDD principles before changing the error plugin code.
exec
bash -lc 'rg -n "X-Request-Id" -n' in /var/home/rick/Development/playlist-manager succeeded in 47ms:
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:300:bash -lc 'rg -n "X-Request-Id" -n' in /var/home/rick/Development/playlist-manager

thinking
**Preparing error handling implementation**
exec
bash -lc "rg -n \"problem\\(\" -n" in /var/home/rick/Development/playlist-manager succeeded in 47ms:
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:127:export function problem(options: ProblemOptions): Error {
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:279:    throw problem({ status: 400, code: 'invalid_playlist_id', message: 'Invalid playlist id' });
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:300:    throw problem({ status: 404, code: 'active_playlist_missing', message: 'Active playlist not set' });
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:987:export function problem(options: ProblemOptions): Error {
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:2152:      throw problem({
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:7294:+    throw problem({
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:7317:     throw problem({ status: 400, code: 'invalid_playlist_id', message: 'Invalid playlist id' });
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:7345:+    throw problem({ status: 400, code: 'invalid_cursor', message: 'Cursor must be a numeric id' });
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:7357:+  throw problem({
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:7374:+  throw problem({
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:7421:+    throw problem({
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:7444:     throw problem({ status: 400, code: 'invalid_playlist_id', message: 'Invalid playlist id' });
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:7472:+    throw problem({ status: 400, code: 'invalid_cursor', message: 'Cursor must be a numeric id' });
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:7484:+  throw problem({
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:7501:+  throw problem({
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:7808:+    throw problem({
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:7831:     throw problem({ status: 400, code: 'invalid_playlist_id', message: 'Invalid playlist id' });
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:7859:+    throw problem({ status: 400, code: 'invalid_cursor', message: 'Cursor must be a numeric id' });
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:7871:+  throw problem({
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:7888:+  throw problem({

thinking
**Refining search to avoid logs**
exec
bash -lc "rg -n \"problem\\(\" apps/api/src" in /var/home/rick/Development/playlist-manager succeeded in 43ms:
apps/api/src/plugins/feature-guard.ts:10:      throw problem({
apps/api/src/routes/imports.file.ts:74:      throw problem({
apps/api/src/routes/imports.file.ts:83:      throw problem({
apps/api/src/routes/imports.file.ts:95:        throw problem({
apps/api/src/routes/imports.file.ts:107:      throw problem({
apps/api/src/routes/artists/[mbid].get.ts:17:    throw problem({ status: 400, code: 'invalid_mbid', message: 'Invalid MBID' });
apps/api/src/routes/artists/[mbid]/relations.get.ts:21:    throw problem({ status: 400, code: 'invalid_mbid', message: 'Invalid MBID' });
apps/api/src/routes/artists/[mbid]/follow.delete.ts:17:    throw problem({ status: 400, code: 'invalid_mbid', message: 'Invalid MBID' });
apps/api/src/routes/artists/[mbid]/follow.post.ts:17:    throw problem({ status: 400, code: 'invalid_mbid', message: 'Invalid MBID' });
apps/api/src/routes/exports/file.post.ts:29:    throw problem({ status: 400, code: 'invalid_export_request', message: 'Invalid export request' });
apps/api/src/routes/jobs/[id].get.ts:15:    throw problem({ status: 400, code: 'invalid_job_id', message: 'Invalid job id' });
apps/api/src/routes/jobs/migrate.post.ts:28:    throw problem({ status: 400, code: 'invalid_migration_request', message: 'Invalid migration request' });
apps/api/src/routes/active-playlist/index.put.ts:17:    throw problem({ status: 400, code: 'invalid_playlist_id', message: 'playlist_id must be an integer' });
apps/api/src/routes/active-playlist/index.get.ts:11:    throw problem({ status: 404, code: 'active_playlist_missing', message: 'Active playlist not set' });
apps/api/src/routes/active-playlist/items/[itemId].delete.ts:15:    throw problem({ status: 400, code: 'invalid_item_id', message: 'Invalid item id' });
apps/api/src/routes/active-playlist/items/index.post.ts:47:    throw problem({ status: 400, code: 'invalid_playlist_item_request', message: 'Invalid request body' });
apps/api/src/routes/playlists/[id].get.ts:15:    throw problem({ status: 400, code: 'invalid_playlist_id', message: 'Invalid playlist id' });
apps/api/src/lib/openapi/validator.ts:656:      throw problem({
apps/api/src/lib/problem.ts:16:export function problem(options: ProblemOptions): Error {
apps/api/src/testServer.ts:27:      throw problem({ status: 401, code: 'unauthorized', message: 'Invalid or missing Authorization header' });

thinking
**Clarifying error validation and schema requirements**
exec
bash -lc "sed -n '600,760p' apps/api/src/lib/openapi/validator.ts" in /var/home/rick/Development/playlist-manager succeeded in 38ms:
function detectType(value: unknown): 'object' | 'array' | 'string' | 'number' | 'integer' | 'boolean' | 'null' | 'unknown' {
  if (value === null) return 'null';
  if (Array.isArray(value)) return 'array';
  if (typeof value === 'string') return 'string';
  if (typeof value === 'boolean') return 'boolean';
  if (typeof value === 'number') {
    return Number.isInteger(value) ? 'integer' : 'number';
  }
  if (value && typeof value === 'object') return 'object';
  return 'unknown';
}

function deepEqual(a: unknown, b: unknown): boolean {
  if (a === b) return true;
  if (typeof a !== typeof b) return false;
  if (typeof a !== 'object' || a === null || b === null) {
    return Object.is(a, b);
  }
  if (Array.isArray(a) && Array.isArray(b)) {
    if (a.length !== b.length) return false;

thinking
**Planning test updates for request-id handling**

I’m thinking through updating tests to check error responses include both the request_id header and matching metadata in the body, since the new behavior likely involves correlation IDs in headers and error envelopes. I want to confirm the exact requirement but will lean toward testing both header and body fields to catch failures before implementing changes. I might peek at some log files if needed for clarity.
exec
bash -lc "sed -n '1,200p' codex/LOGS/tasklog_07c_error_contracts_1763302301.log" in /var/home/rick/Development/playlist-manager succeeded in 38ms:
OpenAI Codex v0.58.0 (research preview)
--------
workdir: /var/home/rick/Development/playlist-manager
model: gpt-5.1-codex
provider: openai
approval: never
sandbox: workspace-write [workdir, /tmp, $TMPDIR]
reasoning effort: high
reasoning summaries: auto
session id: 019a8d01-e0a9-7c02-9aef-9fe152b6a59d
--------
user
Implement the functionality described in codex/TASKS/07c_error_contracts.yaml, then verify with any available tests.
ERROR: MCP client for `arxiv-mcp-server-gpt` failed to start: handshaking with MCP server failed: connection closed: initialize response

thinking
**Preparing to inspect task file**
exec
bash -lc ls in /var/home/rick/Development/playlist-manager succeeded in 38ms:
AGENTS.md

thinking
**Reviewing error handling and API spec compliance**
exec
bash -lc "rg -n \"'4\" openapi.yaml" in /var/home/rick/Development/playlist-manager succeeded in 39ms:
53:        '401': { $ref: '#/components/responses/Unauthorized' }
75:        '400': { $ref: '#/components/responses/BadRequest' }
76:        '401': { $ref: '#/components/responses/Unauthorized' }
101:        '401': { $ref: '#/components/responses/Unauthorized' }
102:        '404': { $ref: '#/components/responses/NotFound' }
170:        '401': { $ref: '#/components/responses/Unauthorized' }
171:        '404': { $ref: '#/components/responses/NotFound' }
172:        '422': { $ref: '#/components/responses/UnprocessableEntity' }
184:        '404': { $ref: '#/components/responses/NotFound' }
185:        '401': { $ref: '#/components/responses/Unauthorized' }
200:        '400': { $ref: '#/components/responses/BadRequest' }
201:        '401': { $ref: '#/components/responses/Unauthorized' }
235:        '400': { $ref: '#/components/responses/BadRequest' }
236:        '401': { $ref: '#/components/responses/Unauthorized' }
253:        '404': { $ref: '#/components/responses/NotFound' }
254:        '401': { $ref: '#/components/responses/Unauthorized' }
288:        '400': { $ref: '#/components/responses/BadRequest' }
289:        '401': { $ref: '#/components/responses/Unauthorized' }
315:        '401': { $ref: '#/components/responses/Unauthorized' }
316:        '404': { $ref: '#/components/responses/NotFound' }

thinking
**Searching for 500 status references**
exec
bash -lc "rg -n \"'5\" openapi.yaml" in /var/home/rick/Development/playlist-manager succeeded in 39ms:
290:        '503': { $ref: '#/components/responses/ServiceUnavailable' }

thinking
**Analyzing error response schema changes**
exec
bash -lc "sed -n '200,260p' packages/contracts/src/api.types.ts" in /var/home/rick/Development/playlist-manager succeeded in 38ms:
            path?: never;
            cookie?: never;
        };
        /** Get artist relations */
        get: operations["artists_relations"];
        put?: never;
        post?: never;
        delete?: never;
        options?: never;
        head?: never;
        patch?: never;
        trace?: never;
    };
}
export type webhooks = Record<string, never>;
export interface components {
    schemas: {
        Error: {
            /** @example about:blank */
            type: string;

thinking
**Planning TDD-compliant spec and test updates**

I'll organize a plan that updates the spec first to reflect new schema changes, then adds failing tests tied to that spec before modifying the plugin code, ensuring TDD principles are respected and the generated types stay aligned.
Plan update
  → Review existing error handling spec/tests to understand gaps vs TASK 07c requirements
  • Update OpenAPI spec + generated types to define the unified error schema/responses and expected metadata
  • Add/adjust tests (plugins/routes) that enforce the new error contract behavior (request-id echo, response schema) to fail prior to implementation
  • Implement Fastify error plugin changes + server wiring to satisfy tests/spec
  • Run test suite and finalize (including git status/commit)

thinking
**Reviewing step 1 completion**
Plan update
  ✓ Review existing error handling spec/tests to understand gaps vs TASK 07c requirements
  → Update OpenAPI spec + generated types to define the unified error schema/responses and expected metadata
  • Add/adjust tests (plugins/routes) that enforce the new error contract behavior (request-id echo, response schema) to fail prior to implementation
  • Implement Fastify error plugin changes + server wiring to satisfy tests/spec
  • Run test suite and finalize (including git status/commit)

thinking
**Analyzing OpenAPI error schema updates**

I'm working through how to revise the OpenAPI spec to unify error responses under a single schema with fields type, code, message, and details, including properly handling request_id. I’m considering how to restructure details to carry metadata like request_id alongside other info without breaking existing uses, and ensuring missing TooManyRequests components and examples are added per instructions. There’s also the matter of verifying that the error plugin is correctly hooked and headers like x-request-id are sent, while keeping alignment across spec, implementation, and tests. It’s a bit tangled, but I’m parsing requirements to make the spec consistent and comprehensive.
exec
bash -lc 'rg -n "request-id" -n' in /var/home/rick/Development/playlist-manager succeeded in 47ms:
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:54:  - Server returns correlation/request-id in error responses
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:62:  - Ensure request-id header is echoed in error response meta/details
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:94:    (req as any).requestId = req.headers['x-request-id'] || nanoid();
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:237:**Planning request-id tests**
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:239:bash -lc 'rg -n "x-request-id" -n' in /var/home/rick/Development/playlist-manager succeeded in 47ms:
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:240:codex/LOGS/tasklog_07c_error_contracts_1763302301.log:94:    (req as any).requestId = req.headers['x-request-id'] || nanoid();
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:241:codex/LOGS/tasklog_07c_error_contracts_1763302301.log:239:bash -lc 'rg -n "x-request-id" -n' in /var/home/rick/Development/playlist-manager
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:242:codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:954:    (req as any).requestId = req.headers['x-request-id'] || nanoid();
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:243:codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:301:    (req as any).requestId = req.headers['x-request-id'] || nanoid();
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:244:apps/api/src/plugins/errors.ts:8:    (req as any).requestId = req.headers['x-request-id'] || nanoid();
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:245:codex/LOGS/tasklog_04d_config_feature_flags_1762396882.log:475:    (req as any).requestId = req.headers['x-request-id'] || nanoid();
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:246:codex/LOGS/tasklog_05c_importers_file_1762405313.log:528:    (req as any).requestId = req.headers['x-request-id'] || nanoid();
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:379:**Planning test updates for request-id handling**
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:468:  • Add/adjust tests (plugins/routes) that enforce the new error contract behavior (request-id echo, response schema) to fail prior to implementation
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:477:  • Add/adjust tests (plugins/routes) that enforce the new error contract behavior (request-id echo, response schema) to fail prior to implementation
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:484:I'm working through how to revise the OpenAPI spec to unify error responses under a single schema with fields type, code, message, and details, including properly handling request_id. I’m considering how to restructure details to carry metadata like request_id alongside other info without breaking existing uses, and ensuring missing TooManyRequests components and examples are added per instructions. There’s also the matter of verifying that the error plugin is correctly hooked and headers like x-request-id are sent, while keeping alignment across spec, implementation, and tests. It’s a bit tangled, but I’m parsing requirements to make the spec consistent and comprehensive.
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:486:bash -lc 'rg -n "request-id" -n' in /var/home/rick/Development/playlist-manager
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:954:    (req as any).requestId = req.headers['x-request-id'] || nanoid();
codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:301:    (req as any).requestId = req.headers['x-request-id'] || nanoid();
codex/TASKS/09g_observability_min.yaml:2:title: Minimal observability (pino logs, request-id, metrics stub)

thinking
**Analyzing request_id handling in error details**

I'm piecing together how `request_id` is currently handled separately but might need to be embedded inside the `details` object consistently. There’s a lot to consider about preserving existing error details and ensuring compatibility, so I'll check code references and specs to confirm the best way to unify this structure without breaking anything.
exec
bash -lc 'rg -n "request_id" -g"*.ts"' in /var/home/rick/Development/playlist-manager succeeded in 43ms:
packages/contracts/src/api.types.ts:224:            request_id?: string | null;
apps/api/src/lib/problem.ts:12:  request_id: string | null;
apps/api/src/lib/problem.ts:33:    request_id: requestId ?? null,

thinking
**Revising error response structure**

I'm working on restructuring the error response to embed the `request_id` inside a required `details` object instead of a top-level field, ensuring it’s always included. I plan to update the OpenAPI schema, plugin error mappings, and tests accordingly, while also adding the missing `TooManyRequests` response component and examples to align with spec instructions.
exec
bash -lc "sed -n '1,200p' openapi.yaml" in /var/home/rick/Development/playlist-manager succeeded in 39ms:
openapi: 3.1.0
info:
  title: playlist-manager API
  version: 1.0.0
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
servers:
  - url: https://api.playlist-manager.app/api/v1
    description: Production API
  - url: http://{host}:{port}/api/v1
    description: Local development
    variables:
      host:
        default: 127.0.0.1
      port:
        default: '3101'
security:
  - {}
tags:

thinking
**Evaluating error response updates**

This spec change involves adding a `'429'` TooManyRequests response to many endpoints, updating error response schemas to include `details` with `request_id`, and reflecting these changes in both the API spec and code. I'll need to adjust the error handling types, problem.ts, and related tests, then regenerate types to keep everything consistent.
exec
bash -lc 'cat package.json' in /var/home/rick/Development/playlist-manager succeeded in 37ms:
{
  "name": "playlist-manager",
  "private": true,
  "version": "0.1.0",
  "type": "module",
  "packageManager": "pnpm@9.12.3",
  "engines": {
    "node": ">=18.18"
  },
  "workspaces": [
    "apps/*",
    "packages/*"
  ],
  "scripts": {
    "lint:api": "redocly lint openapi.yaml --extends recommended",
    "gen:types": "openapi-typescript openapi.yaml -o packages/contracts/src/api.types.ts",
    "mock:api": "prism mock openapi.yaml",
    "check:breaking": "oasdiff breaking origin:openapi.yaml openapi.yaml --warn-added",
    "contract:test": "schemathesis run openapi.yaml --checks all --hypothesis-deadline=1000",
    "prisma:generate": "pnpm -F @app/db exec prisma generate",

thinking
**Preparing to run tests with Vitest**
exec
bash -lc 'cat vitest.config.ts' in /var/home/rick/Development/playlist-manager succeeded in 38ms:
import path from 'node:path';
import { fileURLToPath } from 'node:url';

import { defineConfig } from 'vitest/config';

const rootDir = path.dirname(fileURLToPath(import.meta.url));

export default defineConfig({
  resolve: {
    alias: {
      '@app/contracts': path.resolve(rootDir, 'packages/contracts/src/index.ts'),
      '@app/interop': path.resolve(rootDir, 'packages/interop/src'),
      '@app/db': path.resolve(rootDir, 'packages/db/src/index.ts'),
      '@app/providers-spotify': path.resolve(rootDir, 'packages/providers/spotify/src/index.ts'),
      '@app/providers-deezer': path.resolve(rootDir, 'packages/providers/deezer/src/index.ts'),
      '@app/providers-tidal': path.resolve(rootDir, 'packages/providers/tidal/src/index.ts'),
      '@app/providers-youtube': path.resolve(rootDir, 'packages/providers/youtube/src/index.ts'),
      nock: path.resolve(rootDir, 'codex/support/nock.ts'),
      supertest: path.resolve(rootDir, 'codex/support/supertest.ts'),
    },

thinking
**Updating OpenAPI spec with new error schemas and responses**

I'm working through modifying the OpenAPI spec to add a detailed `Error` schema including `TooManyRequests` and examples for all 4xx/5xx responses. I’m figuring out how to update paths to reference the `429` status consistently while maintaining test-driven development by planning tests to fail before code changes. This involves restructuring the errors component, adding examples for each response, and deciding whether to include `429` on every applicable route.
exec
bash -lc "sed -n '200,500p' openapi.yaml" in /var/home/rick/Development/playlist-manager succeeded in 39ms:
        '400': { $ref: '#/components/responses/BadRequest' }
        '401': { $ref: '#/components/responses/Unauthorized' }

  /active-playlist/items:
    post:
      summary: Append item to active playlist
      operationId: activePlaylist_addItem
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - type: object
                  required: [recording_id]
                  properties:
                    recording_id: { type: integer }
                    position: { type: string, enum: [append, head], default: append }
                - type: object
                  required: [isrc]

thinking
**Continuing to view file**
exec
bash -lc "sed -n '500,800p' openapi.yaml" in /var/home/rick/Development/playlist-manager succeeded in 38ms:
        '400': { $ref: '#/components/responses/BadRequest' }
        '401': { $ref: '#/components/responses/Unauthorized' }

  /artists/{mbid}/follow:
    post:
      summary: Follow an artist by MBID
      operationId: artists_follow
      parameters:
        - in: path
          name: mbid
          required: true
          example: '123e4567-e89b-12d3-a456-426614174000'
          schema:
            type: string
            pattern: '^[0-9a-fA-F-]{36}$'
            example: '123e4567-e89b-12d3-a456-426614174000'
            default: '123e4567-e89b-12d3-a456-426614174000'
          examples:
            default:
              value: '123e4567-e89b-12d3-a456-426614174000'

thinking
**Planning response schema and error updates**

I’m outlining detailed changes to update response definitions, add examples, revise the Error schema to nest request_id in details, and ensure consistent request ID handling across error and not-found handlers, including adding tests to verify these updates.
exec
bash -lc 'rg -n "errorsPlugin" -n' in /var/home/rick/Development/playlist-manager succeeded in 52ms:
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:207:import errorsPlugin from '../../plugins/errors';
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:213:    await app.register(errorsPlugin);
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:261:import errorsPlugin from '../plugins/errors.js';
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:654:bash -lc 'rg -n "errorsPlugin" -n' in /var/home/rick/Development/playlist-manager
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:436:import errorsPlugin from './plugins/errors.js';
codex/LOGS/tasklog_04d_config_feature_flags_1762396882.log:366:import errorsPlugin from '../plugins/errors.js';
codex/LOGS/tasklog_04d_config_feature_flags_1762396882.log:667:import errorsPlugin from '../../plugins/errors';
codex/LOGS/tasklog_04d_config_feature_flags_1762396882.log:673:    await app.register(errorsPlugin);
codex/LOGS/tasklog_04d_config_feature_flags_1762396882.log:1898:    const errorsPlugin = (await import('../../plugins/errors')).default;
codex/LOGS/tasklog_04d_config_feature_flags_1762396882.log:1901:    await app.register(errorsPlugin);
codex/LOGS/tasklog_04d_config_feature_flags_1762396882.log:1931:    const errorsPlugin = (await import('../../plugins/errors')).default;
codex/LOGS/tasklog_04d_config_feature_flags_1762396882.log:1935:    await app.register(errorsPlugin);
codex/LOGS/tasklog_04d_config_feature_flags_1762396882.log:2009:+    const errorsPlugin = (await import('../../plugins/errors')).default;
codex/LOGS/tasklog_04d_config_feature_flags_1762396882.log:2012:+    await app.register(errorsPlugin);
codex/LOGS/tasklog_04d_config_feature_flags_1762396882.log:2042:+    const errorsPlugin = (await import('../../plugins/errors')).default;
codex/LOGS/tasklog_04d_config_feature_flags_1762396882.log:2046:+    await app.register(errorsPlugin);
codex/LOGS/tasklog_04d_config_feature_flags_1762396882.log:2191:+    const errorsPlugin = (await import('../../plugins/errors')).default;
codex/LOGS/tasklog_04d_config_feature_flags_1762396882.log:2194:+    await app.register(errorsPlugin);
codex/LOGS/tasklog_04d_config_feature_flags_1762396882.log:2224:+    const errorsPlugin = (await import('../../plugins/errors')).default;
codex/LOGS/tasklog_04d_config_feature_flags_1762396882.log:2228:+    await app.register(errorsPlugin);

thinking
**Searching for code references to plugins/errors**
exec
bash -lc 'rg -n "plugins/errors" -g"*.ts"' in /var/home/rick/Development/playlist-manager succeeded in 43ms:
apps/api/src/routes/__tests__/imports.file.test.ts:8:import errorsPlugin from '../../plugins/errors';
apps/api/src/routes/__tests__/auth.providers.test.ts:100:    const errorsPlugin = (await import('../../plugins/errors')).default;
apps/api/src/routes/__tests__/register-handlers.test.ts:4:import errorsPlugin from '../../plugins/errors';
apps/api/src/dev/start.ts:10:import errorsPlugin from '../plugins/errors.js';
apps/api/src/testServer.ts:5:import errorsPlugin from './plugins/errors.js';

thinking
**Verifying test and plugin integration**
exec
bash -lc "sed -n '1,200p' apps/api/src/dev/ensure-api-dev.cli.ts" in /var/home/rick/Development/playlist-manager succeeded in 47ms:
import process from 'node:process';

import { ensureApiDevServer } from './ensure-api-dev.ts';

const result = await ensureApiDevServer();

const shutdown = () => {
  result.release();
};

process.once('SIGINT', shutdown);
process.once('SIGTERM', shutdown);

if (result.state === 'spawned') {
  result.child.once('exit', (code, signal) => {
    if (typeof code === 'number') {
      process.exitCode = code;
      return;
    }


thinking
**Checking specific file**
exec
bash -lc "sed -n '1,200p' apps/api/src/dev/ensure-api-dev.ts" in /var/home/rick/Development/playlist-manager succeeded in 45ms:
import { spawn } from 'node:child_process';
import type { ChildProcess } from 'node:child_process';
import net from 'node:net';
import process from 'node:process';

export type EnsureApiDevOptions = {
  host?: string;
  port?: number;
  spawnServer?: () => ChildProcess | Promise<ChildProcess>;
  logger?: Pick<typeof console, 'info' | 'warn' | 'error'>;
};

export type EnsureApiDevResult =
  | {
      state: 'spawned';
      child: ChildProcess;
      wait: Promise<void>;
      release: () => void;
    }
  | {

thinking
**Reviewing plugin registration and OpenAPI spec updates**
exec
bash -lc 'rg -n "openapi.json" -n' in /var/home/rick/Development/playlist-manager succeeded in 48ms:
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:183:apps/api/src/lib/openapi/openapi.json:920:          "request_id": {
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:739:bash -lc 'rg -n "openapi.json" -n' in /var/home/rick/Development/playlist-manager
codex/LOGS/tasklog_04c_api_docs_ui_1762396381.log:4218:I'm confirming whether adding a JSON route for the spec fits the existing OpenAPI spec since the instructions require links to JSON/YAML. I’m leaning toward adding both links in the docs HTML but need to verify if a JSON route is allowed or if only YAML is supported per spec-first rules. I'll check the spec file for `/openapi.json` or related paths before proceeding.
codex/LOGS/tasklog_06z_track_matching_heuristics_1762481033.log:254:apps/api/src/lib/openapi/openapi.json:662:        "summary": "Follow an artist by MBID",
codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:19352:out = Path('apps/api/src/lib/openapi/openapi.json')
codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:19871:out = Path('apps/api/src/lib/openapi/openapi.json')
codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:28670:bash -lc "rg '\"oneOf\"' apps/api/src/lib/openapi/openapi.json" in /var/home/rick/Development/playlist-manager/. succeeded in 41ms:
codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:29154:bash -lc "rg '\"anyOf\"' apps/api/src/lib/openapi/openapi.json" in /var/home/rick/Development/playlist-manager/. exited 1 in 39ms:
codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:29635:bash -lc "rg '\"allOf\"' apps/api/src/lib/openapi/openapi.json" in /var/home/rick/Development/playlist-manager/. exited 1 in 44ms:
codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:38658:  'openapi.json',
codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:39336:+  'openapi.json',
codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:40129:+  'openapi.json',
codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:41038:+  'openapi.json',
codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:41805:+  'openapi.json',
codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:42603:+  'openapi.json',
codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:43368:+  'openapi.json',
codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:44026:openapi.json
codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:44142:+  'openapi.json',
codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:44917:+  'openapi.json',
codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:45707:+  'openapi.json',

thinking
**Checking OpenAPI spec update process**
exec
bash -lc 'ls apps/api/src/lib/openapi' in /var/home/rick/Development/playlist-manager succeeded in 40ms:
openapi.json
validator.ts

thinking
**Searching for OpenAPI generation script**
exec
bash -lc "rg -n \"openapi\\\\.json\"" in /var/home/rick/Development/playlist-manager succeeded in 49ms:
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:183:apps/api/src/lib/openapi/openapi.json:920:          "request_id": {
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:739:bash -lc 'rg -n "openapi.json" -n' in /var/home/rick/Development/playlist-manager succeeded in 48ms:
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:740:codex/LOGS/tasklog_07c_error_contracts_1763302301.log:183:apps/api/src/lib/openapi/openapi.json:920:          "request_id": {
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:741:codex/LOGS/tasklog_07c_error_contracts_1763302301.log:739:bash -lc 'rg -n "openapi.json" -n' in /var/home/rick/Development/playlist-manager
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:742:codex/LOGS/tasklog_04c_api_docs_ui_1762396381.log:4218:I'm confirming whether adding a JSON route for the spec fits the existing OpenAPI spec since the instructions require links to JSON/YAML. I’m leaning toward adding both links in the docs HTML but need to verify if a JSON route is allowed or if only YAML is supported per spec-first rules. I'll check the spec file for `/openapi.json` or related paths before proceeding.
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:743:codex/LOGS/tasklog_06z_track_matching_heuristics_1762481033.log:254:apps/api/src/lib/openapi/openapi.json:662:        "summary": "Follow an artist by MBID",
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:744:codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:19352:out = Path('apps/api/src/lib/openapi/openapi.json')
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:745:codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:19871:out = Path('apps/api/src/lib/openapi/openapi.json')
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:746:codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:28670:bash -lc "rg '\"oneOf\"' apps/api/src/lib/openapi/openapi.json" in /var/home/rick/Development/playlist-manager/. succeeded in 41ms:
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:747:codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:29154:bash -lc "rg '\"anyOf\"' apps/api/src/lib/openapi/openapi.json" in /var/home/rick/Development/playlist-manager/. exited 1 in 39ms:
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:748:codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:29635:bash -lc "rg '\"allOf\"' apps/api/src/lib/openapi/openapi.json" in /var/home/rick/Development/playlist-manager/. exited 1 in 44ms:
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:749:codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:38658:  'openapi.json',
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:750:codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:39336:+  'openapi.json',
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:751:codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:40129:+  'openapi.json',
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:752:codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:41038:+  'openapi.json',
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:753:codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:41805:+  'openapi.json',
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:754:codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:42603:+  'openapi.json',
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:755:codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:43368:+  'openapi.json',
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:756:codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:44026:openapi.json
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:757:codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:44142:+  'openapi.json',

thinking
**Searching for openapi.json update process**
exec
bash -lc 'rg -n "openapi.yaml" -g"*.ts"' in /var/home/rick/Development/playlist-manager succeeded in 43ms:
apps/api/src/routes/__tests__/docs.test.ts:8:  it('registers /openapi.yaml to stream the repository spec', async () => {
apps/api/src/routes/__tests__/docs.test.ts:14:    const specRoute = get.mock.calls.find(([route]) => route === '/openapi.yaml');
apps/api/src/routes/__tests__/docs.test.ts:25:    expect(sendFile).toHaveBeenCalledWith('openapi.yaml', path.resolve(process.cwd()));
apps/api/src/routes/__tests__/docs.test.ts:54:    expect(html).toContain('spec-url="/openapi.yaml"');
apps/api/src/routes/__tests__/docs.test.ts:55:    expect(html).toContain('href="/openapi.yaml"');
apps/api/src/routes/docs.ts:5:  // Serve raw spec at /openapi.yaml
apps/api/src/routes/docs.ts:6:  app.get('/openapi.yaml', async (_req, reply) => {
apps/api/src/routes/docs.ts:8:    return reply.sendFile('openapi.yaml', path.resolve(process.cwd()));

thinking
**Searching for openapi.json references**
exec
bash -lc "rg -n \"openapi\\\\.json\" -g\"*.ts\" apps" in /var/home/rick/Development/playlist-manager succeeded in 43ms:
apps/api/src/lib/openapi/validator.ts:108:  'openapi.json',

thinking
**Investigating openapi.json generation and updating spec**

I’m figuring out how openapi.json is generated—likely from openapi.yaml using `@redocly/cli` bundled via an `npx` command—and exploring existing scripts or logs for clues. Since there’s no clear automated script, I plan to manually update openapi.json after patching the YAML spec, focusing on modifying response definitions and error schema by applying a carefully crafted patch with correct indentation and quoting.
file update
M /var/home/rick/Development/playlist-manager/openapi.yaml
@@ -621,2 +621,28 @@
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
+    Unauthorized:
+      description: Unauthorized
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     NotFound:
@@ -625,5 +651,13 @@
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
@@ -631,2 +665,10 @@
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
@@ -636,2 +678,10 @@
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
@@ -641,2 +691,10 @@
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
@@ -646,2 +704,10 @@
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
@@ -650,17 +716,20 @@
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
apply_patch(auto_approved=true) exited 0 in 6ms:
Success. Updated the following files:
M openapi.yaml
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..1fc5d9455293cb78e90cfc58e0d3ba325a91054e
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -619,50 +619,119 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
+    Unauthorized:
+      description: Unauthorized
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]

file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..1fc5d9455293cb78e90cfc58e0d3ba325a91054e
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -619,50 +619,119 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
+    Unauthorized:
+      description: Unauthorized
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Checking for duplicate entries**
exec
bash -lc "sed -n '620,730p' openapi.yaml" in /var/home/rick/Development/playlist-manager succeeded in 39ms:

  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema: { $ref: '#/components/schemas/Error' }
          examples:
            invalid_request:
              summary: Invalid request payload
              value:
                type: 'about:blank'
                code: bad_request
                message: Invalid request parameters
                details: { request_id: req_123456abcdef }
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema: { $ref: '#/components/schemas/Error' }
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..1fc5d9455293cb78e90cfc58e0d3ba325a91054e
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -619,50 +619,119 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
+    Unauthorized:
+      description: Unauthorized
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Removing duplicate Unauthorized block**
file update
M /var/home/rick/Development/playlist-manager/openapi.yaml
@@ -634,15 +634,2 @@
                 details: { request_id: req_123456abcdef }
-    Unauthorized:
-      description: Unauthorized
-      content:
-        application/json:
-          schema: { $ref: '#/components/schemas/Error' }
-          examples:
-            unauthorized:
-              summary: Missing or invalid credentials
-              value:
-                type: 'about:blank'
-                code: unauthorized
-                message: Invalid or missing Authorization header
-                details: { request_id: req_unauth123 }
     NotFound:
apply_patch(auto_approved=true) exited 0 in 6ms:
Success. Updated the following files:
M openapi.yaml
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..8b246f08964e3f791b5c41f42704c87ee02034c9
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -619,50 +619,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]

file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..8b246f08964e3f791b5c41f42704c87ee02034c9
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -619,50 +619,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Planning addition of 429 responses**
exec
bash -lc "sed -n '150,260p' openapi.yaml" in /var/home/rick/Development/playlist-manager succeeded in 40ms:
                        artists: "R.E.M."
                        album: "Out of Time"
                        duration_ms: 269000
                        isrc: "USWB19902945"
                        recording_id: 5551
                        mb_recording_id: "b8d0d7c0-8e1c-4b34-8bc3-38d78a0c2b1f"
                        mb_release_id: "b7a6d2e4-1c77-4a9f-9d5b-0c3b2ea0f4a1"
                        provider_track_id: "3urbQpVxWn"
                      - id: 102
                        position: 2
                        title: "Hurt"
                        artists: "Nine Inch Nails"
                        album: "The Downward Spiral"
                        duration_ms: 371000
                        isrc: "USIR19400383"
                        recording_id: 5552
                        mb_recording_id: "f2d9f7d3-7a61-485f-9b1e-2f4d8b3b7d1a"
                        mb_release_id: "9c0b3c90-1e37-4b9b-8c7e-9b7a86a1e5fd"
                        provider_track_id: "9zYpqAbC12"
                    next_cursor: null
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..8b246f08964e3f791b5c41f42704c87ee02034c9
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -619,50 +619,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Planning addition of 429 responses**
exec
bash -lc "python - <<'PY'
from pathlib import Path
import re
path = Path('openapi.yaml')
text = path.read_text()
pattern = re.compile(r\""'^(?P<indent>'"\\s{8})(?P<quote>['\\\"])401(?P=quote): \\{ \\"'$ref: (?P=quote)#/components/responses/Unauthorized(?P=quote) '"\\ }\", re.MULTILINE)
new_text, count = pattern.subn(lambda m: f\"{m.group(0)}\\n{m.group('indent')}{m.group('quote')}429{m.group('quote')}: {{ "'$ref: {m.group('"'quote')}#/components/responses/TooManyRequests{m.group('quote')} }}\", text)
if count == 0:
    raise SystemExit('no matches for 401 unauthorized pattern')
path.write_text(new_text)
print('inserted 429 after 401 occurrences:', count)
PY" in /var/home/rick/Development/playlist-manager exited 1 in 65ms:
no matches for 401 unauthorized pattern
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..8b246f08964e3f791b5c41f42704c87ee02034c9
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -619,50 +619,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Checking spacing in code line**
exec
bash -lc "rg -n \"['\\\"]401['\\\"]\" -n openapi.yaml" in /var/home/rick/Development/playlist-manager succeeded in 39ms:
53:        '401': { $ref: '#/components/responses/Unauthorized' }
76:        '401': { $ref: '#/components/responses/Unauthorized' }
101:        '401': { $ref: '#/components/responses/Unauthorized' }
170:        '401': { $ref: '#/components/responses/Unauthorized' }
185:        '401': { $ref: '#/components/responses/Unauthorized' }
201:        '401': { $ref: '#/components/responses/Unauthorized' }
236:        '401': { $ref: '#/components/responses/Unauthorized' }
254:        '401': { $ref: '#/components/responses/Unauthorized' }
289:        '401': { $ref: '#/components/responses/Unauthorized' }
315:        '401': { $ref: '#/components/responses/Unauthorized' }
501:        '401': { $ref: '#/components/responses/Unauthorized' }
524:        "401": { $ref: "#/components/responses/Unauthorized" }
545:        "401": { $ref: "#/components/responses/Unauthorized" }
571:        '401': { $ref: '#/components/responses/Unauthorized' }
611:        '401': { $ref: '#/components/responses/Unauthorized' }
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..8b246f08964e3f791b5c41f42704c87ee02034c9
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -619,50 +619,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Investigating pattern matching issues**
exec
bash -lc "sed -n '40,60p' openapi.yaml" in /var/home/rick/Development/playlist-manager succeeded in 38ms:
      tags: [auth]
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                required: [data]
                properties:
                  data:
                    type: array
                    items: { $ref: '#/components/schemas/AuthProvider' }
        '401': { $ref: '#/components/responses/Unauthorized' }

  /playlists:
    get:
      summary: List user playlists
      operationId: playlists_list
      parameters:
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..8b246f08964e3f791b5c41f42704c87ee02034c9
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -619,50 +619,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Reviewing regex pattern for 401 line**
exec
bash -lc "python - <<'PY'
import re
from pathlib import Path
text = Path('openapi.yaml').read_text().splitlines()
line = text[52]
print(repr(line))
pattern = re.compile(r\""'^(?P<indent>'"\\s{8})(?P<quote>['\\\"])401(?P=quote): \\{ \\"'$ref: (?P=quote)#/components/responses/Unauthorized(?P=quote) '"\\}\")
print('match', bool(pattern.match(line)))
PY" in /var/home/rick/Development/playlist-manager succeeded in 62ms:
"        '401': { $ref: '#/components/responses/Unauthorized' }"
match True
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..8b246f08964e3f791b5c41f42704c87ee02034c9
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -619,50 +619,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Analyzing regex matching issues**
exec
bash -lc "python - <<'PY'
from pathlib import Path
import re
path = Path('openapi.yaml')
text = path.read_text()
pattern = re.compile(r\""'^(?P<indent>'"\\s{8})(?P<quote>['\\\"])401(?P=quote): \\{ \\"'$ref: (?P=quote)#/components/responses/Unauthorized(?P=quote) '"\\}\", re.MULTILINE)
matches = list(pattern.finditer(text))
print('matches', len(matches))
if matches:
    print(matches[0].group(0))
PY" in /var/home/rick/Development/playlist-manager succeeded in 64ms:
matches 15
        '401': { $ref: '#/components/responses/Unauthorized' }
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..8b246f08964e3f791b5c41f42704c87ee02034c9
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -619,50 +619,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Analyzing pattern matching discrepancies**
exec
bash -lc "python - <<'PY'
from pathlib import Path
import re
path = Path('openapi.yaml')
text = path.read_text()
pattern = re.compile(r\""'^(?P<indent>'"\\s{8})(?P<quote>['\\\"])401(?P=quote): \\{ \\"'$ref: (?P=quote)#/components/responses/Unauthorized(?P=quote) '"\\}\", re.MULTILINE)
def repl(m):
    q = m.group('quote')
    indent = m.group('indent')
    return f\"{m.group(0)}\\n{indent}{q}429{q}: {{ "'$ref: {q}#/components/responses/TooManyRequests{q} }}"
new_text, count = pattern.subn(repl, text)
print('"'count', count)
path.write_text(new_text)
PY" in /var/home/rick/Development/playlist-manager succeeded in 63ms:
count 15
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..775b60bee8dcc9a82b88f2054a285e46069a1d30
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -499,6 +509,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +533,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +555,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +582,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +623,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +634,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Verifying and adding 429 status codes**
exec
bash -lc 'rg -n "429" openapi.yaml' in /var/home/rick/Development/playlist-manager succeeded in 40ms:
54:        '429': { $ref: '#/components/responses/TooManyRequests' }
78:        '429': { $ref: '#/components/responses/TooManyRequests' }
104:        '429': { $ref: '#/components/responses/TooManyRequests' }
174:        '429': { $ref: '#/components/responses/TooManyRequests' }
190:        '429': { $ref: '#/components/responses/TooManyRequests' }
207:        '429': { $ref: '#/components/responses/TooManyRequests' }
243:        '429': { $ref: '#/components/responses/TooManyRequests' }
262:        '429': { $ref: '#/components/responses/TooManyRequests' }
298:        '429': { $ref: '#/components/responses/TooManyRequests' }
325:        '429': { $ref: '#/components/responses/TooManyRequests' }
512:        '429': { $ref: '#/components/responses/TooManyRequests' }
536:        "429": { $ref: "#/components/responses/TooManyRequests" }
558:        "429": { $ref: "#/components/responses/TooManyRequests" }
585:        '429': { $ref: '#/components/responses/TooManyRequests' }
626:        '429': { $ref: '#/components/responses/TooManyRequests' }
675:                details: { request_id: req_rate429 }
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..775b60bee8dcc9a82b88f2054a285e46069a1d30
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -499,6 +509,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +533,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +555,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +582,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +623,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +634,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Investigating missing 429 and 401 responses**
exec
bash -lc "sed -n '1,200p' apps/api/src/routes/imports.file.ts" in /var/home/rick/Development/playlist-manager succeeded in 39ms:
import { FastifyInstance } from 'fastify';

import { validatePIF } from '@app/contracts';
import { parseCsvToPif } from '@app/interop/src/importers/csv';
import { parseM3uToPif } from '@app/interop/src/importers/m3u';
import { parsePlsToPif } from '@app/interop/src/importers/pls';
import { parseWplToPif } from '@app/interop/src/importers/wpl';
import { parseXspfToPif } from '@app/interop/src/importers/xspf';
import { isFileImportError } from '@app/interop/src/importers/common';

import { problem } from '../lib/problem';

type Parser = (input: string) => ReturnType<typeof parseCsvToPif>;

const CONTENT_TYPE_PARSERS = new Map<string, Parser>([
  ['text/csv', parseCsvToPif],
  ['application/csv', parseCsvToPif],
  ['text/x-csv', parseCsvToPif],
  ['audio/x-mpegurl', parseM3uToPif],
  ['application/x-mpegurl', parseM3uToPif],
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..775b60bee8dcc9a82b88f2054a285e46069a1d30
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -499,6 +509,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +533,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +555,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +582,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +623,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +634,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Adding 429 responses consistently**
file update
M /var/home/rick/Development/playlist-manager/openapi.yaml
@@ -478,2 +478,3 @@
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
apply_patch(auto_approved=true) exited 0 in 6ms:
Success. Updated the following files:
M openapi.yaml
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]

file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Verifying rg command output**
exec
bash -lc 'rg -n "429" openapi.yaml' in /var/home/rick/Development/playlist-manager succeeded in 39ms:
54:        '429': { $ref: '#/components/responses/TooManyRequests' }
78:        '429': { $ref: '#/components/responses/TooManyRequests' }
104:        '429': { $ref: '#/components/responses/TooManyRequests' }
174:        '429': { $ref: '#/components/responses/TooManyRequests' }
190:        '429': { $ref: '#/components/responses/TooManyRequests' }
207:        '429': { $ref: '#/components/responses/TooManyRequests' }
243:        '429': { $ref: '#/components/responses/TooManyRequests' }
262:        '429': { $ref: '#/components/responses/TooManyRequests' }
298:        '429': { $ref: '#/components/responses/TooManyRequests' }
325:        '429': { $ref: '#/components/responses/TooManyRequests' }
479:        '429': { $ref: '#/components/responses/TooManyRequests' }
513:        '429': { $ref: '#/components/responses/TooManyRequests' }
537:        "429": { $ref: "#/components/responses/TooManyRequests" }
559:        "429": { $ref: "#/components/responses/TooManyRequests" }
586:        '429': { $ref: '#/components/responses/TooManyRequests' }
627:        '429': { $ref: '#/components/responses/TooManyRequests' }
676:                details: { request_id: req_rate429 }
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Planning OpenAPI spec and type updates**

I'm organizing the next steps to finalize OpenAPI spec changes, ensure no duplicate components, add examples, and then update bundled JSON and generated TypeScript types. I’ll run `redocly` to bundle the YAML to JSON and then run `pnpm gen:types` to sync generated types before moving on to tests and implementation, carefully managing potential TypeScript type mismatches along the way.
exec
bash -lc 'pnpm exec redocly bundle openapi.yaml --output apps/api/src/lib/openapi/openapi.json --format json' in /var/home/rick/Development/playlist-manager exited 254 in 1.22s:
undefined
 ERR_PNPM_RECURSIVE_EXEC_FIRST_FAIL  Command "redocly" not found

Did you mean "pnpm exec resolve"?
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Analyzing PNPM binary resolution issues**
exec
bash -lc 'ls node_modules/.bin | head' in /var/home/rick/Development/playlist-manager succeeded in 41ms:
acorn
astring
astro
browserslist
bumpp
cssesc
esbuild
eslint
eslint-config
fxparser
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Checking redocly presence in node_modules**
exec
bash -lc 'rg -n "redocly" -l node_modules/.bin' in /var/home/rick/Development/playlist-manager exited 1 in 145ms:

file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Investigating missing CLI binary**
exec
bash -lc 'ls node_modules | grep redocly' in /var/home/rick/Development/playlist-manager exited 1 in 41ms:

file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Analyzing package installation locations**
exec
bash -lc 'rg -n "@redocly/cli" pnpm-lock.yaml' in /var/home/rick/Development/playlist-manager succeeded in 41ms:
42:      '@redocly/cli':
578:  '@redocly/cli@1.34.5':
3458:  '@redocly/cli@1.34.5(ajv@8.17.1)':
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Investigating redocly execution issues**
exec
bash -lc 'ls node_modules/.bin | grep redocly' in /var/home/rick/Development/playlist-manager exited 1 in 41ms:

file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Investigating redocly CLI absence**
exec
bash -lc 'ls node_modules/@redocly' in /var/home/rick/Development/playlist-manager exited 2 in 38ms:
ls: cannot access 'node_modules/@redocly': No such file or directory
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Investigating package installation in pnpm workspace**
exec
bash -lc 'ls node_modules/.pnpm | grep redocly' in /var/home/rick/Development/playlist-manager succeeded in 39ms:
@redocly+ajv@8.11.2
@redocly+ajv@8.11.3
@redocly+cli@1.34.5_ajv@8.17.1
@redocly+config@0.22.2
@redocly+openapi-core@1.34.5_supports-color@10.2.2
@redocly+respect-core@1.34.5_ajv@8.17.1
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Investigating missing symlink for redocly binary**
exec
bash -lc 'ls node_modules/.pnpm/@redocly+cli@1.34.5_ajv@8.17.1/node_modules/@redocly/cli/bin' in /var/home/rick/Development/playlist-manager exited 2 in 80ms:
ls: cannot access 'node_modules/.pnpm/@redocly+cli@1.34.5_ajv@8.17.1/node_modules/@redocly/cli/bin': No such file or directory
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Exploring package CLI files**
exec
bash -lc 'ls node_modules/.pnpm/@redocly+cli@1.34.5_ajv@8.17.1/node_modules/@redocly/cli' in /var/home/rick/Development/playlist-manager exited 2 in 38ms:
ls: cannot access 'node_modules/.pnpm/@redocly+cli@1.34.5_ajv@8.17.1/node_modules/@redocly/cli': No such file or directory
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Checking node_modules directories**
exec
bash -lc 'ls node_modules/.pnpm/@redocly+cli@1.34.5_ajv@8.17.1/node_modules' in /var/home/rick/Development/playlist-manager succeeded in 40ms:

file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Investigating empty directory listing**
exec
bash -lc "find node_modules/.pnpm -maxdepth 2 -type d -name '@redocly*' | head" in /var/home/rick/Development/playlist-manager succeeded in 109ms:
node_modules/.pnpm/@redocly+cli@1.34.5_ajv@8.17.1
node_modules/.pnpm/@redocly+config@0.22.2
node_modules/.pnpm/@redocly+openapi-core@1.34.5_supports-color@10.2.2
node_modules/.pnpm/@redocly+ajv@8.11.3
node_modules/.pnpm/@redocly+respect-core@1.34.5_ajv@8.17.1
node_modules/.pnpm/@redocly+ajv@8.11.2
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Inspecting installed package files**
exec
bash -lc 'ls node_modules/.pnpm/@redocly+cli@1.34.5_ajv@8.17.1' in /var/home/rick/Development/playlist-manager succeeded in 38ms:
node_modules
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Investigating node_modules structure**
exec
bash -lc 'find node_modules/.pnpm/@redocly+cli@1.34.5_ajv@8.17.1 -maxdepth 3' in /var/home/rick/Development/playlist-manager succeeded in 40ms:
node_modules/.pnpm/@redocly+cli@1.34.5_ajv@8.17.1
node_modules/.pnpm/@redocly+cli@1.34.5_ajv@8.17.1/node_modules
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Investigating package extraction and YAML parsing**
exec
bash -lc 'rg -n "yaml" package.json' in /var/home/rick/Development/playlist-manager succeeded in 39ms:
15:    "lint:api": "redocly lint openapi.yaml --extends recommended",
16:    "gen:types": "openapi-typescript openapi.yaml -o packages/contracts/src/api.types.ts",
17:    "mock:api": "prism mock openapi.yaml",
18:    "check:breaking": "oasdiff breaking origin:openapi.yaml openapi.yaml --warn-added",
19:    "contract:test": "schemathesis run openapi.yaml --checks all --hypothesis-deadline=1000",
27:    "test:contract:dredd:prism": "concurrently -k -s first \"pnpm mock:api\" \"wait-on tcp:4010 && dredd openapi.yaml http://127.0.0.1:4010 --config dredd.yml\"",
28:    "test:contract:st:prism": "concurrently -k -s first \"pnpm mock:api\" \"wait-on tcp:4010 && docker run --rm --network=host -v $(pwd):/work -w /work docker.io/schemathesis/schemathesis:stable run openapi.yaml --url=http://127.0.0.1:4010 --phases=examples --checks not_a_server_error,status_code_conformance,content_type_conformance,response_headers_conformance,response_schema_conformance\"",
30:    "test:contract:dredd:server": "concurrently -k -s first \"API_FAKE_ENQUEUE=1 tsx apps/api/src/dev/ensure-api-dev.cli.ts\" \"wait-on tcp:3101 && dredd openapi.yaml http://127.0.0.1:3101 --config dredd.server.yml\"",
31:    "test:contract:st:server": "concurrently -k -s first \"API_FAKE_ENQUEUE=1 tsx apps/api/src/dev/ensure-api-dev.cli.ts\" \"wait-on tcp:3101 && docker run --rm --network=host -v $(pwd):/work -w /work docker.io/schemathesis/schemathesis:stable run openapi.yaml --url=http://127.0.0.1:3101 --phases=examples --checks not_a_server_error,status_code_conformance,content_type_conformance,response_headers_conformance,response_schema_conformance\"",
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Evaluating YAML parsing options**
exec
bash -lc "rg -n \"package.name\":\\s*\"yaml\" -n node_modules/.pnpm/*/package.json | head" in /var/home/rick/Development/playlist-manager succeeded in 47ms:
rg: node_modules/.pnpm/*/package.json: IO error for operation on node_modules/.pnpm/*/package.json: No such file or directory (os error 2)
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Locating yaml package directory**
exec
bash -lc 'ls node_modules/.pnpm | grep yaml' in /var/home/rick/Development/playlist-manager succeeded in 40ms:
js-yaml@3.14.0
js-yaml@3.14.1
js-yaml@4.1.0
@stoplight+yaml@4.3.0
@stoplight+yaml-ast-parser@0.0.50
yaml@1.10.2
yaml-ast-parser@0.0.43
yaml-js@0.2.3
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Examining package accessibility with PNPM**
exec
bash -lc 'ls node_modules | grep yaml' in /var/home/rick/Development/playlist-manager succeeded in 40ms:
js-yaml
pnpm-workspace-yaml
yaml
yaml-eslint-parser
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Verifying YAML to JSON conversion approach**
exec
bash -lc 'head -n 20 apps/api/src/lib/openapi/openapi.json' in /var/home/rick/Development/playlist-manager succeeded in 38ms:
{
  "openapi": "3.1.0",
  "info": {
    "title": "playlist-manager API",
    "version": "1.0.0",
    "license": {
      "name": "MIT",
      "identifier": "MIT"
    }
  },
  "servers": [
    {
      "url": "https://{host}/api/v1",
      "variables": {
        "host": {
          "default": "dev.api.playlist-manager.app"
        }
      }
    },
    {
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Analyzing OpenAPI YAML and JSON discrepancies**
exec
bash -lc "node - <<'NODE'
import { readFileSync, writeFileSync } from 'node:fs';
import { parse } from 'yaml';
const source = readFileSync('openapi.yaml', 'utf8');
const doc = parse(source);
writeFileSync('apps/api/src/lib/openapi/openapi.json', JSON.stringify(doc, null, 2) + '\\n');
NODE" in /var/home/rick/Development/playlist-manager succeeded in 878ms:

file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Verifying Node ESM support and preparing type generation**

I’m checking how Node handles the `import` syntax in inline scripts, wondering if it requires `--input-type=module` to run ESM code. The command ran without error, which is curious, so I want to confirm how Node treated the script and ensure the environment supports `yaml` imports properly. Next, I’ll run `pnpm gen:types` via shell to update the TypeScript types accordingly.
exec
bash -lc 'pnpm gen:types' in /var/home/rick/Development/playlist-manager exited 1 in 1.22s:

> playlist-manager@0.1.0 gen:types /var/home/rick/Development/playlist-manager
> openapi-typescript openapi.yaml -o packages/contracts/src/api.types.ts

sh: line 1: openapi-typescript: command not found
 ELIFECYCLE  Command failed.
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Investigating missing openapi-typescript binary**
exec
bash -lc 'ls node_modules/.bin | grep openapi' in /var/home/rick/Development/playlist-manager exited 1 in 38ms:

file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Investigating missing openapi-typescript binary**
exec
bash -lc "find node_modules/.pnpm -path '*openapi-typescript*' -maxdepth 4 | head" in /var/home/rick/Development/playlist-manager succeeded in 108ms:
node_modules/.pnpm/openapi-typescript@7.10.1_typescript@5.9.3
node_modules/.pnpm/openapi-typescript@7.10.1_typescript@5.9.3/node_modules
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Inspecting internal details**
exec
bash -lc 'find node_modules/.pnpm/openapi-typescript@7.10.1_typescript@5.9.3 -maxdepth 3' in /var/home/rick/Development/playlist-manager succeeded in 38ms:
node_modules/.pnpm/openapi-typescript@7.10.1_typescript@5.9.3
node_modules/.pnpm/openapi-typescript@7.10.1_typescript@5.9.3/node_modules
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Investigating pnpm binary location**
exec
bash -lc 'ls node_modules/.pnpm/.bin | head' in /var/home/rick/Development/playlist-manager succeeded in 78ms:
ls: cannot access 'node_modules/.pnpm/.bin': No such file or directory
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Checking pnpm installation and node_modules contents**
exec
bash -lc 'find node_modules/.pnpm/nanoid@5.1.6 -maxdepth 2' in /var/home/rick/Development/playlist-manager succeeded in 38ms:
node_modules/.pnpm/nanoid@5.1.6
node_modules/.pnpm/nanoid@5.1.6/node_modules
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Reevaluating directory search depth**
exec
bash -lc 'find node_modules/.pnpm/nanoid@5.1.6 -maxdepth 3' in /var/home/rick/Development/playlist-manager succeeded in 38ms:
node_modules/.pnpm/nanoid@5.1.6
node_modules/.pnpm/nanoid@5.1.6/node_modules
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Investigating node_modules symlink structure**
exec
bash -lc 'ls -l node_modules/.pnpm/nanoid@5.1.6/node_modules' in /var/home/rick/Development/playlist-manager succeeded in 48ms:
total 0
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Investigating pnpm package storage**

I'm trying to understand why `node_modules/.pnpm/nanoid@5.1.6/node_modules` appears empty, wondering if pnpm stores actual package files elsewhere like a global store with symlinks, which may not be visible here. I'm considering running commands to check if these directories are symlinks and assessing alternative ways to run the `openapi-typescript` tool given possible network or installation limits.
exec
bash -lc 'ls -ld node_modules/.pnpm/nanoid@5.1.6' in /var/home/rick/Development/playlist-manager succeeded in 40ms:
drwxr-xr-x 1 rick rick 24 Nov  5 23:35 node_modules/.pnpm/nanoid@5.1.6
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Investigating node_modules and pnpm structure**
exec
bash -lc 'ls node_modules/openapi-typescript' in /var/home/rick/Development/playlist-manager exited 2 in 38ms:
ls: cannot access 'node_modules/openapi-typescript': No such file or directory
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Analyzing type generation challenges**
exec
bash -lc 'rg -n "openapi-typescript" -l node_modules/.pnpm | head' in /var/home/rick/Development/playlist-manager succeeded in 47ms:

file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Investigating package presence in node_modules**
exec
bash -lc 'ls -a node_modules/.pnpm/openapi-typescript@7.10.1_typescript@5.9.3' in /var/home/rick/Development/playlist-manager succeeded in 38ms:
.
..
node_modules
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Investigating node_modules symlink structure**
exec
bash -lc 'ls -a node_modules/.pnpm/openapi-typescript@7.10.1_typescript@5.9.3/node_modules' in /var/home/rick/Development/playlist-manager succeeded in 38ms:
.
..
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Inspecting node_modules structure**
exec
bash -lc 'ls -ld node_modules' in /var/home/rick/Development/playlist-manager succeeded in 39ms:
drwxr-xr-x. 1 rick rick 15720 Nov  5 23:35 node_modules
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Verifying contract update locations**
exec
bash -lc "sed -n '1,200p' packages/contracts/src/index.ts" in /var/home/rick/Development/playlist-manager succeeded in 41ms:
export * from './pif';
export * from './providers';
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]


thinking
**Adjusting error interface and specs**

I'm planning to manually update the error interface in the contracts type file to remove the top-level `request_id` and require a `details` object containing `request_id`. I want to keep the types aligned with the spec and ensure existing validation functions remain unaffected. This involves carefully setting the `details` property to be required, include `request_id` as string or null, and allow extra properties, while reflecting these changes in the OpenAPI spec and contracts artifacts.
file update
M /var/home/rick/Development/playlist-manager/packages/contracts/src/api.types.ts
@@ -223,4 +223,4 @@
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
apply_patch(auto_approved=true) exited 0 in 7ms:
Success. Updated the following files:
M packages/contracts/src/api.types.ts
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };

file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Verifying schema requirements**
exec
bash -lc 'rg -n "request_id" apps/api/src/lib/openapi/openapi.json' in /var/home/rick/Development/playlist-manager succeeded in 39ms:
1114:                    "request_id": "req_123456abcdef"
1137:                    "request_id": "req_missing404"
1160:                    "request_id": "req_rate429"
1183:                    "request_id": "req_unauth123"
1206:                    "request_id": "req_503svc"
1229:                    "request_id": "req_422body"
1262:            "description": "Additional metadata for debugging, always includes request_id.",
1264:              "request_id"
1268:              "request_id": {
1281:              "request_id": "req_abc123"
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Inspecting snippet around line 1262**
exec
bash -lc "sed -n '1250,1295p' apps/api/src/lib/openapi/openapi.json" in /var/home/rick/Development/playlist-manager succeeded in 38ms:
            "example": "about:blank"
          },
          "code": {
            "type": "string",
            "example": "provider_disabled"
          },
          "message": {
            "type": "string",
            "example": "TIDAL is disabled"
          },
          "details": {
            "type": "object",
            "description": "Additional metadata for debugging, always includes request_id.",
            "required": [
              "request_id"
            ],
            "additionalProperties": true,
            "properties": {
              "request_id": {
                "description": "Correlates the server log entry for this error.",
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Verifying openapi.json top structure**
exec
bash -lc 'head -n 30 apps/api/src/lib/openapi/openapi.json' in /var/home/rick/Development/playlist-manager succeeded in 38ms:
{
  "openapi": "3.1.0",
  "info": {
    "title": "playlist-manager API",
    "version": "1.0.0",
    "license": {
      "name": "MIT",
      "url": "https://opensource.org/licenses/MIT"
    }
  },
  "servers": [
    {
      "url": "https://api.playlist-manager.app/api/v1",
      "description": "Production API"
    },
    {
      "url": "http://{host}:{port}/api/v1",
      "description": "Local development",
      "variables": {
        "host": {
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Confirming spec updates and build steps**

I’m making sure the spec changes are done and noting that while the type generation command `pnpm gen:types` is missing, I manually updated the types to keep things in sync. I’ll finalize Step 2’s status as complete with a note about this workaround.
Plan update
  ✓ Review existing error handling spec/tests to understand gaps vs TASK 07c requirements
  ✓ Update OpenAPI spec + generated types to define the unified error schema/responses and expected metadata
  → Add/adjust tests (plugins/routes) that enforce the new error contract behavior (request-id echo, response schema) to fail prior to implementation
  • Implement Fastify error plugin changes + server wiring to satisfy tests/spec
  • Run test suite and finalize (including git status/commit)
file update:
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Designing tests for error plugin changes**

I'll add and update tests to ensure error responses include a `details.request_id` property and that request ID headers are echoed correctly. This involves creating new plugin tests with a local Fastify app registering specific routes that trigger errors, plus modifying existing route tests to expect the new response shape, all while making sure tests fail before implementation to follow TDD principles.
file update
M /var/home/rick/Development/playlist-manager/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -40,2 +40,5 @@
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
apply_patch(auto_approved=true) exited 0 in 8ms:
Success. Updated the following files:
M apps/api/src/routes/__tests__/register-handlers.test.ts
file update:
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };

file update:
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Creating tests for error plugin**

I'm preparing a new test file for the errors plugin to verify behavior like echoing the `x-request-id` header and default error codes. I’ll carefully set up routes per test in a controlled app instance and ensure appropriate imports and paths, while noting current code’s fallback differs from test expectations.
file update
A /var/home/rick/Development/playlist-manager/apps/api/src/plugins/__tests__/errors.test.ts
import fastify, { FastifyInstance } from 'fastify';
import { describe, expect, it } from 'vitest';

import errorsPlugin from '../errors';

async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
  const app = fastify({ logger: false });
  await app.register(errorsPlugin);
  if (registerRoutes) {
    await registerRoutes(app);
  }
  await app.ready();
  return app;
}

describe('errors plugin', () => {
  it('echoes the x-request-id header in error responses', async () => {
    const app = await buildApp((instance) => {
      instance.get('/echo-request-id', async () => {
        const error = new Error('boom');
        (error as any).statusCode = 400;
        throw error;
      });
    });

    try {
      const response = await app.inject({
        method: 'GET',
        url: '/echo-request-id',
        headers: { 'x-request-id': 'req_test123' },
      });
      expect(response.statusCode).toBe(400);
      expect(response.headers['x-request-id']).toBe('req_test123');
      const body = response.json();
      expect(body.details).toMatchObject({
        request_id: 'req_test123',
      });
    } finally {
      await app.close();
    }
  });

  it('maps generic Fastify errors to default error codes', async () => {
    const app = await buildApp((instance) => {
      instance.get('/missing-code', async () => {
        const error = new Error('bad input');
        (error as any).statusCode = 400;
        throw error;
      });
    });

    try {
      const response = await app.inject({ method: 'GET', url: '/missing-code' });
      expect(response.statusCode).toBe(400);
      const body = response.json();
      expect(body.code).toBe('bad_request');
    } finally {
      await app.close();
    }
  });
});
apply_patch(auto_approved=true) exited 0 in 10ms:
Success. Updated the following files:
A apps/api/src/plugins/__tests__/errors.test.ts
file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };

file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Running new tests to confirm failure**
exec
bash -lc 'pnpm vitest apps/api/src/plugins/__tests__/errors.test.ts apps/api/src/routes/__tests__/register-handlers.test.ts' in /var/home/rick/Development/playlist-manager exited 124 in 2m 00s:

 DEV  v3.1.1 /var/home/rick/Development/playlist-manager


⎯⎯⎯⎯⎯⎯ Failed Suites 2 ⎯⎯⎯⎯⎯⎯⎯

 FAIL  apps/api/src/plugins/__tests__/errors.test.ts [ apps/api/src/plugins/__tests__/errors.test.ts ]
Error: Failed to load url fastify (resolved id: fastify) in /var/home/rick/Development/playlist-manager/apps/api/src/plugins/__tests__/errors.test.ts. Does the file exist?
 ❯ loadAndTransform node_modules/vite/dist/node/chunks/dep-Bid9ssRr.js:41317:17

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/2]⎯

 FAIL  apps/api/src/routes/__tests__/register-handlers.test.ts [ apps/api/src/routes/__tests__/register-handlers.test.ts ]
Error: Failed to load url fastify (resolved id: fastify) in /var/home/rick/Development/playlist-manager/apps/api/src/plugins/__tests__/errors.test.ts. Does the file exist?
 ❯ loadAndTransform node_modules/vite/dist/node/chunks/dep-Bid9ssRr.js:41317:17

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/2]⎯


 Test Files  2 failed (2)
file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Handling vitest watch mode timeout**
exec
bash -lc 'pnpm vitest run apps/api/src/plugins/__tests__/errors.test.ts apps/api/src/routes/__tests__/register-handlers.test.ts' in /var/home/rick/Development/playlist-manager exited 1 in 1.99s:

 RUN  v3.1.1 /var/home/rick/Development/playlist-manager


⎯⎯⎯⎯⎯⎯ Failed Suites 2 ⎯⎯⎯⎯⎯⎯⎯

 FAIL  apps/api/src/plugins/__tests__/errors.test.ts [ apps/api/src/plugins/__tests__/errors.test.ts ]
 FAIL  apps/api/src/routes/__tests__/register-handlers.test.ts [ apps/api/src/routes/__tests__/register-handlers.test.ts ]
Error: Failed to load url fastify (resolved id: fastify) in /var/home/rick/Development/playlist-manager/apps/api/src/routes/__tests__/register-handlers.test.ts. Does the file exist?
 ❯ loadAndTransform node_modules/vite/dist/node/chunks/dep-Bid9ssRr.js:41317:17

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/2]⎯


 Test Files  2 failed (2)
      Tests  no tests
   Start at  09:27:12
   Duration  301ms (transform 68ms, setup 0ms, collect 0ms, tests 0ms, environment 1ms, prepare 142ms)

file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Investigating fastify import failures**
exec
bash -lc "node -e \"require('fastify'); console.log('ok')\"" in /var/home/rick/Development/playlist-manager exited 1 in 147ms:
node:internal/modules/cjs/loader:1386
  throw err;
  ^

Error: Cannot find module 'fastify'
Require stack:
- /var/home/rick/Development/playlist-manager/[eval]
    at Module._resolveFilename (node:internal/modules/cjs/loader:1383:15)
    at defaultResolveImpl (node:internal/modules/cjs/loader:1025:19)
    at resolveForCJSWithHooks (node:internal/modules/cjs/loader:1030:22)
    at Module._load (node:internal/modules/cjs/loader:1192:37)
    at TracingChannel.traceSync (node:diagnostics_channel:322:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:237:24)
    at Module.require (node:internal/modules/cjs/loader:1463:12)
    at require (node:internal/modules/helpers:147:16)
    at [eval]:1:1
    at runScriptInThisContext (node:internal/vm:209:10) {
  code: 'MODULE_NOT_FOUND',
  requireStack: [ '/var/home/rick/Development/playlist-manager/[eval]' ]
}
file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Checking fastify installation**
exec
bash -lc 'ls node_modules | grep fastify' in /var/home/rick/Development/playlist-manager exited 1 in 39ms:

file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Assessing dependency installation status**
exec
bash -lc 'ls node_modules/.pnpm | grep fastify' in /var/home/rick/Development/playlist-manager succeeded in 39ms:
fastify@5.6.1
@fastify+accept-negotiator@2.0.1
@fastify+ajv-compiler@4.0.5
@fastify+error@4.2.0
@fastify+fast-json-stringify-compiler@5.0.3
@fastify+forwarded@3.0.1
@fastify+merge-json-schemas@0.2.1
fastify-plugin@5.1.0
@fastify+proxy-addr@5.1.0
@fastify+send@4.1.0
@fastify+static@8.3.0
file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Investigating missing fastify symlink in node_modules**
exec
bash -lc 'find node_modules/.pnpm/fastify@5.6.1 -maxdepth 3' in /var/home/rick/Development/playlist-manager succeeded in 90ms:
node_modules/.pnpm/fastify@5.6.1
node_modules/.pnpm/fastify@5.6.1/node_modules
file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Investigating pnpm symlinks**
exec
bash -lc 'ls -l node_modules/.pnpm/fastify@5.6.1' in /var/home/rick/Development/playlist-manager succeeded in 95ms:
total 0
drwxr-xr-x 1 rick rick 0 Nov  5 23:35 node_modules
file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Investigating node_modules structure**
exec
bash -lc 'cat .npmrc' in /var/home/rick/Development/playlist-manager succeeded in 41ms:
ignore-workspace-root-check=true
file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Investigating node_modules symlinks**
exec
bash -lc 'cat node_modules/.modules.yaml' in /var/home/rick/Development/playlist-manager exited 1 in 42ms:
cat: node_modules/.modules.yaml: No such file or directory
file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Checking node_modules contents**
exec
bash -lc 'ls node_modules | head' in /var/home/rick/Development/playlist-manager succeeded in 90ms:
acorn
acorn-jsx
ajv
@ampproject
ansi-align
ansi-escapes
ansi-regex
ansis
ansi-styles
@antfu
file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Checking for fastify package presence**
exec
bash -lc 'ls node_modules | grep -i fast' in /var/home/rick/Development/playlist-manager succeeded in 39ms:
fast-deep-equal
fast-diff
fast-glob
fast-json-stable-stringify
fast-levenshtein
fastq
fast-xml-parser
file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Investigating fastify dependency installation**
exec
bash -lc 'ls apps/api' in /var/home/rick/Development/playlist-manager succeeded in 39ms:
public
src
file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Investigating missing Fastify in pnpm workspace**
exec
bash -lc 'ls node_modules/.pnpm/node_modules' in /var/home/rick/Development/playlist-manager exited 2 in 79ms:
ls: cannot access 'node_modules/.pnpm/node_modules': No such file or directory
file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Investigating package storage locations**
exec
bash -lc 'ls node_modules/acorn | head' in /var/home/rick/Development/playlist-manager succeeded in 38ms:
bin
CHANGELOG.md
dist
LICENSE
package.json
README.md
file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Investigating missing package files**
exec
bash -lc 'find node_modules/.pnpm/fastify@5.6.1 -maxdepth 5 | head' in /var/home/rick/Development/playlist-manager succeeded in 38ms:
node_modules/.pnpm/fastify@5.6.1
node_modules/.pnpm/fastify@5.6.1/node_modules
file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Investigating missing fastify dependency**
exec
bash -lc 'ls apps/api' in /var/home/rick/Development/playlist-manager succeeded in 38ms:
public
src
file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Investigating missing dependencies and installation issues**
exec
bash -lc 'find node_modules/.pnpm/acorn@8.11.3 -maxdepth 3' in /var/home/rick/Development/playlist-manager exited 1 in 38ms:
find: ‘node_modules/.pnpm/acorn@8.11.3’: No such file or directory
file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Checking .pnpm directory contents**
exec
bash -lc 'ls node_modules/.pnpm | head -n 50' in /var/home/rick/Development/playlist-manager succeeded in 41ms:
abort-controller@3.0.0
abstract-logging@2.0.1
accepts@1.3.8
agent-base@6.0.2
agent-base@7.1.4
ajv@6.12.3
ajv@6.12.6
ajv@8.17.1
ajv-formats@2.1.1_ajv@8.17.1
ajv-formats@3.0.1_ajv@8.17.1
ansi-colors@4.1.3
ansi-escapes@4.3.2
ansi-regex@5.0.1
ansi-regex@6.2.2
ansi-styles@3.2.1
ansi-styles@4.3.0
ansi-styles@5.2.0
ansi-styles@6.2.3
anymatch@3.1.3
api-blueprint-http-formatter@0.0.1
file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Investigating nested node_modules structure**
exec
bash -lc 'ls node_modules/.pnpm/fastify@5.6.1/node_modules/fastify' in /var/home/rick/Development/playlist-manager exited 2 in 38ms:
ls: cannot access 'node_modules/.pnpm/fastify@5.6.1/node_modules/fastify': No such file or directory
file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Checking nested node_modules directories**
exec
bash -lc 'find node_modules/.pnpm/fastify@5.6.1 -maxdepth 5 -type f | head' in /var/home/rick/Development/playlist-manager succeeded in 39ms:

file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Investigating missing package files**
exec
bash -lc "rg -n \"fastify-5\\.6\\.1\" -g\"*\"" in /var/home/rick/Development/playlist-manager exited 124 in 10.07s:
codex/LOGS/tasklog_05a_pif_validator_1762403333.log:699: WARN  GET https://registry.npmjs.org/fastify/-/fastify-5.6.1.tgz error (EAI_AGAIN). Will retry in 10 seconds. 2 retries left.
file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Evaluating workarounds for missing Fastify package**

I'm trying to figure out why Fastify isn't available for tests—`rg` timed out searching, and network access is disabled so I can't install it. Mocking Fastify is complicated because the plugin relies on real functionality. I'm considering whether I can locate the pnpm store locally or extract Fastify manually by running `pnpm store path` to find where packages might be cached. This might let me access Fastify despite the restrictions.
exec
bash -lc 'pnpm store path' in /var/home/rick/Development/playlist-manager succeeded in 1.09s:
/home/rick/.local/share/pnpm/store/v10/v3
file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Checking local pnpm package store**
exec
bash -lc 'ls /home/rick/.local/share/pnpm/store/v10/v3 | head' in /var/home/rick/Development/playlist-manager succeeded in 40ms:
files
file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Checking hashed directories in files**
exec
bash -lc 'ls /home/rick/.local/share/pnpm/store/v10/v3/files | head' in /var/home/rick/Development/playlist-manager succeeded in 82ms:
00
01
02
03
04
05
06
07
08
09
file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Evaluating offline package installation**
exec
bash -lc 'pnpm install --offline' in /var/home/rick/Development/playlist-manager exited 1 in 1.27s:
Scope: all 9 workspace projects
/var/home/rick/Development/playlist-manager/packages/interop:
 ERR_PNPM_NO_OFFLINE_META  Failed to resolve ajv@>=6.12.6 <7.0.0-0 in package mirror /home/rick/.cache/pnpm/metadata/registry.npmjs.org/ajv.json

This error happened while installing a direct dependency of /var/home/rick/Development/playlist-manager/packages/interop
file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Evaluating dependency installation and test feasibility**
exec
bash -lc 'pnpm install --prefer-offline' in /var/home/rick/Development/playlist-manager exited 1 in 1m 11s:
Scope: all 9 workspace projects
 WARN  GET https://registry.npmjs.org/ajv error (EAI_AGAIN). Will retry in 10 seconds. 2 retries left.
 WARN  GET https://registry.npmjs.org/fast-xml-parser error (EAI_AGAIN). Will retry in 10 seconds. 2 retries left.
 WARN  GET https://registry.npmjs.org/typescript error (EAI_AGAIN). Will retry in 10 seconds. 2 retries left.
Progress: resolved 0, reused 1, downloaded 0, added 0
Progress: resolved 20, reused 20, downloaded 0, added 0
 WARN  GET https://registry.npmjs.org/ajv error (EAI_AGAIN). Will retry in 1 minute. 1 retries left.
 WARN  GET https://registry.npmjs.org/fast-xml-parser error (EAI_AGAIN). Will retry in 1 minute. 1 retries left.
 WARN  GET https://registry.npmjs.org/typescript error (EAI_AGAIN). Will retry in 1 minute. 1 retries left.
/var/home/rick/Development/playlist-manager/packages/interop:
 ERR_PNPM_META_FETCH_FAIL  GET https://registry.npmjs.org/ajv: request to https://registry.npmjs.org/ajv failed, reason: getaddrinfo EAI_AGAIN registry.npmjs.org

This error happened while installing a direct dependency of /var/home/rick/Development/playlist-manager/packages/interop
file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Investigating local package cache for fastify**
exec
bash -lc "find /home/rick/.local/share/pnpm/store/v10/v3/files -maxdepth 2 -name '*fastify*' | head" in /var/home/rick/Development/playlist-manager succeeded in 9.44s:

file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Searching deeper for fastify files**
exec
bash -lc "find /home/rick/.local/share/pnpm/store/v10/v3/files -name '*fastify*' | head" in /var/home/rick/Development/playlist-manager succeeded in 109ms:

file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Analyzing test failures and outlining plugin updates**

I see the tests fail due to missing `fastify` because the environment lacks installed dependencies and network access prevents installing them. Despite this, I plan to proceed with updating the `ProblemBody` type and the error-handling plugin to ensure `request_id` is merged into the `details` object and included in response headers consistently. I’ll refine how request IDs are resolved and added in hooks and handlers, carefully handling edge cases like missing or array headers, and ensure the plugin is properly registered. This will keep error responses standard and correlated even though I can’t run tests now.
exec
bash -lc "sed -n '1,200p' apps/api/src/testServer.ts" in /var/home/rick/Development/playlist-manager succeeded in 41ms:
// apps/api/src/testServer.ts
import fastify, { FastifyInstance } from 'fastify';
import type { Server } from 'http';
import { problem } from './lib/problem.js';
import errorsPlugin from './plugins/errors.js';
import featureGuard from './plugins/feature-guard.js';
import { registerMiddleware } from './middleware.js';
import authProviders from './routes/auth.providers.js';
import { registerRouteHandlers } from './routes/register-handlers.js';

/**
 * Create a Fastify server for tests.
 * If a route module is missing, it is silently skipped (lets you test one route at a time).
 * Wire your OpenAPI response validator inside this function once available.
 */
export async function makeServer(): Promise<Server> {
  const app: FastifyInstance = fastify({
    logger: false, // enable per-test if you need debugging
  });

file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Inspecting plugin registration details**
exec
bash -lc "sed -n '1,200p' apps/api/src/middleware.ts" in /var/home/rick/Development/playlist-manager succeeded in 42ms:
import type { FastifyInstance } from 'fastify';

import { createResponseValidationHook } from './lib/openapi/validator.js';

export async function registerMiddleware(app: FastifyInstance): Promise<void> {
  const responseValidationHook = await createResponseValidationHook();
  app.addHook('preSerialization', responseValidationHook);
}
file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Verifying plugin registration and request ID handling**

I'm reviewing `apps/api/src/dev/start.ts` to confirm the plugin registration is properly handled before logging and considering whether to add or adjust `onRequest` hooks to set the `x-request-id` header safely on all responses, including errors and 404s. I also plan to update `ProblemBody` types to include `request_id` and search the codebase for all `request_id` references to ensure consistency.
exec
bash -lc 'rg -n "request_id" -g"*.ts"' in /var/home/rick/Development/playlist-manager succeeded in 45ms:
apps/api/src/plugins/__tests__/errors.test.ts:36:        request_id: 'req_test123',
packages/contracts/src/api.types.ts:225:                request_id: string | null;
apps/api/src/routes/__tests__/register-handlers.test.ts:42:        request_id: expect.any(String),
apps/api/src/lib/problem.ts:12:  request_id: string | null;
apps/api/src/lib/problem.ts:33:    request_id: requestId ?? null,
file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Preparing to update problem.ts references**
exec
bash -lc 'rg -n "ProblemBody" -n' in /var/home/rick/Development/playlist-manager succeeded in 55ms:
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:90:import { toProblemBody } from '../lib/problem';
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:99:    const body = toProblemBody({
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:109:**Checking function toProblemBody**
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:119:export type ProblemBody = {
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:26763:I see the tests fail due to missing `fastify` because the environment lacks installed dependencies and network access prevents installing them. Despite this, I plan to proceed with updating the `ProblemBody` type and the error-handling plugin to ensure `request_id` is merged into the `details` object and included in response headers consistently. I’ll refine how request IDs are resolved and added in hooks and handlers, carefully handling edge cases like missing or array headers, and ensure the plugin is properly registered. This will keep error responses standard and correlated even though I can’t run tests now.
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:27509:I'm reviewing `apps/api/src/dev/start.ts` to confirm the plugin registration is properly handled before logging and considering whether to add or adjust `onRequest` hooks to set the `x-request-id` header safely on all responses, including errors and 404s. I also plan to update `ProblemBody` types to include `request_id` and search the codebase for all `request_id` references to ensure consistency.
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:27874:bash -lc 'rg -n "ProblemBody" -n' in /var/home/rick/Development/playlist-manager
codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:297:import { toProblemBody } from '../lib/problem';
codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:306:    const body = toProblemBody({
codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:472:export type ProblemBody = {
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:950:import { toProblemBody } from '../lib/problem';
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:959:    const body = toProblemBody({
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:979:export type ProblemBody = {
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:2268:import { toProblemBody } from '../../../../../apps/api/src/lib/problem';
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:2303:      const body = toProblemBody({ status: 404, code: '"'not_found', message: 'Route not found', requestId: null });
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:2312:      const body = toProblemBody({ status: 401, code: 'unauthorized', message: 'Invalid or missing Authorization header', requestId: null });
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:2367:      const body = toProblemBody({
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:2521:+import { toProblemBody } from '../../../../../apps/api/src/lib/problem';
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:2536:+      const body = toProblemBody({ status: 404, code: 'not_found', message: 'Route not found', requestId: null });
codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:2545:+      const body = toProblemBody({ status: 401, code: 'unauthorized', message: 'Invalid or missing Authorization header', requestId: null });
file update:
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Designing enhanced error handling**

I'm planning to improve error handling by adding request ID management and enriching error responses with detailed metadata. This involves updating problem response bodies to always include a `details` object with a `request_id`, refining types, and adjusting plugin hooks. I’m also making sure helper functions handle optional details cleanly without mutating inputs, while setting up for tests despite missing dependencies.
file update
M /var/home/rick/Development/playlist-manager/apps/api/src/lib/problem.ts
@@ -11,4 +11,3 @@
   message: string;
-  request_id: string | null;
-  details: Record<string, unknown> | null;
+  details: Record<string, unknown> & { request_id: string | null };
 };
@@ -28,2 +27,6 @@
   const { status: _status, code, message, details, requestId } = options;
+  const safeDetails =
+    details && typeof details === 'object'
+      ? { ...(details as Record<string, unknown>) }
+      : ({} as Record<string, unknown>);
   return {
@@ -32,4 +35,6 @@
     message,
-    request_id: requestId ?? null,
-    details: details ?? null,
+    details: {
+      ...safeDetails,
+      request_id: requestId ?? null,
+    },
   };
apply_patch(auto_approved=true) exited 0 in 11ms:
Success. Updated the following files:
M apps/api/src/lib/problem.ts
file update:
diff --git a/apps/api/src/lib/problem.ts b/apps/api/src/lib/problem.ts
index b9b3925459beb43fa764a2efd842c1f3433c5442..165d8c4b0d8d5e3bb6892a9e1fca707dae229fac
--- a/apps/api/src/lib/problem.ts
+++ b/apps/api/src/lib/problem.ts
@@ -9,8 +9,7 @@
   type: string;
   code: string;
   message: string;
-  request_id: string | null;
-  details: Record<string, unknown> | null;
+  details: Record<string, unknown> & { request_id: string | null };
 };
 
 export function problem(options: ProblemOptions): Error {
@@ -26,11 +25,17 @@
 
 export function toProblemBody(options: ProblemOptions & { requestId?: string | null }): ProblemBody {
   const { status: _status, code, message, details, requestId } = options;
+  const safeDetails =
+    details && typeof details === 'object'
+      ? { ...(details as Record<string, unknown>) }
+      : ({} as Record<string, unknown>);
   return {
     type: 'about:blank',
     code,
     message,
-    request_id: requestId ?? null,
-    details: details ?? null,
+    details: {
+      ...safeDetails,
+      request_id: requestId ?? null,
+    },
   };
 }
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };

file update:
diff --git a/apps/api/src/lib/problem.ts b/apps/api/src/lib/problem.ts
index b9b3925459beb43fa764a2efd842c1f3433c5442..165d8c4b0d8d5e3bb6892a9e1fca707dae229fac
--- a/apps/api/src/lib/problem.ts
+++ b/apps/api/src/lib/problem.ts
@@ -9,8 +9,7 @@
   type: string;
   code: string;
   message: string;
-  request_id: string | null;
-  details: Record<string, unknown> | null;
+  details: Record<string, unknown> & { request_id: string | null };
 };
 
 export function problem(options: ProblemOptions): Error {
@@ -26,11 +25,17 @@
 
 export function toProblemBody(options: ProblemOptions & { requestId?: string | null }): ProblemBody {
   const { status: _status, code, message, details, requestId } = options;
+  const safeDetails =
+    details && typeof details === 'object'
+      ? { ...(details as Record<string, unknown>) }
+      : ({} as Record<string, unknown>);
   return {
     type: 'about:blank',
     code,
     message,
-    request_id: requestId ?? null,
-    details: details ?? null,
+    details: {
+      ...safeDetails,
+      request_id: requestId ?? null,
+    },
   };
 }
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Implementing enhanced error handling in plugin**

I’m making sure error handling uses a well-typed request ID resolver and default error codes mapping, carefully handling `details` typing, and updating the Fastify plugin’s hooks to consistently attach request IDs and properly format error and not-found responses. I'll ensure all typings, header handling, and status fallbacks are set cleanly for robustness.
file update
M /var/home/rick/Development/playlist-manager/apps/api/src/plugins/errors.ts
@@ -1,2 +1,3 @@
 import fp from 'fastify-plugin';
+import type { FastifyRequest } from 'fastify';
 import { nanoid } from 'nanoid';
@@ -5,5 +6,30 @@
 
+const DEFAULT_ERROR_CODES: Record<number, string> = {
+  400: 'bad_request',
+  401: 'unauthorized',
+  403: 'forbidden',
+  404: 'not_found',
+  409: 'conflict',
+  422: 'unprocessable_entity',
+  429: 'rate_limited',
+  503: 'service_unavailable',
+};
+
+function resolveRequestId(req: FastifyRequest): string {
+  const existing = (req as any).requestId;
+  if (typeof existing === 'string') {
+    return existing;
+  }
+
+  const header = req.headers['x-request-id'];
+  const headerValue = Array.isArray(header) ? header[0] : header;
+  const requestId = typeof headerValue === 'string' && headerValue.length > 0 ? headerValue : nanoid();
+  (req as any).requestId = requestId;
+  return requestId;
+}
+
 export default fp(async (app) => {
-  app.addHook('onRequest', async (req) => {
-    (req as any).requestId = req.headers['x-request-id'] || nanoid();
+  app.addHook('onRequest', async (req, reply) => {
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
   });
@@ -12,2 +38,4 @@
     const status = 404;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
     const body = toProblemBody({
@@ -16,4 +44,3 @@
       message: `Route ${req.method}:${req.url} not found`,
-      details: null,
-      requestId: (req as any).requestId ?? null,
+      requestId,
     });
@@ -23,5 +50,6 @@
   app.setErrorHandler((err, req, reply) => {
-    const status = (err as any).statusCode || 500;
-    const code =
-      (err as any).code || (status === 429 ? 'rate_limited' : status === 404 ? 'not_found' : 'internal');
+    const status = typeof (err as any).statusCode === 'number' ? (err as any).statusCode : 500;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
+    const code = (err as any).code ?? DEFAULT_ERROR_CODES[status] ?? 'internal';
     const body = toProblemBody({
@@ -30,4 +58,4 @@
       message: err.message || 'Internal Server Error',
-      details: (err as any).details ?? null,
-      requestId: (req as any).requestId ?? null,
+      details: (err as any).details ?? undefined,
+      requestId,
     });
apply_patch(auto_approved=true) exited 0 in 15ms:
Success. Updated the following files:
M apps/api/src/plugins/errors.ts
file update:
diff --git a/apps/api/src/lib/problem.ts b/apps/api/src/lib/problem.ts
index b9b3925459beb43fa764a2efd842c1f3433c5442..165d8c4b0d8d5e3bb6892a9e1fca707dae229fac
--- a/apps/api/src/lib/problem.ts
+++ b/apps/api/src/lib/problem.ts
@@ -9,8 +9,7 @@
   type: string;
   code: string;
   message: string;
-  request_id: string | null;
-  details: Record<string, unknown> | null;
+  details: Record<string, unknown> & { request_id: string | null };
 };
 
 export function problem(options: ProblemOptions): Error {
@@ -26,11 +25,17 @@
 
 export function toProblemBody(options: ProblemOptions & { requestId?: string | null }): ProblemBody {
   const { status: _status, code, message, details, requestId } = options;
+  const safeDetails =
+    details && typeof details === 'object'
+      ? { ...(details as Record<string, unknown>) }
+      : ({} as Record<string, unknown>);
   return {
     type: 'about:blank',
     code,
     message,
-    request_id: requestId ?? null,
-    details: details ?? null,
+    details: {
+      ...safeDetails,
+      request_id: requestId ?? null,
+    },
   };
 }
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/plugins/errors.ts b/apps/api/src/plugins/errors.ts
index ed9294b9b629899371086d50a56824547d746c9e..61afbee13811a270a982a0c34a8e5d931e0bab6c
--- a/apps/api/src/plugins/errors.ts
+++ b/apps/api/src/plugins/errors.ts
@@ -1,35 +1,63 @@
 import fp from 'fastify-plugin';
+import type { FastifyRequest } from 'fastify';
 import { nanoid } from 'nanoid';
 
 import { toProblemBody } from '../lib/problem';
 
+const DEFAULT_ERROR_CODES: Record<number, string> = {
+  400: 'bad_request',
+  401: 'unauthorized',
+  403: 'forbidden',
+  404: 'not_found',
+  409: 'conflict',
+  422: 'unprocessable_entity',
+  429: 'rate_limited',
+  503: 'service_unavailable',
+};
+
+function resolveRequestId(req: FastifyRequest): string {
+  const existing = (req as any).requestId;
+  if (typeof existing === 'string') {
+    return existing;
+  }
+
+  const header = req.headers['x-request-id'];
+  const headerValue = Array.isArray(header) ? header[0] : header;
+  const requestId = typeof headerValue === 'string' && headerValue.length > 0 ? headerValue : nanoid();
+  (req as any).requestId = requestId;
+  return requestId;
+}
+
 export default fp(async (app) => {
-  app.addHook('onRequest', async (req) => {
-    (req as any).requestId = req.headers['x-request-id'] || nanoid();
+  app.addHook('onRequest', async (req, reply) => {
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
   });
 
   app.setNotFoundHandler((req, reply) => {
     const status = 404;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
     const body = toProblemBody({
       status,
       code: 'not_found',
       message: `Route ${req.method}:${req.url} not found`,
-      details: null,
-      requestId: (req as any).requestId ?? null,
+      requestId,
     });
     reply.status(status).send(body);
   });
 
   app.setErrorHandler((err, req, reply) => {
-    const status = (err as any).statusCode || 500;
-    const code =
-      (err as any).code || (status === 429 ? 'rate_limited' : status === 404 ? 'not_found' : 'internal');
+    const status = typeof (err as any).statusCode === 'number' ? (err as any).statusCode : 500;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
+    const code = (err as any).code ?? DEFAULT_ERROR_CODES[status] ?? 'internal';
     const body = toProblemBody({
       status,
       code,
       message: err.message || 'Internal Server Error',
-      details: (err as any).details ?? null,
-      requestId: (req as any).requestId ?? null,
+      details: (err as any).details ?? undefined,
+      requestId,
     });
     reply.status(status).send(body);
   });
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };

file update:
diff --git a/apps/api/src/lib/problem.ts b/apps/api/src/lib/problem.ts
index b9b3925459beb43fa764a2efd842c1f3433c5442..165d8c4b0d8d5e3bb6892a9e1fca707dae229fac
--- a/apps/api/src/lib/problem.ts
+++ b/apps/api/src/lib/problem.ts
@@ -9,8 +9,7 @@
   type: string;
   code: string;
   message: string;
-  request_id: string | null;
-  details: Record<string, unknown> | null;
+  details: Record<string, unknown> & { request_id: string | null };
 };
 
 export function problem(options: ProblemOptions): Error {
@@ -26,11 +25,17 @@
 
 export function toProblemBody(options: ProblemOptions & { requestId?: string | null }): ProblemBody {
   const { status: _status, code, message, details, requestId } = options;
+  const safeDetails =
+    details && typeof details === 'object'
+      ? { ...(details as Record<string, unknown>) }
+      : ({} as Record<string, unknown>);
   return {
     type: 'about:blank',
     code,
     message,
-    request_id: requestId ?? null,
-    details: details ?? null,
+    details: {
+      ...safeDetails,
+      request_id: requestId ?? null,
+    },
   };
 }
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/plugins/errors.ts b/apps/api/src/plugins/errors.ts
index ed9294b9b629899371086d50a56824547d746c9e..61afbee13811a270a982a0c34a8e5d931e0bab6c
--- a/apps/api/src/plugins/errors.ts
+++ b/apps/api/src/plugins/errors.ts
@@ -1,35 +1,63 @@
 import fp from 'fastify-plugin';
+import type { FastifyRequest } from 'fastify';
 import { nanoid } from 'nanoid';
 
 import { toProblemBody } from '../lib/problem';
 
+const DEFAULT_ERROR_CODES: Record<number, string> = {
+  400: 'bad_request',
+  401: 'unauthorized',
+  403: 'forbidden',
+  404: 'not_found',
+  409: 'conflict',
+  422: 'unprocessable_entity',
+  429: 'rate_limited',
+  503: 'service_unavailable',
+};
+
+function resolveRequestId(req: FastifyRequest): string {
+  const existing = (req as any).requestId;
+  if (typeof existing === 'string') {
+    return existing;
+  }
+
+  const header = req.headers['x-request-id'];
+  const headerValue = Array.isArray(header) ? header[0] : header;
+  const requestId = typeof headerValue === 'string' && headerValue.length > 0 ? headerValue : nanoid();
+  (req as any).requestId = requestId;
+  return requestId;
+}
+
 export default fp(async (app) => {
-  app.addHook('onRequest', async (req) => {
-    (req as any).requestId = req.headers['x-request-id'] || nanoid();
+  app.addHook('onRequest', async (req, reply) => {
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
   });
 
   app.setNotFoundHandler((req, reply) => {
     const status = 404;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
     const body = toProblemBody({
       status,
       code: 'not_found',
       message: `Route ${req.method}:${req.url} not found`,
-      details: null,
-      requestId: (req as any).requestId ?? null,
+      requestId,
     });
     reply.status(status).send(body);
   });
 
   app.setErrorHandler((err, req, reply) => {
-    const status = (err as any).statusCode || 500;
-    const code =
-      (err as any).code || (status === 429 ? 'rate_limited' : status === 404 ? 'not_found' : 'internal');
+    const status = typeof (err as any).statusCode === 'number' ? (err as any).statusCode : 500;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
+    const code = (err as any).code ?? DEFAULT_ERROR_CODES[status] ?? 'internal';
     const body = toProblemBody({
       status,
       code,
       message: err.message || 'Internal Server Error',
-      details: (err as any).details ?? null,
-      requestId: (req as any).requestId ?? null,
+      details: (err as any).details ?? undefined,
+      requestId,
     });
     reply.status(status).send(body);
   });
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Verifying request ID handling and error plugin consistency**
exec
bash -lc 'rg -n "request_id"' in /var/home/rick/Development/playlist-manager succeeded in 52ms:
openapi.yaml:650:                details: { request_id: req_123456abcdef }
openapi.yaml:663:                details: { request_id: req_missing404 }
openapi.yaml:676:                details: { request_id: req_rate429 }
openapi.yaml:689:                details: { request_id: req_unauth123 }
openapi.yaml:702:                details: { request_id: req_503svc }
openapi.yaml:715:                details: { request_id: req_422body }
openapi.yaml:727:          description: Additional metadata for debugging, always includes request_id.
openapi.yaml:728:          required: [request_id]
openapi.yaml:731:            request_id:
openapi.yaml:737:            request_id: req_abc123
codex/LOGS/tasklog_04a_api_validation_wiring_1762394370.log:476:  request_id: string | null;
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:123:  request_id: string | null;
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:178:bash -lc 'rg -n "request_id" -n' in /var/home/rick/Development/playlist-manager succeeded in 48ms:
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:179:openapi.yaml:656:        request_id:
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:180:codex/LOGS/tasklog_07c_error_contracts_1763302301.log:123:  request_id: string | null;
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:181:codex/LOGS/tasklog_07c_error_contracts_1763302301.log:178:bash -lc 'rg -n "request_id" -n' in /var/home/rick/Development/playlist-manager
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:182:codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log:983:  request_id: string | null;
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:183:apps/api/src/lib/openapi/openapi.json:920:          "request_id": {
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:184:apps/api/src/lib/problem.ts:12:  request_id: string | null;
codex/LOGS/tasklog_07c_error_contracts_1763302301.log:185:apps/api/src/lib/problem.ts:33:    request_id: requestId ?? null,
file update:
diff --git a/apps/api/src/lib/problem.ts b/apps/api/src/lib/problem.ts
index b9b3925459beb43fa764a2efd842c1f3433c5442..165d8c4b0d8d5e3bb6892a9e1fca707dae229fac
--- a/apps/api/src/lib/problem.ts
+++ b/apps/api/src/lib/problem.ts
@@ -9,8 +9,7 @@
   type: string;
   code: string;
   message: string;
-  request_id: string | null;
-  details: Record<string, unknown> | null;
+  details: Record<string, unknown> & { request_id: string | null };
 };
 
 export function problem(options: ProblemOptions): Error {
@@ -26,11 +25,17 @@
 
 export function toProblemBody(options: ProblemOptions & { requestId?: string | null }): ProblemBody {
   const { status: _status, code, message, details, requestId } = options;
+  const safeDetails =
+    details && typeof details === 'object'
+      ? { ...(details as Record<string, unknown>) }
+      : ({} as Record<string, unknown>);
   return {
     type: 'about:blank',
     code,
     message,
-    request_id: requestId ?? null,
-    details: details ?? null,
+    details: {
+      ...safeDetails,
+      request_id: requestId ?? null,
+    },
   };
 }
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/plugins/errors.ts b/apps/api/src/plugins/errors.ts
index ed9294b9b629899371086d50a56824547d746c9e..61afbee13811a270a982a0c34a8e5d931e0bab6c
--- a/apps/api/src/plugins/errors.ts
+++ b/apps/api/src/plugins/errors.ts
@@ -1,35 +1,63 @@
 import fp from 'fastify-plugin';
+import type { FastifyRequest } from 'fastify';
 import { nanoid } from 'nanoid';
 
 import { toProblemBody } from '../lib/problem';
 
+const DEFAULT_ERROR_CODES: Record<number, string> = {
+  400: 'bad_request',
+  401: 'unauthorized',
+  403: 'forbidden',
+  404: 'not_found',
+  409: 'conflict',
+  422: 'unprocessable_entity',
+  429: 'rate_limited',
+  503: 'service_unavailable',
+};
+
+function resolveRequestId(req: FastifyRequest): string {
+  const existing = (req as any).requestId;
+  if (typeof existing === 'string') {
+    return existing;
+  }
+
+  const header = req.headers['x-request-id'];
+  const headerValue = Array.isArray(header) ? header[0] : header;
+  const requestId = typeof headerValue === 'string' && headerValue.length > 0 ? headerValue : nanoid();
+  (req as any).requestId = requestId;
+  return requestId;
+}
+
 export default fp(async (app) => {
-  app.addHook('onRequest', async (req) => {
-    (req as any).requestId = req.headers['x-request-id'] || nanoid();
+  app.addHook('onRequest', async (req, reply) => {
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
   });
 
   app.setNotFoundHandler((req, reply) => {
     const status = 404;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
     const body = toProblemBody({
       status,
       code: 'not_found',
       message: `Route ${req.method}:${req.url} not found`,
-      details: null,
-      requestId: (req as any).requestId ?? null,
+      requestId,
     });
     reply.status(status).send(body);
   });
 
   app.setErrorHandler((err, req, reply) => {
-    const status = (err as any).statusCode || 500;
-    const code =
-      (err as any).code || (status === 429 ? 'rate_limited' : status === 404 ? 'not_found' : 'internal');
+    const status = typeof (err as any).statusCode === 'number' ? (err as any).statusCode : 500;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
+    const code = (err as any).code ?? DEFAULT_ERROR_CODES[status] ?? 'internal';
     const body = toProblemBody({
       status,
       code,
       message: err.message || 'Internal Server Error',
-      details: (err as any).details ?? null,
-      requestId: (req as any).requestId ?? null,
+      details: (err as any).details ?? undefined,
+      requestId,
     });
     reply.status(status).send(body);
   });
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Filtering grep results to exclude logs**
exec
bash -lc "rg -n \"request_id\" --glob '"'!codex/LOGS/**'"'" in /var/home/rick/Development/playlist-manager succeeded in 51ms:
openapi.yaml:650:                details: { request_id: req_123456abcdef }
openapi.yaml:663:                details: { request_id: req_missing404 }
openapi.yaml:676:                details: { request_id: req_rate429 }
openapi.yaml:689:                details: { request_id: req_unauth123 }
openapi.yaml:702:                details: { request_id: req_503svc }
openapi.yaml:715:                details: { request_id: req_422body }
openapi.yaml:727:          description: Additional metadata for debugging, always includes request_id.
openapi.yaml:728:          required: [request_id]
openapi.yaml:731:            request_id:
openapi.yaml:737:            request_id: req_abc123
apps/api/src/plugins/__tests__/errors.test.ts:36:        request_id: 'req_test123',
apps/api/src/routes/__tests__/register-handlers.test.ts:42:        request_id: expect.any(String),
packages/contracts/src/api.types.ts:225:                request_id: string | null;
apps/api/src/lib/problem.ts:12:  details: Record<string, unknown> & { request_id: string | null };
apps/api/src/lib/problem.ts:38:      request_id: requestId ?? null,
apps/api/src/lib/openapi/openapi.json:1114:                    "request_id": "req_123456abcdef"
apps/api/src/lib/openapi/openapi.json:1137:                    "request_id": "req_missing404"
apps/api/src/lib/openapi/openapi.json:1160:                    "request_id": "req_rate429"
apps/api/src/lib/openapi/openapi.json:1183:                    "request_id": "req_unauth123"
apps/api/src/lib/openapi/openapi.json:1206:                    "request_id": "req_503svc"
file update:
diff --git a/apps/api/src/lib/problem.ts b/apps/api/src/lib/problem.ts
index b9b3925459beb43fa764a2efd842c1f3433c5442..165d8c4b0d8d5e3bb6892a9e1fca707dae229fac
--- a/apps/api/src/lib/problem.ts
+++ b/apps/api/src/lib/problem.ts
@@ -9,8 +9,7 @@
   type: string;
   code: string;
   message: string;
-  request_id: string | null;
-  details: Record<string, unknown> | null;
+  details: Record<string, unknown> & { request_id: string | null };
 };
 
 export function problem(options: ProblemOptions): Error {
@@ -26,11 +25,17 @@
 
 export function toProblemBody(options: ProblemOptions & { requestId?: string | null }): ProblemBody {
   const { status: _status, code, message, details, requestId } = options;
+  const safeDetails =
+    details && typeof details === 'object'
+      ? { ...(details as Record<string, unknown>) }
+      : ({} as Record<string, unknown>);
   return {
     type: 'about:blank',
     code,
     message,
-    request_id: requestId ?? null,
-    details: details ?? null,
+    details: {
+      ...safeDetails,
+      request_id: requestId ?? null,
+    },
   };
 }
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/plugins/errors.ts b/apps/api/src/plugins/errors.ts
index ed9294b9b629899371086d50a56824547d746c9e..61afbee13811a270a982a0c34a8e5d931e0bab6c
--- a/apps/api/src/plugins/errors.ts
+++ b/apps/api/src/plugins/errors.ts
@@ -1,35 +1,63 @@
 import fp from 'fastify-plugin';
+import type { FastifyRequest } from 'fastify';
 import { nanoid } from 'nanoid';
 
 import { toProblemBody } from '../lib/problem';
 
+const DEFAULT_ERROR_CODES: Record<number, string> = {
+  400: 'bad_request',
+  401: 'unauthorized',
+  403: 'forbidden',
+  404: 'not_found',
+  409: 'conflict',
+  422: 'unprocessable_entity',
+  429: 'rate_limited',
+  503: 'service_unavailable',
+};
+
+function resolveRequestId(req: FastifyRequest): string {
+  const existing = (req as any).requestId;
+  if (typeof existing === 'string') {
+    return existing;
+  }
+
+  const header = req.headers['x-request-id'];
+  const headerValue = Array.isArray(header) ? header[0] : header;
+  const requestId = typeof headerValue === 'string' && headerValue.length > 0 ? headerValue : nanoid();
+  (req as any).requestId = requestId;
+  return requestId;
+}
+
 export default fp(async (app) => {
-  app.addHook('onRequest', async (req) => {
-    (req as any).requestId = req.headers['x-request-id'] || nanoid();
+  app.addHook('onRequest', async (req, reply) => {
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
   });
 
   app.setNotFoundHandler((req, reply) => {
     const status = 404;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
     const body = toProblemBody({
       status,
       code: 'not_found',
       message: `Route ${req.method}:${req.url} not found`,
-      details: null,
-      requestId: (req as any).requestId ?? null,
+      requestId,
     });
     reply.status(status).send(body);
   });
 
   app.setErrorHandler((err, req, reply) => {
-    const status = (err as any).statusCode || 500;
-    const code =
-      (err as any).code || (status === 429 ? 'rate_limited' : status === 404 ? 'not_found' : 'internal');
+    const status = typeof (err as any).statusCode === 'number' ? (err as any).statusCode : 500;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
+    const code = (err as any).code ?? DEFAULT_ERROR_CODES[status] ?? 'internal';
     const body = toProblemBody({
       status,
       code,
       message: err.message || 'Internal Server Error',
-      details: (err as any).details ?? null,
-      requestId: (req as any).requestId ?? null,
+      details: (err as any).details ?? undefined,
+      requestId,
     });
     reply.status(status).send(body);
   });
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Reviewing type references and updating plan**
Plan update
  ✓ Review existing error handling spec/tests to understand gaps vs TASK 07c requirements
  ✓ Update OpenAPI spec + generated types to define the unified error schema/responses and expected metadata
  ✓ Add/adjust tests (plugins/routes) that enforce the new error contract behavior (request-id echo, response schema) to fail prior to implementation
  ✓ Implement Fastify error plugin changes + server wiring to satisfy tests/spec
  • Run test suite and finalize (including git status/commit)
file update:
diff --git a/apps/api/src/lib/problem.ts b/apps/api/src/lib/problem.ts
index b9b3925459beb43fa764a2efd842c1f3433c5442..165d8c4b0d8d5e3bb6892a9e1fca707dae229fac
--- a/apps/api/src/lib/problem.ts
+++ b/apps/api/src/lib/problem.ts
@@ -9,8 +9,7 @@
   type: string;
   code: string;
   message: string;
-  request_id: string | null;
-  details: Record<string, unknown> | null;
+  details: Record<string, unknown> & { request_id: string | null };
 };
 
 export function problem(options: ProblemOptions): Error {
@@ -26,11 +25,17 @@
 
 export function toProblemBody(options: ProblemOptions & { requestId?: string | null }): ProblemBody {
   const { status: _status, code, message, details, requestId } = options;
+  const safeDetails =
+    details && typeof details === 'object'
+      ? { ...(details as Record<string, unknown>) }
+      : ({} as Record<string, unknown>);
   return {
     type: 'about:blank',
     code,
     message,
-    request_id: requestId ?? null,
-    details: details ?? null,
+    details: {
+      ...safeDetails,
+      request_id: requestId ?? null,
+    },
   };
 }
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/plugins/errors.ts b/apps/api/src/plugins/errors.ts
index ed9294b9b629899371086d50a56824547d746c9e..61afbee13811a270a982a0c34a8e5d931e0bab6c
--- a/apps/api/src/plugins/errors.ts
+++ b/apps/api/src/plugins/errors.ts
@@ -1,35 +1,63 @@
 import fp from 'fastify-plugin';
+import type { FastifyRequest } from 'fastify';
 import { nanoid } from 'nanoid';
 
 import { toProblemBody } from '../lib/problem';
 
+const DEFAULT_ERROR_CODES: Record<number, string> = {
+  400: 'bad_request',
+  401: 'unauthorized',
+  403: 'forbidden',
+  404: 'not_found',
+  409: 'conflict',
+  422: 'unprocessable_entity',
+  429: 'rate_limited',
+  503: 'service_unavailable',
+};
+
+function resolveRequestId(req: FastifyRequest): string {
+  const existing = (req as any).requestId;
+  if (typeof existing === 'string') {
+    return existing;
+  }
+
+  const header = req.headers['x-request-id'];
+  const headerValue = Array.isArray(header) ? header[0] : header;
+  const requestId = typeof headerValue === 'string' && headerValue.length > 0 ? headerValue : nanoid();
+  (req as any).requestId = requestId;
+  return requestId;
+}
+
 export default fp(async (app) => {
-  app.addHook('onRequest', async (req) => {
-    (req as any).requestId = req.headers['x-request-id'] || nanoid();
+  app.addHook('onRequest', async (req, reply) => {
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
   });
 
   app.setNotFoundHandler((req, reply) => {
     const status = 404;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
     const body = toProblemBody({
       status,
       code: 'not_found',
       message: `Route ${req.method}:${req.url} not found`,
-      details: null,
-      requestId: (req as any).requestId ?? null,
+      requestId,
     });
     reply.status(status).send(body);
   });
 
   app.setErrorHandler((err, req, reply) => {
-    const status = (err as any).statusCode || 500;
-    const code =
-      (err as any).code || (status === 429 ? 'rate_limited' : status === 404 ? 'not_found' : 'internal');
+    const status = typeof (err as any).statusCode === 'number' ? (err as any).statusCode : 500;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
+    const code = (err as any).code ?? DEFAULT_ERROR_CODES[status] ?? 'internal';
     const body = toProblemBody({
       status,
       code,
       message: err.message || 'Internal Server Error',
-      details: (err as any).details ?? null,
-      requestId: (req as any).requestId ?? null,
+      details: (err as any).details ?? undefined,
+      requestId,
     });
     reply.status(status).send(body);
   });
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Preparing to rerun tests**
exec
bash -lc 'pnpm vitest run apps/api/src/plugins/__tests__/errors.test.ts apps/api/src/routes/__tests__/register-handlers.test.ts' in /var/home/rick/Development/playlist-manager exited 1 in 2.01s:

 RUN  v3.1.1 /var/home/rick/Development/playlist-manager


⎯⎯⎯⎯⎯⎯ Failed Suites 2 ⎯⎯⎯⎯⎯⎯⎯

 FAIL  apps/api/src/plugins/__tests__/errors.test.ts [ apps/api/src/plugins/__tests__/errors.test.ts ]
 FAIL  apps/api/src/routes/__tests__/register-handlers.test.ts [ apps/api/src/routes/__tests__/register-handlers.test.ts ]
Error: Failed to load url fastify (resolved id: fastify) in /var/home/rick/Development/playlist-manager/apps/api/src/plugins/__tests__/errors.test.ts. Does the file exist?
 ❯ loadAndTransform node_modules/vite/dist/node/chunks/dep-Bid9ssRr.js:41317:17

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/2]⎯


 Test Files  2 failed (2)
      Tests  no tests
   Start at  09:34:37
   Duration  344ms (transform 77ms, setup 0ms, collect 0ms, tests 0ms, environment 1ms, prepare 164ms)

file update:
diff --git a/apps/api/src/lib/problem.ts b/apps/api/src/lib/problem.ts
index b9b3925459beb43fa764a2efd842c1f3433c5442..165d8c4b0d8d5e3bb6892a9e1fca707dae229fac
--- a/apps/api/src/lib/problem.ts
+++ b/apps/api/src/lib/problem.ts
@@ -9,8 +9,7 @@
   type: string;
   code: string;
   message: string;
-  request_id: string | null;
-  details: Record<string, unknown> | null;
+  details: Record<string, unknown> & { request_id: string | null };
 };
 
 export function problem(options: ProblemOptions): Error {
@@ -26,11 +25,17 @@
 
 export function toProblemBody(options: ProblemOptions & { requestId?: string | null }): ProblemBody {
   const { status: _status, code, message, details, requestId } = options;
+  const safeDetails =
+    details && typeof details === 'object'
+      ? { ...(details as Record<string, unknown>) }
+      : ({} as Record<string, unknown>);
   return {
     type: 'about:blank',
     code,
     message,
-    request_id: requestId ?? null,
-    details: details ?? null,
+    details: {
+      ...safeDetails,
+      request_id: requestId ?? null,
+    },
   };
 }
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/plugins/errors.ts b/apps/api/src/plugins/errors.ts
index ed9294b9b629899371086d50a56824547d746c9e..61afbee13811a270a982a0c34a8e5d931e0bab6c
--- a/apps/api/src/plugins/errors.ts
+++ b/apps/api/src/plugins/errors.ts
@@ -1,35 +1,63 @@
 import fp from 'fastify-plugin';
+import type { FastifyRequest } from 'fastify';
 import { nanoid } from 'nanoid';
 
 import { toProblemBody } from '../lib/problem';
 
+const DEFAULT_ERROR_CODES: Record<number, string> = {
+  400: 'bad_request',
+  401: 'unauthorized',
+  403: 'forbidden',
+  404: 'not_found',
+  409: 'conflict',
+  422: 'unprocessable_entity',
+  429: 'rate_limited',
+  503: 'service_unavailable',
+};
+
+function resolveRequestId(req: FastifyRequest): string {
+  const existing = (req as any).requestId;
+  if (typeof existing === 'string') {
+    return existing;
+  }
+
+  const header = req.headers['x-request-id'];
+  const headerValue = Array.isArray(header) ? header[0] : header;
+  const requestId = typeof headerValue === 'string' && headerValue.length > 0 ? headerValue : nanoid();
+  (req as any).requestId = requestId;
+  return requestId;
+}
+
 export default fp(async (app) => {
-  app.addHook('onRequest', async (req) => {
-    (req as any).requestId = req.headers['x-request-id'] || nanoid();
+  app.addHook('onRequest', async (req, reply) => {
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
   });
 
   app.setNotFoundHandler((req, reply) => {
     const status = 404;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
     const body = toProblemBody({
       status,
       code: 'not_found',
       message: `Route ${req.method}:${req.url} not found`,
-      details: null,
-      requestId: (req as any).requestId ?? null,
+      requestId,
     });
     reply.status(status).send(body);
   });
 
   app.setErrorHandler((err, req, reply) => {
-    const status = (err as any).statusCode || 500;
-    const code =
-      (err as any).code || (status === 429 ? 'rate_limited' : status === 404 ? 'not_found' : 'internal');
+    const status = typeof (err as any).statusCode === 'number' ? (err as any).statusCode : 500;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
+    const code = (err as any).code ?? DEFAULT_ERROR_CODES[status] ?? 'internal';
     const body = toProblemBody({
       status,
       code,
       message: err.message || 'Internal Server Error',
-      details: (err as any).details ?? null,
-      requestId: (req as any).requestId ?? null,
+      details: (err as any).details ?? undefined,
+      requestId,
     });
     reply.status(status).send(body);
   });
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Documenting test failures and next steps**
exec
bash -lc 'git status -sb' in /var/home/rick/Development/playlist-manager succeeded in 45ms:
## main...origin/main [ahead 12]
 M apps/api/src/lib/openapi/openapi.json
 M apps/api/src/lib/problem.ts
 M apps/api/src/plugins/errors.ts
 M apps/api/src/routes/__tests__/register-handlers.test.ts
 M openapi.yaml
 M packages/contracts/src/api.types.ts
?? Jackett.Binaries.LinuxAMDx64.tar.gz
?? Jackett/
?? apps/api/src/plugins/__tests__/
?? codex/LOGS/codex_run_2025-11-16_08-49-16.log
?? codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log
?? codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log.done
?? codex/LOGS/tasklog_07c_error_contracts_1763302301.log
?? codex/TASKS/q
?? codex/TASKS/work_list
file update:
diff --git a/apps/api/src/lib/problem.ts b/apps/api/src/lib/problem.ts
index b9b3925459beb43fa764a2efd842c1f3433c5442..165d8c4b0d8d5e3bb6892a9e1fca707dae229fac
--- a/apps/api/src/lib/problem.ts
+++ b/apps/api/src/lib/problem.ts
@@ -9,8 +9,7 @@
   type: string;
   code: string;
   message: string;
-  request_id: string | null;
-  details: Record<string, unknown> | null;
+  details: Record<string, unknown> & { request_id: string | null };
 };
 
 export function problem(options: ProblemOptions): Error {
@@ -26,11 +25,17 @@
 
 export function toProblemBody(options: ProblemOptions & { requestId?: string | null }): ProblemBody {
   const { status: _status, code, message, details, requestId } = options;
+  const safeDetails =
+    details && typeof details === 'object'
+      ? { ...(details as Record<string, unknown>) }
+      : ({} as Record<string, unknown>);
   return {
     type: 'about:blank',
     code,
     message,
-    request_id: requestId ?? null,
-    details: details ?? null,
+    details: {
+      ...safeDetails,
+      request_id: requestId ?? null,
+    },
   };
 }
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/plugins/errors.ts b/apps/api/src/plugins/errors.ts
index ed9294b9b629899371086d50a56824547d746c9e..61afbee13811a270a982a0c34a8e5d931e0bab6c
--- a/apps/api/src/plugins/errors.ts
+++ b/apps/api/src/plugins/errors.ts
@@ -1,35 +1,63 @@
 import fp from 'fastify-plugin';
+import type { FastifyRequest } from 'fastify';
 import { nanoid } from 'nanoid';
 
 import { toProblemBody } from '../lib/problem';
 
+const DEFAULT_ERROR_CODES: Record<number, string> = {
+  400: 'bad_request',
+  401: 'unauthorized',
+  403: 'forbidden',
+  404: 'not_found',
+  409: 'conflict',
+  422: 'unprocessable_entity',
+  429: 'rate_limited',
+  503: 'service_unavailable',
+};
+
+function resolveRequestId(req: FastifyRequest): string {
+  const existing = (req as any).requestId;
+  if (typeof existing === 'string') {
+    return existing;
+  }
+
+  const header = req.headers['x-request-id'];
+  const headerValue = Array.isArray(header) ? header[0] : header;
+  const requestId = typeof headerValue === 'string' && headerValue.length > 0 ? headerValue : nanoid();
+  (req as any).requestId = requestId;
+  return requestId;
+}
+
 export default fp(async (app) => {
-  app.addHook('onRequest', async (req) => {
-    (req as any).requestId = req.headers['x-request-id'] || nanoid();
+  app.addHook('onRequest', async (req, reply) => {
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
   });
 
   app.setNotFoundHandler((req, reply) => {
     const status = 404;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
     const body = toProblemBody({
       status,
       code: 'not_found',
       message: `Route ${req.method}:${req.url} not found`,
-      details: null,
-      requestId: (req as any).requestId ?? null,
+      requestId,
     });
     reply.status(status).send(body);
   });
 
   app.setErrorHandler((err, req, reply) => {
-    const status = (err as any).statusCode || 500;
-    const code =
-      (err as any).code || (status === 429 ? 'rate_limited' : status === 404 ? 'not_found' : 'internal');
+    const status = typeof (err as any).statusCode === 'number' ? (err as any).statusCode : 500;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
+    const code = (err as any).code ?? DEFAULT_ERROR_CODES[status] ?? 'internal';
     const body = toProblemBody({
       status,
       code,
       message: err.message || 'Internal Server Error',
-      details: (err as any).details ?? null,
-      requestId: (req as any).requestId ?? null,
+      details: (err as any).details ?? undefined,
+      requestId,
     });
     reply.status(status).send(body);
   });
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Preparing commit with selective staging**
exec
bash -lc 'git add openapi.yaml apps/api/src/lib/openapi/openapi.json packages/contracts/src/api.types.ts apps/api/src/lib/problem.ts apps/api/src/plugins/errors.ts apps/api/src/routes/__tests__/register-handlers.test.ts apps/api/src/plugins/__tests__/errors.test.ts' in /var/home/rick/Development/playlist-manager succeeded in 45ms:

file update:
diff --git a/apps/api/src/lib/problem.ts b/apps/api/src/lib/problem.ts
index b9b3925459beb43fa764a2efd842c1f3433c5442..165d8c4b0d8d5e3bb6892a9e1fca707dae229fac
--- a/apps/api/src/lib/problem.ts
+++ b/apps/api/src/lib/problem.ts
@@ -9,8 +9,7 @@
   type: string;
   code: string;
   message: string;
-  request_id: string | null;
-  details: Record<string, unknown> | null;
+  details: Record<string, unknown> & { request_id: string | null };
 };
 
 export function problem(options: ProblemOptions): Error {
@@ -26,11 +25,17 @@
 
 export function toProblemBody(options: ProblemOptions & { requestId?: string | null }): ProblemBody {
   const { status: _status, code, message, details, requestId } = options;
+  const safeDetails =
+    details && typeof details === 'object'
+      ? { ...(details as Record<string, unknown>) }
+      : ({} as Record<string, unknown>);
   return {
     type: 'about:blank',
     code,
     message,
-    request_id: requestId ?? null,
-    details: details ?? null,
+    details: {
+      ...safeDetails,
+      request_id: requestId ?? null,
+    },
   };
 }
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/plugins/errors.ts b/apps/api/src/plugins/errors.ts
index ed9294b9b629899371086d50a56824547d746c9e..61afbee13811a270a982a0c34a8e5d931e0bab6c
--- a/apps/api/src/plugins/errors.ts
+++ b/apps/api/src/plugins/errors.ts
@@ -1,35 +1,63 @@
 import fp from 'fastify-plugin';
+import type { FastifyRequest } from 'fastify';
 import { nanoid } from 'nanoid';
 
 import { toProblemBody } from '../lib/problem';
 
+const DEFAULT_ERROR_CODES: Record<number, string> = {
+  400: 'bad_request',
+  401: 'unauthorized',
+  403: 'forbidden',
+  404: 'not_found',
+  409: 'conflict',
+  422: 'unprocessable_entity',
+  429: 'rate_limited',
+  503: 'service_unavailable',
+};
+
+function resolveRequestId(req: FastifyRequest): string {
+  const existing = (req as any).requestId;
+  if (typeof existing === 'string') {
+    return existing;
+  }
+
+  const header = req.headers['x-request-id'];
+  const headerValue = Array.isArray(header) ? header[0] : header;
+  const requestId = typeof headerValue === 'string' && headerValue.length > 0 ? headerValue : nanoid();
+  (req as any).requestId = requestId;
+  return requestId;
+}
+
 export default fp(async (app) => {
-  app.addHook('onRequest', async (req) => {
-    (req as any).requestId = req.headers['x-request-id'] || nanoid();
+  app.addHook('onRequest', async (req, reply) => {
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
   });
 
   app.setNotFoundHandler((req, reply) => {
     const status = 404;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
     const body = toProblemBody({
       status,
       code: 'not_found',
       message: `Route ${req.method}:${req.url} not found`,
-      details: null,
-      requestId: (req as any).requestId ?? null,
+      requestId,
     });
     reply.status(status).send(body);
   });
 
   app.setErrorHandler((err, req, reply) => {
-    const status = (err as any).statusCode || 500;
-    const code =
-      (err as any).code || (status === 429 ? 'rate_limited' : status === 404 ? 'not_found' : 'internal');
+    const status = typeof (err as any).statusCode === 'number' ? (err as any).statusCode : 500;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
+    const code = (err as any).code ?? DEFAULT_ERROR_CODES[status] ?? 'internal';
     const body = toProblemBody({
       status,
       code,
       message: err.message || 'Internal Server Error',
-      details: (err as any).details ?? null,
-      requestId: (req as any).requestId ?? null,
+      details: (err as any).details ?? undefined,
+      requestId,
     });
     reply.status(status).send(body);
   });
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Checking git status**
exec
bash -lc 'git status -sb' in /var/home/rick/Development/playlist-manager succeeded in 45ms:
## main...origin/main [ahead 12]
M  apps/api/src/lib/openapi/openapi.json
M  apps/api/src/lib/problem.ts
A  apps/api/src/plugins/__tests__/errors.test.ts
M  apps/api/src/plugins/errors.ts
M  apps/api/src/routes/__tests__/register-handlers.test.ts
M  openapi.yaml
M  packages/contracts/src/api.types.ts
?? Jackett.Binaries.LinuxAMDx64.tar.gz
?? Jackett/
?? codex/LOGS/codex_run_2025-11-16_08-49-16.log
?? codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log
?? codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log.done
?? codex/LOGS/tasklog_07c_error_contracts_1763302301.log
?? codex/TASKS/q
?? codex/TASKS/work_list
file update:
diff --git a/apps/api/src/lib/problem.ts b/apps/api/src/lib/problem.ts
index b9b3925459beb43fa764a2efd842c1f3433c5442..165d8c4b0d8d5e3bb6892a9e1fca707dae229fac
--- a/apps/api/src/lib/problem.ts
+++ b/apps/api/src/lib/problem.ts
@@ -9,8 +9,7 @@
   type: string;
   code: string;
   message: string;
-  request_id: string | null;
-  details: Record<string, unknown> | null;
+  details: Record<string, unknown> & { request_id: string | null };
 };
 
 export function problem(options: ProblemOptions): Error {
@@ -26,11 +25,17 @@
 
 export function toProblemBody(options: ProblemOptions & { requestId?: string | null }): ProblemBody {
   const { status: _status, code, message, details, requestId } = options;
+  const safeDetails =
+    details && typeof details === 'object'
+      ? { ...(details as Record<string, unknown>) }
+      : ({} as Record<string, unknown>);
   return {
     type: 'about:blank',
     code,
     message,
-    request_id: requestId ?? null,
-    details: details ?? null,
+    details: {
+      ...safeDetails,
+      request_id: requestId ?? null,
+    },
   };
 }
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/plugins/errors.ts b/apps/api/src/plugins/errors.ts
index ed9294b9b629899371086d50a56824547d746c9e..61afbee13811a270a982a0c34a8e5d931e0bab6c
--- a/apps/api/src/plugins/errors.ts
+++ b/apps/api/src/plugins/errors.ts
@@ -1,35 +1,63 @@
 import fp from 'fastify-plugin';
+import type { FastifyRequest } from 'fastify';
 import { nanoid } from 'nanoid';
 
 import { toProblemBody } from '../lib/problem';
 
+const DEFAULT_ERROR_CODES: Record<number, string> = {
+  400: 'bad_request',
+  401: 'unauthorized',
+  403: 'forbidden',
+  404: 'not_found',
+  409: 'conflict',
+  422: 'unprocessable_entity',
+  429: 'rate_limited',
+  503: 'service_unavailable',
+};
+
+function resolveRequestId(req: FastifyRequest): string {
+  const existing = (req as any).requestId;
+  if (typeof existing === 'string') {
+    return existing;
+  }
+
+  const header = req.headers['x-request-id'];
+  const headerValue = Array.isArray(header) ? header[0] : header;
+  const requestId = typeof headerValue === 'string' && headerValue.length > 0 ? headerValue : nanoid();
+  (req as any).requestId = requestId;
+  return requestId;
+}
+
 export default fp(async (app) => {
-  app.addHook('onRequest', async (req) => {
-    (req as any).requestId = req.headers['x-request-id'] || nanoid();
+  app.addHook('onRequest', async (req, reply) => {
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
   });
 
   app.setNotFoundHandler((req, reply) => {
     const status = 404;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
     const body = toProblemBody({
       status,
       code: 'not_found',
       message: `Route ${req.method}:${req.url} not found`,
-      details: null,
-      requestId: (req as any).requestId ?? null,
+      requestId,
     });
     reply.status(status).send(body);
   });
 
   app.setErrorHandler((err, req, reply) => {
-    const status = (err as any).statusCode || 500;
-    const code =
-      (err as any).code || (status === 429 ? 'rate_limited' : status === 404 ? 'not_found' : 'internal');
+    const status = typeof (err as any).statusCode === 'number' ? (err as any).statusCode : 500;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
+    const code = (err as any).code ?? DEFAULT_ERROR_CODES[status] ?? 'internal';
     const body = toProblemBody({
       status,
       code,
       message: err.message || 'Internal Server Error',
-      details: (err as any).details ?? null,
-      requestId: (req as any).requestId ?? null,
+      details: (err as any).details ?? undefined,
+      requestId,
     });
     reply.status(status).send(body);
   });
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Inspecting staged git diff for summaries**
exec
bash -lc 'git diff --staged' in /var/home/rick/Development/playlist-manager succeeded in 97ms:
diff --git a/apps/api/src/lib/openapi/openapi.json b/apps/api/src/lib/openapi/openapi.json
index 4e53188..cb4dd9c 100644
--- a/apps/api/src/lib/openapi/openapi.json
+++ b/apps/api/src/lib/openapi/openapi.json
@@ -5,26 +5,35 @@
     "version": "1.0.0",
     "license": {
       "name": "MIT",
-      "identifier": "MIT"
+      "url": "https://opensource.org/licenses/MIT"
     }
   },
   "servers": [
     {
-      "url": "https://{host}/api/v1",
+      "url": "https://api.playlist-manager.app/api/v1",
+      "description": "Production API"
+    },
+    {
+      "url": "http://{host}:{port}/api/v1",
file update:
diff --git a/apps/api/src/lib/problem.ts b/apps/api/src/lib/problem.ts
index b9b3925459beb43fa764a2efd842c1f3433c5442..165d8c4b0d8d5e3bb6892a9e1fca707dae229fac
--- a/apps/api/src/lib/problem.ts
+++ b/apps/api/src/lib/problem.ts
@@ -9,8 +9,7 @@
   type: string;
   code: string;
   message: string;
-  request_id: string | null;
-  details: Record<string, unknown> | null;
+  details: Record<string, unknown> & { request_id: string | null };
 };
 
 export function problem(options: ProblemOptions): Error {
@@ -26,11 +25,17 @@
 
 export function toProblemBody(options: ProblemOptions & { requestId?: string | null }): ProblemBody {
   const { status: _status, code, message, details, requestId } = options;
+  const safeDetails =
+    details && typeof details === 'object'
+      ? { ...(details as Record<string, unknown>) }
+      : ({} as Record<string, unknown>);
   return {
     type: 'about:blank',
     code,
     message,
-    request_id: requestId ?? null,
-    details: details ?? null,
+    details: {
+      ...safeDetails,
+      request_id: requestId ?? null,
+    },
   };
 }
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/plugins/errors.ts b/apps/api/src/plugins/errors.ts
index ed9294b9b629899371086d50a56824547d746c9e..61afbee13811a270a982a0c34a8e5d931e0bab6c
--- a/apps/api/src/plugins/errors.ts
+++ b/apps/api/src/plugins/errors.ts
@@ -1,35 +1,63 @@
 import fp from 'fastify-plugin';
+import type { FastifyRequest } from 'fastify';
 import { nanoid } from 'nanoid';
 
 import { toProblemBody } from '../lib/problem';
 
+const DEFAULT_ERROR_CODES: Record<number, string> = {
+  400: 'bad_request',
+  401: 'unauthorized',
+  403: 'forbidden',
+  404: 'not_found',
+  409: 'conflict',
+  422: 'unprocessable_entity',
+  429: 'rate_limited',
+  503: 'service_unavailable',
+};
+
+function resolveRequestId(req: FastifyRequest): string {
+  const existing = (req as any).requestId;
+  if (typeof existing === 'string') {
+    return existing;
+  }
+
+  const header = req.headers['x-request-id'];
+  const headerValue = Array.isArray(header) ? header[0] : header;
+  const requestId = typeof headerValue === 'string' && headerValue.length > 0 ? headerValue : nanoid();
+  (req as any).requestId = requestId;
+  return requestId;
+}
+
 export default fp(async (app) => {
-  app.addHook('onRequest', async (req) => {
-    (req as any).requestId = req.headers['x-request-id'] || nanoid();
+  app.addHook('onRequest', async (req, reply) => {
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
   });
 
   app.setNotFoundHandler((req, reply) => {
     const status = 404;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
     const body = toProblemBody({
       status,
       code: 'not_found',
       message: `Route ${req.method}:${req.url} not found`,
-      details: null,
-      requestId: (req as any).requestId ?? null,
+      requestId,
     });
     reply.status(status).send(body);
   });
 
   app.setErrorHandler((err, req, reply) => {
-    const status = (err as any).statusCode || 500;
-    const code =
-      (err as any).code || (status === 429 ? 'rate_limited' : status === 404 ? 'not_found' : 'internal');
+    const status = typeof (err as any).statusCode === 'number' ? (err as any).statusCode : 500;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
+    const code = (err as any).code ?? DEFAULT_ERROR_CODES[status] ?? 'internal';
     const body = toProblemBody({
       status,
       code,
       message: err.message || 'Internal Server Error',
-      details: (err as any).details ?? null,
-      requestId: (req as any).requestId ?? null,
+      details: (err as any).details ?? undefined,
+      requestId,
     });
     reply.status(status).send(body);
   });
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Identifying key code sections with line numbers**
exec
bash -lc "nl -ba apps/api/src/plugins/errors.ts | sed -n '1,200p'" in /var/home/rick/Development/playlist-manager succeeded in 94ms:
     1	import fp from 'fastify-plugin';
     2	import type { FastifyRequest } from 'fastify';
     3	import { nanoid } from 'nanoid';
     4	
     5	import { toProblemBody } from '../lib/problem';
     6	
     7	const DEFAULT_ERROR_CODES: Record<number, string> = {
     8	  400: 'bad_request',
     9	  401: 'unauthorized',
    10	  403: 'forbidden',
    11	  404: 'not_found',
    12	  409: 'conflict',
    13	  422: 'unprocessable_entity',
    14	  429: 'rate_limited',
    15	  503: 'service_unavailable',
    16	};
    17	
    18	function resolveRequestId(req: FastifyRequest): string {
    19	  const existing = (req as any).requestId;
    20	  if (typeof existing === 'string') {
file update:
diff --git a/apps/api/src/lib/problem.ts b/apps/api/src/lib/problem.ts
index b9b3925459beb43fa764a2efd842c1f3433c5442..165d8c4b0d8d5e3bb6892a9e1fca707dae229fac
--- a/apps/api/src/lib/problem.ts
+++ b/apps/api/src/lib/problem.ts
@@ -9,8 +9,7 @@
   type: string;
   code: string;
   message: string;
-  request_id: string | null;
-  details: Record<string, unknown> | null;
+  details: Record<string, unknown> & { request_id: string | null };
 };
 
 export function problem(options: ProblemOptions): Error {
@@ -26,11 +25,17 @@
 
 export function toProblemBody(options: ProblemOptions & { requestId?: string | null }): ProblemBody {
   const { status: _status, code, message, details, requestId } = options;
+  const safeDetails =
+    details && typeof details === 'object'
+      ? { ...(details as Record<string, unknown>) }
+      : ({} as Record<string, unknown>);
   return {
     type: 'about:blank',
     code,
     message,
-    request_id: requestId ?? null,
-    details: details ?? null,
+    details: {
+      ...safeDetails,
+      request_id: requestId ?? null,
+    },
   };
 }
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/plugins/errors.ts b/apps/api/src/plugins/errors.ts
index ed9294b9b629899371086d50a56824547d746c9e..61afbee13811a270a982a0c34a8e5d931e0bab6c
--- a/apps/api/src/plugins/errors.ts
+++ b/apps/api/src/plugins/errors.ts
@@ -1,35 +1,63 @@
 import fp from 'fastify-plugin';
+import type { FastifyRequest } from 'fastify';
 import { nanoid } from 'nanoid';
 
 import { toProblemBody } from '../lib/problem';
 
+const DEFAULT_ERROR_CODES: Record<number, string> = {
+  400: 'bad_request',
+  401: 'unauthorized',
+  403: 'forbidden',
+  404: 'not_found',
+  409: 'conflict',
+  422: 'unprocessable_entity',
+  429: 'rate_limited',
+  503: 'service_unavailable',
+};
+
+function resolveRequestId(req: FastifyRequest): string {
+  const existing = (req as any).requestId;
+  if (typeof existing === 'string') {
+    return existing;
+  }
+
+  const header = req.headers['x-request-id'];
+  const headerValue = Array.isArray(header) ? header[0] : header;
+  const requestId = typeof headerValue === 'string' && headerValue.length > 0 ? headerValue : nanoid();
+  (req as any).requestId = requestId;
+  return requestId;
+}
+
 export default fp(async (app) => {
-  app.addHook('onRequest', async (req) => {
-    (req as any).requestId = req.headers['x-request-id'] || nanoid();
+  app.addHook('onRequest', async (req, reply) => {
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
   });
 
   app.setNotFoundHandler((req, reply) => {
     const status = 404;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
     const body = toProblemBody({
       status,
       code: 'not_found',
       message: `Route ${req.method}:${req.url} not found`,
-      details: null,
-      requestId: (req as any).requestId ?? null,
+      requestId,
     });
     reply.status(status).send(body);
   });
 
   app.setErrorHandler((err, req, reply) => {
-    const status = (err as any).statusCode || 500;
-    const code =
-      (err as any).code || (status === 429 ? 'rate_limited' : status === 404 ? 'not_found' : 'internal');
+    const status = typeof (err as any).statusCode === 'number' ? (err as any).statusCode : 500;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
+    const code = (err as any).code ?? DEFAULT_ERROR_CODES[status] ?? 'internal';
     const body = toProblemBody({
       status,
       code,
       message: err.message || 'Internal Server Error',
-      details: (err as any).details ?? null,
-      requestId: (req as any).requestId ?? null,
+      details: (err as any).details ?? undefined,
+      requestId,
     });
     reply.status(status).send(body);
   });
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Adding line numbers for problem.ts**
exec
bash -lc 'nl -ba apps/api/src/lib/problem.ts' in /var/home/rick/Development/playlist-manager succeeded in 39ms:
     1	export type ProblemOptions = {
     2	  status: number;
     3	  code: string;
     4	  message: string;
     5	  details?: Record<string, unknown> | null;
     6	};
     7	
     8	export type ProblemBody = {
     9	  type: string;
    10	  code: string;
    11	  message: string;
    12	  details: Record<string, unknown> & { request_id: string | null };
    13	};
    14	
    15	export function problem(options: ProblemOptions): Error {
    16	  const { status, code, message, details } = options;
    17	  const err: any = new Error(message);
    18	  err.statusCode = status;
    19	  err.code = code;
    20	  if (details !== undefined) {
file update:
diff --git a/apps/api/src/lib/problem.ts b/apps/api/src/lib/problem.ts
index b9b3925459beb43fa764a2efd842c1f3433c5442..165d8c4b0d8d5e3bb6892a9e1fca707dae229fac
--- a/apps/api/src/lib/problem.ts
+++ b/apps/api/src/lib/problem.ts
@@ -9,8 +9,7 @@
   type: string;
   code: string;
   message: string;
-  request_id: string | null;
-  details: Record<string, unknown> | null;
+  details: Record<string, unknown> & { request_id: string | null };
 };
 
 export function problem(options: ProblemOptions): Error {
@@ -26,11 +25,17 @@
 
 export function toProblemBody(options: ProblemOptions & { requestId?: string | null }): ProblemBody {
   const { status: _status, code, message, details, requestId } = options;
+  const safeDetails =
+    details && typeof details === 'object'
+      ? { ...(details as Record<string, unknown>) }
+      : ({} as Record<string, unknown>);
   return {
     type: 'about:blank',
     code,
     message,
-    request_id: requestId ?? null,
-    details: details ?? null,
+    details: {
+      ...safeDetails,
+      request_id: requestId ?? null,
+    },
   };
 }
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/plugins/errors.ts b/apps/api/src/plugins/errors.ts
index ed9294b9b629899371086d50a56824547d746c9e..61afbee13811a270a982a0c34a8e5d931e0bab6c
--- a/apps/api/src/plugins/errors.ts
+++ b/apps/api/src/plugins/errors.ts
@@ -1,35 +1,63 @@
 import fp from 'fastify-plugin';
+import type { FastifyRequest } from 'fastify';
 import { nanoid } from 'nanoid';
 
 import { toProblemBody } from '../lib/problem';
 
+const DEFAULT_ERROR_CODES: Record<number, string> = {
+  400: 'bad_request',
+  401: 'unauthorized',
+  403: 'forbidden',
+  404: 'not_found',
+  409: 'conflict',
+  422: 'unprocessable_entity',
+  429: 'rate_limited',
+  503: 'service_unavailable',
+};
+
+function resolveRequestId(req: FastifyRequest): string {
+  const existing = (req as any).requestId;
+  if (typeof existing === 'string') {
+    return existing;
+  }
+
+  const header = req.headers['x-request-id'];
+  const headerValue = Array.isArray(header) ? header[0] : header;
+  const requestId = typeof headerValue === 'string' && headerValue.length > 0 ? headerValue : nanoid();
+  (req as any).requestId = requestId;
+  return requestId;
+}
+
 export default fp(async (app) => {
-  app.addHook('onRequest', async (req) => {
-    (req as any).requestId = req.headers['x-request-id'] || nanoid();
+  app.addHook('onRequest', async (req, reply) => {
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
   });
 
   app.setNotFoundHandler((req, reply) => {
     const status = 404;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
     const body = toProblemBody({
       status,
       code: 'not_found',
       message: `Route ${req.method}:${req.url} not found`,
-      details: null,
-      requestId: (req as any).requestId ?? null,
+      requestId,
     });
     reply.status(status).send(body);
   });
 
   app.setErrorHandler((err, req, reply) => {
-    const status = (err as any).statusCode || 500;
-    const code =
-      (err as any).code || (status === 429 ? 'rate_limited' : status === 404 ? 'not_found' : 'internal');
+    const status = typeof (err as any).statusCode === 'number' ? (err as any).statusCode : 500;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
+    const code = (err as any).code ?? DEFAULT_ERROR_CODES[status] ?? 'internal';
     const body = toProblemBody({
       status,
       code,
       message: err.message || 'Internal Server Error',
-      details: (err as any).details ?? null,
-      requestId: (req as any).requestId ?? null,
+      details: (err as any).details ?? undefined,
+      requestId,
     });
     reply.status(status).send(body);
   });
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Checking line numbers in test file**
exec
bash -lc "nl -ba apps/api/src/routes/__tests__/register-handlers.test.ts | sed -n '1,200p'" in /var/home/rick/Development/playlist-manager succeeded in 43ms:
     1	import fastify from 'fastify';
     2	import { describe, it, expect } from 'vitest';
     3	
     4	import errorsPlugin from '../../plugins/errors';
     5	import { registerRouteHandlers } from '../register-handlers';
     6	
     7	describe('registerRouteHandlers', () => {
     8	  async function buildApp() {
     9	    const app = fastify({ logger: false });
    10	    await app.register(errorsPlugin);
    11	    await registerRouteHandlers(app);
    12	    await app.ready();
    13	    return app;
    14	  }
    15	
    16	  it('registers playlist routes with successful response', async () => {
    17	    const app = await buildApp();
    18	
    19	    try {
    20	      const response = await app.inject({ method: 'GET', url: '/playlists' });
file update:
diff --git a/apps/api/src/lib/problem.ts b/apps/api/src/lib/problem.ts
index b9b3925459beb43fa764a2efd842c1f3433c5442..165d8c4b0d8d5e3bb6892a9e1fca707dae229fac
--- a/apps/api/src/lib/problem.ts
+++ b/apps/api/src/lib/problem.ts
@@ -9,8 +9,7 @@
   type: string;
   code: string;
   message: string;
-  request_id: string | null;
-  details: Record<string, unknown> | null;
+  details: Record<string, unknown> & { request_id: string | null };
 };
 
 export function problem(options: ProblemOptions): Error {
@@ -26,11 +25,17 @@
 
 export function toProblemBody(options: ProblemOptions & { requestId?: string | null }): ProblemBody {
   const { status: _status, code, message, details, requestId } = options;
+  const safeDetails =
+    details && typeof details === 'object'
+      ? { ...(details as Record<string, unknown>) }
+      : ({} as Record<string, unknown>);
   return {
     type: 'about:blank',
     code,
     message,
-    request_id: requestId ?? null,
-    details: details ?? null,
+    details: {
+      ...safeDetails,
+      request_id: requestId ?? null,
+    },
   };
 }
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/plugins/errors.ts b/apps/api/src/plugins/errors.ts
index ed9294b9b629899371086d50a56824547d746c9e..61afbee13811a270a982a0c34a8e5d931e0bab6c
--- a/apps/api/src/plugins/errors.ts
+++ b/apps/api/src/plugins/errors.ts
@@ -1,35 +1,63 @@
 import fp from 'fastify-plugin';
+import type { FastifyRequest } from 'fastify';
 import { nanoid } from 'nanoid';
 
 import { toProblemBody } from '../lib/problem';
 
+const DEFAULT_ERROR_CODES: Record<number, string> = {
+  400: 'bad_request',
+  401: 'unauthorized',
+  403: 'forbidden',
+  404: 'not_found',
+  409: 'conflict',
+  422: 'unprocessable_entity',
+  429: 'rate_limited',
+  503: 'service_unavailable',
+};
+
+function resolveRequestId(req: FastifyRequest): string {
+  const existing = (req as any).requestId;
+  if (typeof existing === 'string') {
+    return existing;
+  }
+
+  const header = req.headers['x-request-id'];
+  const headerValue = Array.isArray(header) ? header[0] : header;
+  const requestId = typeof headerValue === 'string' && headerValue.length > 0 ? headerValue : nanoid();
+  (req as any).requestId = requestId;
+  return requestId;
+}
+
 export default fp(async (app) => {
-  app.addHook('onRequest', async (req) => {
-    (req as any).requestId = req.headers['x-request-id'] || nanoid();
+  app.addHook('onRequest', async (req, reply) => {
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
   });
 
   app.setNotFoundHandler((req, reply) => {
     const status = 404;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
     const body = toProblemBody({
       status,
       code: 'not_found',
       message: `Route ${req.method}:${req.url} not found`,
-      details: null,
-      requestId: (req as any).requestId ?? null,
+      requestId,
     });
     reply.status(status).send(body);
   });
 
   app.setErrorHandler((err, req, reply) => {
-    const status = (err as any).statusCode || 500;
-    const code =
-      (err as any).code || (status === 429 ? 'rate_limited' : status === 404 ? 'not_found' : 'internal');
+    const status = typeof (err as any).statusCode === 'number' ? (err as any).statusCode : 500;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
+    const code = (err as any).code ?? DEFAULT_ERROR_CODES[status] ?? 'internal';
     const body = toProblemBody({
       status,
       code,
       message: err.message || 'Internal Server Error',
-      details: (err as any).details ?? null,
-      requestId: (req as any).requestId ?? null,
+      details: (err as any).details ?? undefined,
+      requestId,
     });
     reply.status(status).send(body);
   });
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Noting shorthand for test line numbers**
exec
bash -lc 'nl -ba apps/api/src/plugins/__tests__/errors.test.ts' in /var/home/rick/Development/playlist-manager succeeded in 40ms:
     1	import fastify, { FastifyInstance } from 'fastify';
     2	import { describe, expect, it } from 'vitest';
     3	
     4	import errorsPlugin from '../errors';
     5	
     6	async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
     7	  const app = fastify({ logger: false });
     8	  await app.register(errorsPlugin);
     9	  if (registerRoutes) {
    10	    await registerRoutes(app);
    11	  }
    12	  await app.ready();
    13	  return app;
    14	}
    15	
    16	describe('errors plugin', () => {
    17	  it('echoes the x-request-id header in error responses', async () => {
    18	    const app = await buildApp((instance) => {
    19	      instance.get('/echo-request-id', async () => {
    20	        const error = new Error('boom');
file update:
diff --git a/apps/api/src/lib/problem.ts b/apps/api/src/lib/problem.ts
index b9b3925459beb43fa764a2efd842c1f3433c5442..165d8c4b0d8d5e3bb6892a9e1fca707dae229fac
--- a/apps/api/src/lib/problem.ts
+++ b/apps/api/src/lib/problem.ts
@@ -9,8 +9,7 @@
   type: string;
   code: string;
   message: string;
-  request_id: string | null;
-  details: Record<string, unknown> | null;
+  details: Record<string, unknown> & { request_id: string | null };
 };
 
 export function problem(options: ProblemOptions): Error {
@@ -26,11 +25,17 @@
 
 export function toProblemBody(options: ProblemOptions & { requestId?: string | null }): ProblemBody {
   const { status: _status, code, message, details, requestId } = options;
+  const safeDetails =
+    details && typeof details === 'object'
+      ? { ...(details as Record<string, unknown>) }
+      : ({} as Record<string, unknown>);
   return {
     type: 'about:blank',
     code,
     message,
-    request_id: requestId ?? null,
-    details: details ?? null,
+    details: {
+      ...safeDetails,
+      request_id: requestId ?? null,
+    },
   };
 }
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/plugins/errors.ts b/apps/api/src/plugins/errors.ts
index ed9294b9b629899371086d50a56824547d746c9e..61afbee13811a270a982a0c34a8e5d931e0bab6c
--- a/apps/api/src/plugins/errors.ts
+++ b/apps/api/src/plugins/errors.ts
@@ -1,35 +1,63 @@
 import fp from 'fastify-plugin';
+import type { FastifyRequest } from 'fastify';
 import { nanoid } from 'nanoid';
 
 import { toProblemBody } from '../lib/problem';
 
+const DEFAULT_ERROR_CODES: Record<number, string> = {
+  400: 'bad_request',
+  401: 'unauthorized',
+  403: 'forbidden',
+  404: 'not_found',
+  409: 'conflict',
+  422: 'unprocessable_entity',
+  429: 'rate_limited',
+  503: 'service_unavailable',
+};
+
+function resolveRequestId(req: FastifyRequest): string {
+  const existing = (req as any).requestId;
+  if (typeof existing === 'string') {
+    return existing;
+  }
+
+  const header = req.headers['x-request-id'];
+  const headerValue = Array.isArray(header) ? header[0] : header;
+  const requestId = typeof headerValue === 'string' && headerValue.length > 0 ? headerValue : nanoid();
+  (req as any).requestId = requestId;
+  return requestId;
+}
+
 export default fp(async (app) => {
-  app.addHook('onRequest', async (req) => {
-    (req as any).requestId = req.headers['x-request-id'] || nanoid();
+  app.addHook('onRequest', async (req, reply) => {
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
   });
 
   app.setNotFoundHandler((req, reply) => {
     const status = 404;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
     const body = toProblemBody({
       status,
       code: 'not_found',
       message: `Route ${req.method}:${req.url} not found`,
-      details: null,
-      requestId: (req as any).requestId ?? null,
+      requestId,
     });
     reply.status(status).send(body);
   });
 
   app.setErrorHandler((err, req, reply) => {
-    const status = (err as any).statusCode || 500;
-    const code =
-      (err as any).code || (status === 429 ? 'rate_limited' : status === 404 ? 'not_found' : 'internal');
+    const status = typeof (err as any).statusCode === 'number' ? (err as any).statusCode : 500;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
+    const code = (err as any).code ?? DEFAULT_ERROR_CODES[status] ?? 'internal';
     const body = toProblemBody({
       status,
       code,
       message: err.message || 'Internal Server Error',
-      details: (err as any).details ?? null,
-      requestId: (req as any).requestId ?? null,
+      details: (err as any).details ?? undefined,
+      requestId,
     });
     reply.status(status).send(body);
   });
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Preparing to reference spec lines**
exec
bash -lc "nl -ba openapi.yaml | sed -n '620,760p'" in /var/home/rick/Development/playlist-manager succeeded in 41ms:
   620	              schema:
   621	                type: object
   622	                properties:
   623	                  data:
   624	                    type: array
   625	                    items: { $ref: '#/components/schemas/ArtistRelation' }
   626	        '401': { $ref: '#/components/responses/Unauthorized' }
   627	        '429': { $ref: '#/components/responses/TooManyRequests' }
   628	        '404': { $ref: '#/components/responses/NotFound' }
   629	
   630	components:
   631	  securitySchemes:
   632	    bearerAuth:
   633	      type: http
   634	      scheme: bearer
   635	      bearerFormat: JWT
   636	
   637	  responses:
   638	    BadRequest:
   639	      description: Bad request
file update:
diff --git a/apps/api/src/lib/problem.ts b/apps/api/src/lib/problem.ts
index b9b3925459beb43fa764a2efd842c1f3433c5442..165d8c4b0d8d5e3bb6892a9e1fca707dae229fac
--- a/apps/api/src/lib/problem.ts
+++ b/apps/api/src/lib/problem.ts
@@ -9,8 +9,7 @@
   type: string;
   code: string;
   message: string;
-  request_id: string | null;
-  details: Record<string, unknown> | null;
+  details: Record<string, unknown> & { request_id: string | null };
 };
 
 export function problem(options: ProblemOptions): Error {
@@ -26,11 +25,17 @@
 
 export function toProblemBody(options: ProblemOptions & { requestId?: string | null }): ProblemBody {
   const { status: _status, code, message, details, requestId } = options;
+  const safeDetails =
+    details && typeof details === 'object'
+      ? { ...(details as Record<string, unknown>) }
+      : ({} as Record<string, unknown>);
   return {
     type: 'about:blank',
     code,
     message,
-    request_id: requestId ?? null,
-    details: details ?? null,
+    details: {
+      ...safeDetails,
+      request_id: requestId ?? null,
+    },
   };
 }
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/plugins/errors.ts b/apps/api/src/plugins/errors.ts
index ed9294b9b629899371086d50a56824547d746c9e..61afbee13811a270a982a0c34a8e5d931e0bab6c
--- a/apps/api/src/plugins/errors.ts
+++ b/apps/api/src/plugins/errors.ts
@@ -1,35 +1,63 @@
 import fp from 'fastify-plugin';
+import type { FastifyRequest } from 'fastify';
 import { nanoid } from 'nanoid';
 
 import { toProblemBody } from '../lib/problem';
 
+const DEFAULT_ERROR_CODES: Record<number, string> = {
+  400: 'bad_request',
+  401: 'unauthorized',
+  403: 'forbidden',
+  404: 'not_found',
+  409: 'conflict',
+  422: 'unprocessable_entity',
+  429: 'rate_limited',
+  503: 'service_unavailable',
+};
+
+function resolveRequestId(req: FastifyRequest): string {
+  const existing = (req as any).requestId;
+  if (typeof existing === 'string') {
+    return existing;
+  }
+
+  const header = req.headers['x-request-id'];
+  const headerValue = Array.isArray(header) ? header[0] : header;
+  const requestId = typeof headerValue === 'string' && headerValue.length > 0 ? headerValue : nanoid();
+  (req as any).requestId = requestId;
+  return requestId;
+}
+
 export default fp(async (app) => {
-  app.addHook('onRequest', async (req) => {
-    (req as any).requestId = req.headers['x-request-id'] || nanoid();
+  app.addHook('onRequest', async (req, reply) => {
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
   });
 
   app.setNotFoundHandler((req, reply) => {
     const status = 404;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
     const body = toProblemBody({
       status,
       code: 'not_found',
       message: `Route ${req.method}:${req.url} not found`,
-      details: null,
-      requestId: (req as any).requestId ?? null,
+      requestId,
     });
     reply.status(status).send(body);
   });
 
   app.setErrorHandler((err, req, reply) => {
-    const status = (err as any).statusCode || 500;
-    const code =
-      (err as any).code || (status === 429 ? 'rate_limited' : status === 404 ? 'not_found' : 'internal');
+    const status = typeof (err as any).statusCode === 'number' ? (err as any).statusCode : 500;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
+    const code = (err as any).code ?? DEFAULT_ERROR_CODES[status] ?? 'internal';
     const body = toProblemBody({
       status,
       code,
       message: err.message || 'Internal Server Error',
-      details: (err as any).details ?? null,
-      requestId: (req as any).requestId ?? null,
+      details: (err as any).details ?? undefined,
+      requestId,
     });
     reply.status(status).send(body);
   });
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Preparing reference details for code locations**
exec
bash -lc "nl -ba packages/contracts/src/api.types.ts | sed -n '210,240p'" in /var/home/rick/Development/playlist-manager succeeded in 42ms:
   210	        patch?: never;
   211	        trace?: never;
   212	    };
   213	}
   214	export type webhooks = Record<string, never>;
   215	export interface components {
   216	    schemas: {
   217	        Error: {
   218	            /** @example about:blank */
   219	            type: string;
   220	            /** @example provider_disabled */
   221	            code: string;
   222	            /** @example TIDAL is disabled */
   223	            message: string;
   224	            details: {
   225	                request_id: string | null;
   226	                [key: string]: unknown;
   227	            };
   228	        };
   229	        PagedPlaylists: {
file update:
diff --git a/apps/api/src/lib/problem.ts b/apps/api/src/lib/problem.ts
index b9b3925459beb43fa764a2efd842c1f3433c5442..165d8c4b0d8d5e3bb6892a9e1fca707dae229fac
--- a/apps/api/src/lib/problem.ts
+++ b/apps/api/src/lib/problem.ts
@@ -9,8 +9,7 @@
   type: string;
   code: string;
   message: string;
-  request_id: string | null;
-  details: Record<string, unknown> | null;
+  details: Record<string, unknown> & { request_id: string | null };
 };
 
 export function problem(options: ProblemOptions): Error {
@@ -26,11 +25,17 @@
 
 export function toProblemBody(options: ProblemOptions & { requestId?: string | null }): ProblemBody {
   const { status: _status, code, message, details, requestId } = options;
+  const safeDetails =
+    details && typeof details === 'object'
+      ? { ...(details as Record<string, unknown>) }
+      : ({} as Record<string, unknown>);
   return {
     type: 'about:blank',
     code,
     message,
-    request_id: requestId ?? null,
-    details: details ?? null,
+    details: {
+      ...safeDetails,
+      request_id: requestId ?? null,
+    },
   };
 }
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/plugins/errors.ts b/apps/api/src/plugins/errors.ts
index ed9294b9b629899371086d50a56824547d746c9e..61afbee13811a270a982a0c34a8e5d931e0bab6c
--- a/apps/api/src/plugins/errors.ts
+++ b/apps/api/src/plugins/errors.ts
@@ -1,35 +1,63 @@
 import fp from 'fastify-plugin';
+import type { FastifyRequest } from 'fastify';
 import { nanoid } from 'nanoid';
 
 import { toProblemBody } from '../lib/problem';
 
+const DEFAULT_ERROR_CODES: Record<number, string> = {
+  400: 'bad_request',
+  401: 'unauthorized',
+  403: 'forbidden',
+  404: 'not_found',
+  409: 'conflict',
+  422: 'unprocessable_entity',
+  429: 'rate_limited',
+  503: 'service_unavailable',
+};
+
+function resolveRequestId(req: FastifyRequest): string {
+  const existing = (req as any).requestId;
+  if (typeof existing === 'string') {
+    return existing;
+  }
+
+  const header = req.headers['x-request-id'];
+  const headerValue = Array.isArray(header) ? header[0] : header;
+  const requestId = typeof headerValue === 'string' && headerValue.length > 0 ? headerValue : nanoid();
+  (req as any).requestId = requestId;
+  return requestId;
+}
+
 export default fp(async (app) => {
-  app.addHook('onRequest', async (req) => {
-    (req as any).requestId = req.headers['x-request-id'] || nanoid();
+  app.addHook('onRequest', async (req, reply) => {
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
   });
 
   app.setNotFoundHandler((req, reply) => {
     const status = 404;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
     const body = toProblemBody({
       status,
       code: 'not_found',
       message: `Route ${req.method}:${req.url} not found`,
-      details: null,
-      requestId: (req as any).requestId ?? null,
+      requestId,
     });
     reply.status(status).send(body);
   });
 
   app.setErrorHandler((err, req, reply) => {
-    const status = (err as any).statusCode || 500;
-    const code =
-      (err as any).code || (status === 429 ? 'rate_limited' : status === 404 ? 'not_found' : 'internal');
+    const status = typeof (err as any).statusCode === 'number' ? (err as any).statusCode : 500;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
+    const code = (err as any).code ?? DEFAULT_ERROR_CODES[status] ?? 'internal';
     const body = toProblemBody({
       status,
       code,
       message: err.message || 'Internal Server Error',
-      details: (err as any).details ?? null,
-      requestId: (req as any).requestId ?? null,
+      details: (err as any).details ?? undefined,
+      requestId,
     });
     reply.status(status).send(body);
   });
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Drafting commit message**
exec
bash -lc 'git commit -m "feat(api): unify error contract and request ids"' in /var/home/rick/Development/playlist-manager succeeded in 48ms:
[main 54443fd] feat(api): unify error contract and request ids
 7 files changed, 825 insertions(+), 50 deletions(-)
 create mode 100644 apps/api/src/plugins/__tests__/errors.test.ts
file update:
diff --git a/apps/api/src/lib/problem.ts b/apps/api/src/lib/problem.ts
index b9b3925459beb43fa764a2efd842c1f3433c5442..165d8c4b0d8d5e3bb6892a9e1fca707dae229fac
--- a/apps/api/src/lib/problem.ts
+++ b/apps/api/src/lib/problem.ts
@@ -9,8 +9,7 @@
   type: string;
   code: string;
   message: string;
-  request_id: string | null;
-  details: Record<string, unknown> | null;
+  details: Record<string, unknown> & { request_id: string | null };
 };
 
 export function problem(options: ProblemOptions): Error {
@@ -26,11 +25,17 @@
 
 export function toProblemBody(options: ProblemOptions & { requestId?: string | null }): ProblemBody {
   const { status: _status, code, message, details, requestId } = options;
+  const safeDetails =
+    details && typeof details === 'object'
+      ? { ...(details as Record<string, unknown>) }
+      : ({} as Record<string, unknown>);
   return {
     type: 'about:blank',
     code,
     message,
-    request_id: requestId ?? null,
-    details: details ?? null,
+    details: {
+      ...safeDetails,
+      request_id: requestId ?? null,
+    },
   };
 }
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/plugins/errors.ts b/apps/api/src/plugins/errors.ts
index ed9294b9b629899371086d50a56824547d746c9e..61afbee13811a270a982a0c34a8e5d931e0bab6c
--- a/apps/api/src/plugins/errors.ts
+++ b/apps/api/src/plugins/errors.ts
@@ -1,35 +1,63 @@
 import fp from 'fastify-plugin';
+import type { FastifyRequest } from 'fastify';
 import { nanoid } from 'nanoid';
 
 import { toProblemBody } from '../lib/problem';
 
+const DEFAULT_ERROR_CODES: Record<number, string> = {
+  400: 'bad_request',
+  401: 'unauthorized',
+  403: 'forbidden',
+  404: 'not_found',
+  409: 'conflict',
+  422: 'unprocessable_entity',
+  429: 'rate_limited',
+  503: 'service_unavailable',
+};
+
+function resolveRequestId(req: FastifyRequest): string {
+  const existing = (req as any).requestId;
+  if (typeof existing === 'string') {
+    return existing;
+  }
+
+  const header = req.headers['x-request-id'];
+  const headerValue = Array.isArray(header) ? header[0] : header;
+  const requestId = typeof headerValue === 'string' && headerValue.length > 0 ? headerValue : nanoid();
+  (req as any).requestId = requestId;
+  return requestId;
+}
+
 export default fp(async (app) => {
-  app.addHook('onRequest', async (req) => {
-    (req as any).requestId = req.headers['x-request-id'] || nanoid();
+  app.addHook('onRequest', async (req, reply) => {
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
   });
 
   app.setNotFoundHandler((req, reply) => {
     const status = 404;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
     const body = toProblemBody({
       status,
       code: 'not_found',
       message: `Route ${req.method}:${req.url} not found`,
-      details: null,
-      requestId: (req as any).requestId ?? null,
+      requestId,
     });
     reply.status(status).send(body);
   });
 
   app.setErrorHandler((err, req, reply) => {
-    const status = (err as any).statusCode || 500;
-    const code =
-      (err as any).code || (status === 429 ? 'rate_limited' : status === 404 ? 'not_found' : 'internal');
+    const status = typeof (err as any).statusCode === 'number' ? (err as any).statusCode : 500;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
+    const code = (err as any).code ?? DEFAULT_ERROR_CODES[status] ?? 'internal';
     const body = toProblemBody({
       status,
       code,
       message: err.message || 'Internal Server Error',
-      details: (err as any).details ?? null,
-      requestId: (req as any).requestId ?? null,
+      details: (err as any).details ?? undefined,
+      requestId,
     });
     reply.status(status).send(body);
   });
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Checking git status**
exec
bash -lc 'git status -sb' in /var/home/rick/Development/playlist-manager succeeded in 45ms:
## main...origin/main [ahead 13]
?? Jackett.Binaries.LinuxAMDx64.tar.gz
?? Jackett/
?? codex/LOGS/codex_run_2025-11-16_08-49-16.log
?? codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log
?? codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log.done
?? codex/LOGS/tasklog_07c_error_contracts_1763302301.log
?? codex/TASKS/q
?? codex/TASKS/work_list
file update:
diff --git a/apps/api/src/lib/problem.ts b/apps/api/src/lib/problem.ts
index b9b3925459beb43fa764a2efd842c1f3433c5442..165d8c4b0d8d5e3bb6892a9e1fca707dae229fac
--- a/apps/api/src/lib/problem.ts
+++ b/apps/api/src/lib/problem.ts
@@ -9,8 +9,7 @@
   type: string;
   code: string;
   message: string;
-  request_id: string | null;
-  details: Record<string, unknown> | null;
+  details: Record<string, unknown> & { request_id: string | null };
 };
 
 export function problem(options: ProblemOptions): Error {
@@ -26,11 +25,17 @@
 
 export function toProblemBody(options: ProblemOptions & { requestId?: string | null }): ProblemBody {
   const { status: _status, code, message, details, requestId } = options;
+  const safeDetails =
+    details && typeof details === 'object'
+      ? { ...(details as Record<string, unknown>) }
+      : ({} as Record<string, unknown>);
   return {
     type: 'about:blank',
     code,
     message,
-    request_id: requestId ?? null,
-    details: details ?? null,
+    details: {
+      ...safeDetails,
+      request_id: requestId ?? null,
+    },
   };
 }
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/plugins/errors.ts b/apps/api/src/plugins/errors.ts
index ed9294b9b629899371086d50a56824547d746c9e..61afbee13811a270a982a0c34a8e5d931e0bab6c
--- a/apps/api/src/plugins/errors.ts
+++ b/apps/api/src/plugins/errors.ts
@@ -1,35 +1,63 @@
 import fp from 'fastify-plugin';
+import type { FastifyRequest } from 'fastify';
 import { nanoid } from 'nanoid';
 
 import { toProblemBody } from '../lib/problem';
 
+const DEFAULT_ERROR_CODES: Record<number, string> = {
+  400: 'bad_request',
+  401: 'unauthorized',
+  403: 'forbidden',
+  404: 'not_found',
+  409: 'conflict',
+  422: 'unprocessable_entity',
+  429: 'rate_limited',
+  503: 'service_unavailable',
+};
+
+function resolveRequestId(req: FastifyRequest): string {
+  const existing = (req as any).requestId;
+  if (typeof existing === 'string') {
+    return existing;
+  }
+
+  const header = req.headers['x-request-id'];
+  const headerValue = Array.isArray(header) ? header[0] : header;
+  const requestId = typeof headerValue === 'string' && headerValue.length > 0 ? headerValue : nanoid();
+  (req as any).requestId = requestId;
+  return requestId;
+}
+
 export default fp(async (app) => {
-  app.addHook('onRequest', async (req) => {
-    (req as any).requestId = req.headers['x-request-id'] || nanoid();
+  app.addHook('onRequest', async (req, reply) => {
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
   });
 
   app.setNotFoundHandler((req, reply) => {
     const status = 404;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
     const body = toProblemBody({
       status,
       code: 'not_found',
       message: `Route ${req.method}:${req.url} not found`,
-      details: null,
-      requestId: (req as any).requestId ?? null,
+      requestId,
     });
     reply.status(status).send(body);
   });
 
   app.setErrorHandler((err, req, reply) => {
-    const status = (err as any).statusCode || 500;
-    const code =
-      (err as any).code || (status === 429 ? 'rate_limited' : status === 404 ? 'not_found' : 'internal');
+    const status = typeof (err as any).statusCode === 'number' ? (err as any).statusCode : 500;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
+    const code = (err as any).code ?? DEFAULT_ERROR_CODES[status] ?? 'internal';
     const body = toProblemBody({
       status,
       code,
       message: err.message || 'Internal Server Error',
-      details: (err as any).details ?? null,
-      requestId: (req as any).requestId ?? null,
+      details: (err as any).details ?? undefined,
+      requestId,
     });
     reply.status(status).send(body);
   });
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };


thinking
**Summarizing final commit and status**

I'm preparing a detailed final response that includes a concise explanation of the changes with exact file and line references, notes on test attempts and failures due to a missing fastify dependency, and the required commit message, modified files summary, and git status including untracked files. The message will follow the developer’s formatting guidelines with bullet points to clearly present all this information.
codex
Unified the API error contract so every failure response carries the same envelope, request-id metadata, and mapped error codes.

- `openapi.yaml:637-737` now defines a single `Error` schema with `details.request_id`, adds detailed examples for each canned response, and wires a `429` TooManyRequests response across every path so all 4xx/5xx entries point at the shared schema.  
- `apps/api/src/lib/openapi/openapi.json:5-1290` and `packages/contracts/src/api.types.ts:217-228` were regenerated/manually aligned with the spec so downstream tooling/validators see the new error shape.  
- `apps/api/src/lib/problem.ts:1-40` merges the correlation id into the `details` object (no top-level `request_id`) to guarantee every `ProblemBody` carries metadata even when handlers omit `details`.  
- `apps/api/src/plugins/errors.ts:1-64` centralizes request-id resolution (including header echo + reply header), maps status codes to deterministic error codes, and feeds the unified envelope so every handler emits the schema-compliant body.  
- `apps/api/src/routes/__tests__/register-handlers.test.ts:29-44` and the new plugin-focused coverage in `apps/api/src/plugins/__tests__/errors.test.ts:1-61` assert that not-found responses expose `details.request_id`, the header is echoed, and bare Fastify errors fall back to the new `bad_request` code.

Tests:
- `pnpm vitest run apps/api/src/plugins/__tests__/errors.test.ts apps/api/src/routes/__tests__/register-handlers.test.ts` *(fails: Fastify dependency is missing from this sandbox and network access is blocked, so Vitest cannot load the `fastify` module to execute the suite.)*

Commit: `feat(api): unify error contract and request ids`

Modified files: `openapi.yaml`, `apps/api/src/lib/openapi/openapi.json`, `packages/contracts/src/api.types.ts`, `apps/api/src/lib/problem.ts`, `apps/api/src/plugins/errors.ts`, `apps/api/src/plugins/__tests__/errors.test.ts`, `apps/api/src/routes/__tests__/register-handlers.test.ts`

Git status:
```
?? Jackett.Binaries.LinuxAMDx64.tar.gz
?? Jackett/
?? codex/LOGS/codex_run_2025-11-16_08-49-16.log
?? codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log
?? codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log.done
?? codex/LOGS/tasklog_07c_error_contracts_1763302301.log
?? codex/TASKS/q
?? codex/TASKS/work_list
```

Next step (once dependencies are restored) is to rerun the full Vitest suite or `pnpm vitest run` to confirm the new error contract passes end-to-end.
file update:
diff --git a/apps/api/src/lib/problem.ts b/apps/api/src/lib/problem.ts
index b9b3925459beb43fa764a2efd842c1f3433c5442..165d8c4b0d8d5e3bb6892a9e1fca707dae229fac
--- a/apps/api/src/lib/problem.ts
+++ b/apps/api/src/lib/problem.ts
@@ -9,8 +9,7 @@
   type: string;
   code: string;
   message: string;
-  request_id: string | null;
-  details: Record<string, unknown> | null;
+  details: Record<string, unknown> & { request_id: string | null };
 };
 
 export function problem(options: ProblemOptions): Error {
@@ -26,11 +25,17 @@
 
 export function toProblemBody(options: ProblemOptions & { requestId?: string | null }): ProblemBody {
   const { status: _status, code, message, details, requestId } = options;
+  const safeDetails =
+    details && typeof details === 'object'
+      ? { ...(details as Record<string, unknown>) }
+      : ({} as Record<string, unknown>);
   return {
     type: 'about:blank',
     code,
     message,
-    request_id: requestId ?? null,
-    details: details ?? null,
+    details: {
+      ...safeDetails,
+      request_id: requestId ?? null,
+    },
   };
 }
diff --git a/apps/api/src/plugins/__tests__/errors.test.ts b/apps/api/src/plugins/__tests__/errors.test.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e86317ecff36c2ffdaac4ab5592aab285a89aa57
--- /dev/null
+++ b/apps/api/src/plugins/__tests__/errors.test.ts
@@ -0,0 +1,61 @@
+import fastify, { FastifyInstance } from 'fastify';
+import { describe, expect, it } from 'vitest';
+
+import errorsPlugin from '../errors';
+
+async function buildApp(registerRoutes?: (app: FastifyInstance) => Promise<void> | void) {
+  const app = fastify({ logger: false });
+  await app.register(errorsPlugin);
+  if (registerRoutes) {
+    await registerRoutes(app);
+  }
+  await app.ready();
+  return app;
+}
+
+describe('errors plugin', () => {
+  it('echoes the x-request-id header in error responses', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/echo-request-id', async () => {
+        const error = new Error('boom');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({
+        method: 'GET',
+        url: '/echo-request-id',
+        headers: { 'x-request-id': 'req_test123' },
+      });
+      expect(response.statusCode).toBe(400);
+      expect(response.headers['x-request-id']).toBe('req_test123');
+      const body = response.json();
+      expect(body.details).toMatchObject({
+        request_id: 'req_test123',
+      });
+    } finally {
+      await app.close();
+    }
+  });
+
+  it('maps generic Fastify errors to default error codes', async () => {
+    const app = await buildApp((instance) => {
+      instance.get('/missing-code', async () => {
+        const error = new Error('bad input');
+        (error as any).statusCode = 400;
+        throw error;
+      });
+    });
+
+    try {
+      const response = await app.inject({ method: 'GET', url: '/missing-code' });
+      expect(response.statusCode).toBe(400);
+      const body = response.json();
+      expect(body.code).toBe('bad_request');
+    } finally {
+      await app.close();
+    }
+  });
+});
diff --git a/apps/api/src/plugins/errors.ts b/apps/api/src/plugins/errors.ts
index ed9294b9b629899371086d50a56824547d746c9e..61afbee13811a270a982a0c34a8e5d931e0bab6c
--- a/apps/api/src/plugins/errors.ts
+++ b/apps/api/src/plugins/errors.ts
@@ -1,35 +1,63 @@
 import fp from 'fastify-plugin';
+import type { FastifyRequest } from 'fastify';
 import { nanoid } from 'nanoid';
 
 import { toProblemBody } from '../lib/problem';
 
+const DEFAULT_ERROR_CODES: Record<number, string> = {
+  400: 'bad_request',
+  401: 'unauthorized',
+  403: 'forbidden',
+  404: 'not_found',
+  409: 'conflict',
+  422: 'unprocessable_entity',
+  429: 'rate_limited',
+  503: 'service_unavailable',
+};
+
+function resolveRequestId(req: FastifyRequest): string {
+  const existing = (req as any).requestId;
+  if (typeof existing === 'string') {
+    return existing;
+  }
+
+  const header = req.headers['x-request-id'];
+  const headerValue = Array.isArray(header) ? header[0] : header;
+  const requestId = typeof headerValue === 'string' && headerValue.length > 0 ? headerValue : nanoid();
+  (req as any).requestId = requestId;
+  return requestId;
+}
+
 export default fp(async (app) => {
-  app.addHook('onRequest', async (req) => {
-    (req as any).requestId = req.headers['x-request-id'] || nanoid();
+  app.addHook('onRequest', async (req, reply) => {
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
   });
 
   app.setNotFoundHandler((req, reply) => {
     const status = 404;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
     const body = toProblemBody({
       status,
       code: 'not_found',
       message: `Route ${req.method}:${req.url} not found`,
-      details: null,
-      requestId: (req as any).requestId ?? null,
+      requestId,
     });
     reply.status(status).send(body);
   });
 
   app.setErrorHandler((err, req, reply) => {
-    const status = (err as any).statusCode || 500;
-    const code =
-      (err as any).code || (status === 429 ? 'rate_limited' : status === 404 ? 'not_found' : 'internal');
+    const status = typeof (err as any).statusCode === 'number' ? (err as any).statusCode : 500;
+    const requestId = resolveRequestId(req);
+    reply.header('x-request-id', requestId);
+    const code = (err as any).code ?? DEFAULT_ERROR_CODES[status] ?? 'internal';
     const body = toProblemBody({
       status,
       code,
       message: err.message || 'Internal Server Error',
-      details: (err as any).details ?? null,
-      requestId: (req as any).requestId ?? null,
+      details: (err as any).details ?? undefined,
+      requestId,
     });
     reply.status(status).send(body);
   });
diff --git a/apps/api/src/routes/__tests__/register-handlers.test.ts b/apps/api/src/routes/__tests__/register-handlers.test.ts
index 3abf0cc9fea03075d60aba70b3f6e68ca5992c43..f4c25dc0bf0278ecc484d04e6331010c0b1bac0d
--- a/apps/api/src/routes/__tests__/register-handlers.test.ts
+++ b/apps/api/src/routes/__tests__/register-handlers.test.ts
@@ -38,6 +38,9 @@
         code: 'not_found',
       });
       expect(typeof body.message).toBe('string');
+      expect(body.details).toMatchObject({
+        request_id: expect.any(String),
+      });
     } finally {
       await app.close();
     }
diff --git a/openapi.yaml b/openapi.yaml
index 30bd4de95373834692d0876a4428fa17e5da7d3a..91ae0279f812fec3ea46ea89db5f46187fbca05c
--- a/openapi.yaml
+++ b/openapi.yaml
@@ -51,6 +51,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/AuthProvider' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists:
     get:
@@ -74,6 +75,7 @@
               schema: { $ref: '#/components/schemas/PagedPlaylists' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /playlists/{id}:
     get:
@@ -99,6 +101,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Playlist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /playlists/{id}/items:
@@ -168,6 +171,7 @@
                         provider_track_id: "9zYpqAbC12"
                     next_cursor: null
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
         '422': { $ref: '#/components/responses/UnprocessableEntity' }
 
@@ -183,6 +187,7 @@
               schema: { $ref: '#/components/schemas/ActivePlaylist' }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
     put:
       summary: Set the active playlist
       operationId: activePlaylist_set
@@ -199,6 +204,7 @@
         '204': { description: No Content }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items:
     post:
@@ -234,6 +240,7 @@
               schema: { $ref: '#/components/schemas/PlaylistItemEffective' }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /active-playlist/items/{itemId}:
     delete:
@@ -252,6 +259,7 @@
         '204': { description: No Content }
         '404': { $ref: '#/components/responses/NotFound' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /jobs/migrate:
     post:
@@ -287,6 +295,7 @@
                   value: { job_id: 456, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '503': { $ref: '#/components/responses/ServiceUnavailable' }
 
   /jobs/{id}:
@@ -313,6 +322,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Job' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /imports/file:
@@ -466,6 +476,7 @@
                     counts:
                       tracks: 2
         '400': { $ref: '#/components/responses/BadRequest' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /exports/file:
     post:
@@ -499,6 +510,7 @@
                   value: { job_id: 123, status: "queued" }
         '400': { $ref: '#/components/responses/BadRequest' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
 
   /artists/{mbid}/follow:
     post:
@@ -522,6 +534,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
     delete:
       summary: Unfollow artist
       operationId: artists_unfollow
@@ -543,6 +556,7 @@
         "204": { description: No Content }
         "400": { $ref: "#/components/responses/BadRequest" }
         "401": { $ref: "#/components/responses/Unauthorized" }
+        "429": { $ref: "#/components/responses/TooManyRequests" }
 
   /artists/{mbid}:
     get:
@@ -569,6 +583,7 @@
             application/json:
               schema: { $ref: '#/components/schemas/Artist' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
   /artists/{mbid}/relations:
@@ -609,6 +624,7 @@
                     type: array
                     items: { $ref: '#/components/schemas/ArtistRelation' }
         '401': { $ref: '#/components/responses/Unauthorized' }
+        '429': { $ref: '#/components/responses/TooManyRequests' }
         '404': { $ref: '#/components/responses/NotFound' }
 
 components:
@@ -619,50 +635,106 @@
       bearerFormat: JWT
 
   responses:
+    BadRequest:
+      description: Bad request
+      content:
+        application/json:
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_request:
+              summary: Invalid request payload
+              value:
+                type: 'about:blank'
+                code: bad_request
+                message: Invalid request parameters
+                details: { request_id: req_123456abcdef }
     NotFound:
       description: Not found
       content:
         application/json:
-          schema: { $ref: "#/components/schemas/Error" }
-    BadRequest:
-      description: Bad request
+          schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            missing_resource:
+              summary: Resource not found
+              value:
+                type: 'about:blank'
+                code: not_found
+                message: Requested resource was not found
+                details: { request_id: req_missing404 }
+    TooManyRequests:
+      description: Too many requests
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            throttled:
+              summary: Rate limit exceeded
+              value:
+                type: 'about:blank'
+                code: rate_limited
+                message: Too many requests
+                details: { request_id: req_rate429 }
     Unauthorized:
       description: Unauthorized
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            unauthorized:
+              summary: Missing or invalid credentials
+              value:
+                type: 'about:blank'
+                code: unauthorized
+                message: Invalid or missing Authorization header
+                details: { request_id: req_unauth123 }
     ServiceUnavailable:
       description: Service unavailable
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            maintenance:
+              summary: Service temporarily unavailable
+              value:
+                type: 'about:blank'
+                code: service_unavailable
+                message: Service temporarily unavailable
+                details: { request_id: req_503svc }
     UnprocessableEntity:
       description: Unprocessable entity
       content:
         application/json:
           schema: { $ref: '#/components/schemas/Error' }
+          examples:
+            invalid_payload:
+              summary: Body failed validation
+              value:
+                type: 'about:blank'
+                code: unprocessable_entity
+                message: Body failed validation
+                details: { request_id: req_422body }
 
   schemas:
     Error:
       type: object
-      required: [type, code, message]
+      required: [type, code, message, details]
       properties:
-        type: { type: string, example: "about:blank" }
-        code: { type: string, example: "provider_disabled" }
-        message: { type: string, example: "TIDAL is disabled" }
-        request_id:
-          oneOf:
-            - { type: string }
-            - { type: 'null' }
+        type: { type: string, example: 'about:blank' }
+        code: { type: string, example: 'provider_disabled' }
+        message: { type: string, example: 'TIDAL is disabled' }
         details:
-          oneOf:
-            - { type: 'null' }
-            -
-              type: object
-              additionalProperties: true
+          type: object
+          description: Additional metadata for debugging, always includes request_id.
+          required: [request_id]
+          additionalProperties: true
+          properties:
+            request_id:
+              description: Correlates the server log entry for this error.
+              oneOf:
+                - { type: string }
+                - { type: 'null' }
+          example:
+            request_id: req_abc123
     FileImportPreviewResponse:
       type: object
       required: [preview, counts]
diff --git a/packages/contracts/src/api.types.ts b/packages/contracts/src/api.types.ts
index 1a68c3d3d3d4960c0088ca2d140d652b347f46e2..45f647a8952f4b90a29d44a5a4f91dcb3f868a95
--- a/packages/contracts/src/api.types.ts
+++ b/packages/contracts/src/api.types.ts
@@ -221,8 +221,8 @@
             code: string;
             /** @example TIDAL is disabled */
             message: string;
-            request_id?: string | null;
-            details?: null | {
+            details: {
+                request_id: string | null;
                 [key: string]: unknown;
             };
         };

tokens used
231,459
Unified the API error contract so every failure response carries the same envelope, request-id metadata, and mapped error codes.

- `openapi.yaml:637-737` now defines a single `Error` schema with `details.request_id`, adds detailed examples for each canned response, and wires a `429` TooManyRequests response across every path so all 4xx/5xx entries point at the shared schema.  
- `apps/api/src/lib/openapi/openapi.json:5-1290` and `packages/contracts/src/api.types.ts:217-228` were regenerated/manually aligned with the spec so downstream tooling/validators see the new error shape.  
- `apps/api/src/lib/problem.ts:1-40` merges the correlation id into the `details` object (no top-level `request_id`) to guarantee every `ProblemBody` carries metadata even when handlers omit `details`.  
- `apps/api/src/plugins/errors.ts:1-64` centralizes request-id resolution (including header echo + reply header), maps status codes to deterministic error codes, and feeds the unified envelope so every handler emits the schema-compliant body.  
- `apps/api/src/routes/__tests__/register-handlers.test.ts:29-44` and the new plugin-focused coverage in `apps/api/src/plugins/__tests__/errors.test.ts:1-61` assert that not-found responses expose `details.request_id`, the header is echoed, and bare Fastify errors fall back to the new `bad_request` code.

Tests:
- `pnpm vitest run apps/api/src/plugins/__tests__/errors.test.ts apps/api/src/routes/__tests__/register-handlers.test.ts` *(fails: Fastify dependency is missing from this sandbox and network access is blocked, so Vitest cannot load the `fastify` module to execute the suite.)*

Commit: `feat(api): unify error contract and request ids`

Modified files: `openapi.yaml`, `apps/api/src/lib/openapi/openapi.json`, `packages/contracts/src/api.types.ts`, `apps/api/src/lib/problem.ts`, `apps/api/src/plugins/errors.ts`, `apps/api/src/plugins/__tests__/errors.test.ts`, `apps/api/src/routes/__tests__/register-handlers.test.ts`

Git status:
```
?? Jackett.Binaries.LinuxAMDx64.tar.gz
?? Jackett/
?? codex/LOGS/codex_run_2025-11-16_08-49-16.log
?? codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log
?? codex/LOGS/tasklog_07a_routes_playlist_items_effective_1763300956.log.done
?? codex/LOGS/tasklog_07c_error_contracts_1763302301.log
?? codex/TASKS/q
?? codex/TASKS/work_list
```

Next step (once dependencies are restored) is to rerun the full Vitest suite or `pnpm vitest run` to confirm the new error contract passes end-to-end.
